
$\require{enclose}$ <!-- Later equations only properly knit if this is beforehand once in the code -->

`r ECHOCODE=FALSE`

# Chapter 3 Modeling Life Contingent Benefits {#C:Benefit}

`r chapnum = 3`

This chapter introduces the modeling of life contingent benefits, integrating the material from the previous chapter with basic concepts from financial mathematics. In contrast to benefits that are certain to be paid at specified periods, life contingent benefits have the additional complexity that the payments are uncertain and contingent upon either the survival or mortality of one or more lives. In this chapter we introduce the calculations of the present values of these contingent benefits, along with associated notation.

We assume that all benefits are paid at annual times. Extensions to benefits paid in continuous or more frequently than annual time are considered in Chapter X.

## Valuation of cash flows under uncertainty {#Sec:BenefitCFUnc}

Imagine a financial system with a cash flow of known value $_tC$ occuring in $t$ years from now. If we assume the spot rate of interest is $i_t$ per annum effective, then we know from introductory financial mathematics that the present value ($PV$) of this cash flow is:

$$
PV = ~_tC (1+i_t)^{-t}=~_tCv^t
(\#eq:Benefit1)
$$

<span style="color: red;">
**Structure discussion.** We'll need to make a decision on how much basic interest theory we need to incorporate here or in an appendix - I believe Emil is currently working on this. Looking at prior textbooks we can see something equivalent in Chapter 2 of Promislow (2015) but nothing in DHW (2019). Deciding this will also determine whether we need to include an example here, which could a constant interest rate and/or a yield curve.
</span>

<span style="color: green;">
**Notation discussion.** There are a number of decisions to make here.

<span style="color: green;">
I'd like to keep $PV$ as we can use it for all types of present value calculations (insurance benefits, annuity benefits, premiums, etc.). I'd like to keep $V$ for reserves. We also need to think about consistency of terminology: do we use actuarial present value or expected present value? Is it necessary to emphasize distinction? (I deliberately haven't).

<span style="color: green;">
Jed's initial principles suggest uppercase italics for random variables. That's OK as long as we are recognising that sometimes the values won't be random if all elements of the RHS of the equation are deterministic. Further, elements such as $C$ might be random variables in some types of policies (e.g. unit linked) but not others.

<span style="color: green;">
Keeping benefit cashflows as $C$ works and we can use $P$ for premium cash flows.

<span style="color: green;">
Having $t$ be a left subscript ensures that right subscripts are reserved for individual characteristics $\bf{x}$ leaving open the possibility of $_tC_{\bf{x}}$ where relevant for a policy. This means we should likely change $i_t$ to $_ti$ for consistency. To make clear the PV is on an individual policy we should use the subscript $j$ to give us $PV_{j}$ - a further benefit is that we wouldn't need the $PV_{agg}$ later in the Chapter. I don't think $PV_{{\bf{x}}_j}$ is necessary as the $\bf{x}$ is reserved only for survival calculations.
</span>

Let us now introduce uncertainty into this system. Uncertainty might be in terms of the values of $_tC$, $t$ or $i_t$. For the moment we will assume $i_t$ is known and that $t$ can take discrete values $k \in \{0,1,2,3, \ldots\}$. The probability mass function of $_kC$ is defined as $\Pr(_kC)$.

This system is illustrated on a timeline in Figure \@ref(fig:Benefit1).

`r HideRCode('Benefit1',"R Code For Figure")`

```{r  Benefit1, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,9,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(6,6.2,6,5.8,code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(6,7,"3")
text(7.5,7,"...")
text(1,5,"Cash Flow")
text(3,5,TeX("_0C"))
text(4,5,TeX("_1C"))
text(5,5,TeX("_2C"))
text(6,5,TeX("_3C"))
text(7.5,5,"...")
text(1,4,"Probability")
text(3,4,TeX("Pr(_0C)"))
text(4,4,TeX("Pr(_1C)"))
text(5,4,TeX("Pr(_2C)"))
text(6,4,TeX("Pr(_3C)"))
text(7.5,4,"...")


```

</div>

```{r Benefit1, ref.label = 'Benefit1', fig.cap = 'Timeline of cash flows with uncertainty', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

<span style="color: purple;"> **To be resolved later.** It would be good to get the font in the figures consistent with the text. </span>

$PV$ is now a discrete random variable. We can calculate the expected present value $\mu_{PV}$ and standard deviation of present value $\sigma_{PV}$ using standard statistical methods as follows:

$$
\begin{array}{l}
\mu_{PV} = \sum_{k=0}^{\infty} ~_kC~ v^k ~\Pr(_kC)\\
\sigma_{PV} = \sqrt{\sum_{k=0}^{\infty} ~_tC^2 ~v^{2k} ~\Pr(_kC) - \mu_{PV}^2 }\\
\end{array}
(\#eq:Benefit2)
$$

<span style="color: green;">
**Notation discussion.** To be consistent with Jed's notation guide I'm comfortable with replacing $\mu_{PV}$ with $\mathrm{E}(PV)$. Would we be happy with $\sigma (PV)$ as well?
</span>

It is often efficient and convenient to analyse such cash flow systems using a spreadsheet package such as Excel or equivalent.

<span style="color: red;">
**Structure discussion.**A key decision we need to make here is how we want to present these examples. For any simple calculations I think we should be providing spreadsheet as well as R examples. There are two different ways we can present the spreadsheet examples.  I have presented both in the example below. The R code at the end can be used after either.

<span style="color: red;">
Option 1 is just an iFrame of an Excel document I created and am storing on my ANU OneDrive account.  I have fixed it so that it can be viewed and edited without having to login to a Microsoft account. The upside of this approach is the easy manipulation of the file by readers in a format they are likely familar with.  The downside is that it is at the whim of any changes Microsoft might choose to make to Excel Online. I have provided the downloadable option so that students can still access the files even if they cannot see the iFrame.

<span style="color: red;">
Option 2 is to use the jExcel javascript approach as previously recommended by Jed. Graphs to be analysed are created separately in R, although I haven't done that below. If doing this I'd recommend having a downloadable Excel rather than CSV file so as to maintain formatting. The upside of this option is that it requires no account to view the material, which is all embedded in R Bookdown. The main downside is difficulty in coding for writers, particularly with plots.

<span style="color: red;">
My personal preference is the first approach as I think this will be easier for writers to deal with, although I don't feel particularly strongly about it.

<span style="color: red;">
Weâ€™ll also need to think about how this would work for those only able to access the pdf version of the textbook.
</span>

***

The embedded file below (<span style="color: blue;">I'll fix up Figure labels later</span>) shows the calculation of $\mathrm{E}(PV)$ and $\sigma (PV)$ for a general cash flow model of the style shown in Equation \@ref(eq:Benefit2). To keep the example simple we assume that $k \in {0,1,2,...,10}$.  Cells highlighted in yellow correspond to the cash flow ($_kC$), spot rate ($i_k$) and probability ($\Pr(_kC)$) components of the calculation. These can be changed to see the impact on the $\mathrm{E}(PV)$ and $\sigma (PV)$ output, which are highlighted in orange. The component calculations of the summations in $\mathrm{E}(PV)$ and $\sigma (PV)$ can be found in Cells F3-F13 and G3-G13 respectively. To see the formulae for these cells just double click on the cell.

***

<span style="color: red;">
Option 1
</span>

<iframe width="600" height="750" frameborder="0" scrolling="no" src="https://onedrive.live.com/embed?resid=22D545F33DAA9426%21351&amp;authkey=%21AG0diqB2fy-5HMc&amp;em=2&amp;wdAllowInteractivity=False&amp;AllowTyping=True&amp;wdHideHeaders=True&amp;wdDownloadButton=True&amp;wdInConfigurator=True"></iframe>

<span style="color: red;">
The approach to doing this is outlined at https://support.microsoft.com/en-us/office/embed-your-excel-workbook-on-your-web-page-or-blog-from-sharepoint-or-onedrive-for-business-7af74ce6-e8a0-48ac-ba3b-a1dd627b7773. While this link does show the ability to embed a chart item specifically I tested this and couldn't get it to work. In any case I don't think that would be that useful here as I suspect that having separate iFrames for the calculations and plot means the plot would not automatically update when the data is changed. Hence I think the above approach with data, calculations and plot in the same iFrame would be best. The plot is just for show at the moment - I don't think this example needs a plot. I have had some problems with getting the plot to display but have been able to get around this by clicking into one of the cells and pressing Enter. I'd be curious to know about your experience.
</span>

***

<span style="color: red;">
Option 2
</span>

<div id="spreadsheetCPEOLD"></div>
<div id="containerCPEOLD"></div>

```{r echo=ECHOCODE}
# Import data from CSV file, then convert so it can be used in Javascript
dataCPEOLD <- read.csv("Data/ContingentPaymentExample.csv", header = F)

df_to_js <- function(x, var_name = "dataCPEOLD", ...){
            json_data <- jsonlite::toJSON(x, ...)
            htmltools::tags$script(paste0("var ",var_name," = ", json_data, ";"))
            }
df_to_js(dataCPEOLD)
# See https://www.aliciaschep.com/blog/js-rmarkdown/
#  and https://livefreeordichotomize.com/2017/01/24/custom-javascript-visualizations-in-rmarkdown/
# To save formulas in Excel, go to Formulas ==> Show Formulas. Then save as .csv file
```

<!-- The table disappears if the below code not included - I'm not sure why as it appears to be related to the plot rather than the table (AB) -->

```{js echo=ECHOCODE}
dataCPEOLD[7]["V14"]="Sum"; // AB - I'm not sure what this line of code does
// Spreadsheet Defined
var mySpreadsheetCPEOLD = jexcel(document.getElementById('spreadsheetCPEOLD'), {
    data: dataCPEOLD,
    columns: [
       { type: 'text', width:'80', 'align': 'left' },
       { type: 'numeric',  mask:'#.000', decimal:'.'},
       { type: 'numeric',  mask:'#.000', decimal:'.'},
       { type: 'numeric',  mask:'#.000', decimal:'.'},
       { type: 'numeric',  mask:'#.000', decimal:'.'},
       { type: 'numeric',  mask:'#.000', decimal:'.'},
       { type: 'numeric',  mask:'#.000', decimal:'.'},
       { type: 'numeric',  mask:'#.000', decimal:'.'},
       { type: 'numeric',  mask:'#.000', decimal:'.'},
       { type: 'numeric',  mask:'#.000', decimal:'.'},
       { type: 'numeric',  mask:'#.000', decimal:'.'},
       { type: 'numeric',  mask:'#.000', decimal:'.'},
       { type: 'numeric',  mask:'#.000', decimal:'.'},
        ],
        onchange:updateCPEOLD,
            style: {
        B3:'background-color: yellow;', // AB - hopefully there is a quicker way of getting the formatting I'd like
        F15: 'font-weight: bold;',
        G16: 'font-weight: bold;',        
    },
});

```

<span style="color: red;">
I would be aiming to make this look as close as possible to the embedded Excel spreadsheet above, but there are a number of issues that I think I'll need Jed's help to resolve. Firstly the formulae for $v^k$ in column D are not working for some reason, I'm not sure why. There are also lots of formatting elements I don't understand as yet.  I have not included a plot, but this would be similar to the examples previously provided by Jed.
</span>

***

<span style="color: red;">
The downloadable option below would be provided for either of the options chosen.  Whichever option we choose it is my preference to use Excel rather than csv files as this way the formatting can be maintained.
</span>

[Click here for a downloadable version of the file](https://anu365-my.sharepoint.com/:x:/g/personal/u4233932_anu_edu_au/EXVFCyHdyt9BvQYsUzLlr4kBaty-CQJ6cdk50zY57tlH_Q?e=C1kGba&download=1)

***



<div id="spreadsheetCPE"></div>
<p><button id='downloadLCCPE'>Export this spreadsheet as CSV</button></p>



```{r echo=ECHOCODE}
# Import data from CSV file, then convert so it can be used in Javascript
dataCPE <- read.csv("Data/ContingentPaymentExampleA.csv", header = F)

df_to_js <- function(x, var_name = "dataCPE", ...){
            json_data <- jsonlite::toJSON(x, ...)
            htmltools::tags$script(paste0("var ",var_name," = ", json_data, ";"))
            }
df_to_js(dataCPE)
# See https://www.aliciaschep.com/blog/js-rmarkdown/
#  and https://livefreeordichotomize.com/2017/01/24/custom-javascript-visualizations-in-rmarkdown/
# To save formulas in Excel, go to Formulas ==> Show Formulas. Then save as .csv file
```


```{js echo=ECHOCODE}
dataCPE[11]["V1"]="E(PV)";
dataCPE[12]["V1"]="sigma (PV)";
// Spreadsheet Defined
var mySpreadsheetCPE = jexcel(document.getElementById('spreadsheetCPE'), {
    data: dataCPE,
    columns: [
       { type: 'numeric', width:'80', 'align': 'center' , title: 'Time \n \\(k\\)' },
       { type: 'numeric',  width:'110', mask:'#.000', decimal:'.', title: 'Cash Flow \n \\( ~_k C\\)'},
       { type: 'numeric',  width:'110', mask:'#.000', decimal:'.', title: 'Spot Rate \n \\(i_k\\)' },
       { type: 'numeric',  width:'110', mask:'#.0000', decimal:'.', title: ' \\( v^k \\)' },
       { type: 'numeric',  width:'120', mask:'#.000', decimal:'.', title: 'Probability \n \\(\Pr( _kC)\\)' },
       { type: 'text',  width:'160', mask:'#.000', decimal:'.', title: ' \\( ~_k C \\times v^k \\times \Pr( _kC)\\)' },
       { type: 'text',  width:'160', mask:'#.000', decimal:'.', title: ' \\( ~_k C \\times v^{2k} \\times \Pr( _kC)\\)' },
        ],
    minDimensions: [12,6],
    tableOverflow: true,
    tableWidth: '800px',
    tableHeight: '600px',
    freezeColumns: 1,
        style: {
        F12:'background-color: yellow;', // AB - hopefully there is a quicker way of getting the formatting I'd like
        G13:'background-color: yellow;', 
        A12: 'font-weight: bold;',
        A13: 'font-weight: bold;',        
    },
});

```


```{js echo=ECHOCODE}
// Make a Download Button
document.getElementById("downloadLCCPE").addEventListener("click", myFunctionDownload);
function myFunctionDownload() {mySpreadsheetCPE.download();};

```


The following R code can be used to perform the same calculations as the spreadsheet above.

`r HideRCode('ContingentPaymentExample',"R Code For Contingent Payment Example")`

```{r  ContingentPaymentExample, warning=FALSE,message=FALSE, comment=NA, eval=TRUE}
Time <- c(0:10)
CashFlow <- c(250,800,500,1200,300,750,400,450,850,1500,100)
SpotRate <- c(0,0.005,0.008,0.012,0.017,0.023,0.03,0.03,0.03,0.03,0.03)
vk <- (1+SpotRate)^(-Time)
Prob <- c(0.2,0.06,0.09,0.17,0.11,0.1,0.02,0.09,0,0.25,0.2)
# Expected Present Value calculation
EPV <- sum(CashFlow*vk*Prob)
EPV
# Standard Deviation of Present Value calculation
CashFlowSq <- CashFlow^2
vkSq <- vk^2
StDevPV <- sqrt(sum(CashFlowSq*vkSq*Prob)-EPV^2)
StDevPV

```

</div>

<br>

## Life insurance benefits and actuarial notation {#Sec:BenefitActNot}

<span style="color: red;">
**Structure discussion.**Iâ€™m not sure how much of these sorts of notation and probability calculations will be in Chapter 2 and whether weâ€™ll need more basic probability calculations before this.  It may make sense to have another chapter between Chapter 2 and this that focussed on the life table and the various probability calculations coming from the life table â€“ DHW do some of this in their Chapter 3 and incorporate things like mortality improvement and selection there as well. Promislow also does it in his Chapter 3.
</span>

In this section we introduce some basic types of life insurance policies and find the expected present value and standard deviation of the present value of the benefit cash flows of these policies using Equation \@ref(eq:Benefit2). We also present standard notation that actuaries have developed for these calculations. This notation assumes that in Equation \@ref(eq:Benefit2) all cash flows $_kC$ are $1$. Also, unless otherwise noted, we assume that benefits are paid at the end of the year. (This assumption will be relaxed in Chaper X).

### 	Whole of Life Insurance {#Sec:BenefitWL}

Under a **whole of life** policy the insurer pays a benefit upon the death of the policyholder, with payment made at time $K_{\bf{x}}+1$. This system is illustrated on a timeline in Figure \@ref(fig:Benefit2), with the $PV$ of the benefit cash flows shown below.


`r HideRCode('Benefit2',"R Code For Figure")`

```{r  Benefit2, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,9,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(6,6.2,6,5.8,code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(6,7,"3")
text(7.5,7,"...")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(6,8,"x+3")
text(7.5,8,"...")
text(1,5,"Cash Flow")
text(4,5,"1")
text(5,5,"1")
text(6,5,"1")
text(7.5,5,"...")
text(1,4,"Probability")
text(4,4,TeX("q_x"))
text(5,4,TeX("_{1|}q_x"))
text(6,4,TeX("_{2|}q_x"))
text(7.5,4,"...")


```

</div>

```{r Benefit2, ref.label = 'Benefit2', fig.cap = 'Timeline of benefit cash flows from a whole of life insurance policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

$$
\begin{array}{l}
PV = v^{K_{\bf{x}}+1} \\
\mu_{PV} = \sum_{k=0}^{\infty} v^{k+1} ~_{k|}q_{\bf{x}} = A_{\bf{x}}\\
\sigma_{PV} = \sqrt{ \sum_{k=0}^{\infty} \left( v^{k+1} \right)^2 ~_{k-1|}q_{\bf{x}}  - \mu_{PV}^2 }= \sqrt{^2A_{\bf{x}}-A_{\bf{x}}^2}\\
\end{array}
(\#eq:Benefit3)
$$

***
<span style="color: blue;">
**Note for author to complete.** The specifics of $A_{\bf{x}}$ need to be fleshed out in more detail, with similar amendments made to later subsections.
</span>

<span style="color: red;">
**Structure discussion.** Dani, I notice that your LifeTableStuff file goes through this and adds to the life table as well which is a nice start.  My instinct is that we don't incorporate it until this chapter but I'm interested in everyone's feedback.
</span>

***

### 	Term Insurance {#Sec:BenefitTI}

Under a **term insurance** policy the insurer pays a benefit upon the death of the policyholder, with payment made at time $K_{\bf{x}}+1$, as long as death occurs within the $n$ year term of the policy. This system is illustrated on a timeline in Figure \@ref(fig:Benefit3), with the $PV$ of the benefit cash flows shown below. We introduce the Bernoulli random variable $I_Y$, which is equal to $1$ if event $Y$ occurs or $0$ otherwise.

`r HideRCode('Benefit3',"R Code For Figure")`

```{r  Benefit3, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(10,6.2,10,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(7.5,7,"...")
text(10,7,"n-1")
text(11,7,"n")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(7.5,8,"...")
text(10,8,"x+n-1")
text(11,8,"x+n")
text(1,5,"Cash Flow")
text(4,5,"C")
text(5,5,"C")
text(7.5,5,"...")
text(10,5,"C")
text(11,5,"C")
text(1,4,"Probability")
text(4,4,TeX("q_x"))
text(5,4,TeX("_{1|}q_x"))
text(7.5,4,"...")
text(10,4,TeX("_{n-2|}q_x"))
text(11,4,TeX("_{n-1|}q_x"))


```

</div>

```{r Benefit3, ref.label = 'Benefit3', fig.cap = 'Timeline of benefit cash flows from a term insurance policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```


***

$$
\require{enclose}
\begin{array}{l}
PV = v^{K_{\bf{x}}+1} I_{K_{\bf{x}} \le n-1} = \left \{\begin{array}{cl}
v^{K_{\bf{x}}+1} & \text{where }  K_{\bf{x}} \le n-1 \\
0  & \text{where } K_{\bf{x}} > n-1 \\
\end{array} \right.
\\
\mu_{PV} = \sum_{k=0}^{n-1} v^{k+1} ~_{k|}q_{\bf{x}} = A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1}\\
\sigma_{PV} = \sqrt{\sum_{k=0}^{n-1} \left( v^{k+1} \right)^2 ~_{k|}q_{\bf{x}}  - \mu_{PV}^2 } = \sqrt{^2A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1}  - \left( A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1} \right)^2 } \\
\end{array}
(\#eq:Benefit4)
$$

### 	Pure Endowment

Under a **pure endowment** policy the insurer pays a benefit upon the survival of the policyholder for the $n$ year term of the policy. This system is illustrated on a timeline in Figure \@ref(fig:Benefit4), with the $PV$ of the benefit cash flows shown below.

`r HideRCode('Benefit4',"R Code For Figure")`

```{r  Benefit4, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(11,7,"n")
text(1,8,"Insured Age")
text(3,8,"x")
text(11,8,"x+n")
text(1,5,"Cash Flow")
text(11,5,"1")
text(1,4,"Probability")
text(11,4,TeX("_np_{\\textbf{x}}}"))


```

</div>

```{r Benefit4, ref.label = 'Benefit4', fig.cap = 'Timeline of benefit cash flows from a pure endowment policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

$$
\begin{array}{l}
PV = v^n I_{T_{\bf{x}}>n} = \left \{\begin{array}{cl}
0 & \text{where } T_{\bf{x}} \le n \\
v^n & \text{where } T_{\bf{x}} > n \\
\end{array} \right.
\\
\mu_{PV} = v^n {_np_{\bf{x}}} = A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {\space \space \space \space \space 1}
\\
\sigma_{PV} = v^n \sqrt{{_np_{\bf{x}}}(1-{_np_{\bf{x}}})}
\end{array}
(\#eq:Benefit5)
$$

### 	Endowment Insurance

An **endowment insurance** is effectively a combination of a term insurance and pure endowment policy. The insurer pays a benefit at the end of the year of death if the policyholder's death occurs within the term $n$ of the policy, or at time $n$ if the policyholder survives until time $n$. This system can be illustrated on a timeline as can be seen in Figure \@ref(fig:Benefit5), with the $PV$ of the benefit cash flows shown below.


`r HideRCode('Benefit5',"R Code For Figure")`

```{r  Benefit5, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(10,6.2,10,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(7.5,7,"...")
text(10,7,"n-1")
text(11,7,"n")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(7.5,8,"...")
text(10,8,"x+n-1")
text(11,8,"x+n")
text(1,5,"Cash Flow")
text(4,5,"1")
text(5,5,"1")
text(7.5,5,"...")
text(10,5,"1")
text(11,5,"1")
text(1,3.5,"Probability")
text(4,4,TeX("q_x"))
text(5,4,TeX("_{1|}q_x"))
text(7.5,4,"...")
text(10,4,TeX("_{n-2|}q_x"))
text(11,4,TeX("_{n-1|}q_x"))
text(11,3,TeX("+_np_x"))

```

</div>

```{r Benefit5, ref.label = 'Benefit5', fig.cap = 'Timeline of benefit cash flows from an endowment insurance policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

$$
\begin{array}{l}
PV = v^{\text {min} \left[ K_{\bf{x}}+1 , n \right]}  = \left \{\begin{array}{cl}
v^{K_{\bf{x}}+1} & \text{where }  K_{\bf{x}} \le n-1 \\
v^n  & \text{where } K_{\bf{x}} > n-1 \\
\end{array} \right.
\\
\mu_{PV} = \sum_{k=0}^{n-1} v^{k+1} ~_{k|}q_{\bf{x}} + v^n ~_tp_n = A_{{\bf{x}}:\enclose{actuarial}{n}} \\
\sigma_{PV} = \sqrt{\sum_{k=0}^{n-1} \left( v^{k+1} \right)^2 ~_{t-1|}q_{\bf{x}} + v^{2n} ~_tp_n - \mu_{PV}^2 } = \sqrt{^2A_{{\bf{x}}:\enclose{actuarial}{n}} - \left( A_{{\bf{x}}:\enclose{actuarial}{n}} \right)^2 } \\
\end{array}
(\#eq:Benefit6)
$$

### 	Life Annuity

Under a **life annuity** policy the insurer pays regular benefits to policyholders whilst they are alive. An annuity payable **in advance** has benefits paid at the start of the year, while an annuity payable in arrears has benefits paid at the end of the year. This system is illustrated on a timeline in Figure \@ref(fig:Benefit6), with the $PV$ of the benefit cash flows shown below.


`r HideRCode('Benefit6',"R Code For Figure")`

```{r  Benefit6, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,9,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(6,6.2,6,5.8,code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(6,7,"3")
text(7.5,7,"...")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(6,8,"x+3")
text(7.5,8,"...")
text(1,5,"Cash Flow")
text(3,5,"1")
text(4,5,"1")
text(5,5,"1")
text(6,5,"1")
text(7.5,5,"...")
text(1,4,"Prob (advance)")
text(3,4,TeX("1"))
text(4,4,TeX("_1p_x"))
text(5,4,TeX("_2p_x"))
text(6,4,TeX("_3p_x"))
text(7.5,4,"...")
text(1,3,"Prob (arrears)")
text(4,3,TeX("_1p_x"))
text(5,3,TeX("_2p_x"))
text(6,3,TeX("_3p_x"))
text(7.5,3,"...")


```

</div>

```{r Benefit6, ref.label = 'Benefit6', fig.cap = 'Timeline of benefit cash flows from a life annuity policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

In advance:

$$
\begin{array}{l}
PV = 1+v^{1}+v^{2}+...+v^{K_{\bf{x}}} \space (\text{if} \space i_k=i) = \ddot{a}_{\enclose{actuarial}{K_{\bf{x}}+1}} = (1+i) \frac{1-v^{K_{\bf{x}}+1}}{i} \\
\mu_{PV} = \sum_{k=0}^{\infty} v^{k} ~_kp_{\bf{x}} = \ddot{a}_{\bf{x}} \\
\sigma_{PV} = \sqrt{\sum_{k=0}^{\infty}  \left( v^{k} \right)^2 ~_tp_{\bf{x}}  - \mu_{PV}^2 } = \sqrt{{^2}\ddot{a}_{\bf{x}}  - ( \ddot{a}_{\bf{x}} ) ^2 }\\
\end{array}
(\#eq:Benefit7)
$$

In arrears:

$$
\begin{array}{l}
PV = v^{1}+v^{2}+...v^{K_{\bf{x}}} \space (\text{if} \space i_k=i) = a_{\enclose{actuarial}{K_{\bf{x}}}} =  \frac{1-v^{K_{\bf{x}}}}{i}
\\
\mu_{PV} = \sum_{k=1}^{\infty} v^k ~_kp_{\bf{x}} = {a}_{\bf{x}} = \ddot{a}_{\bf{x}} - 1 \\
\sigma_{PV} = \sqrt{\sum_{k=1}^{\infty}  \left( v^{k} \right)^2 ~_tp_{\bf{x}}  - \mu_{PV}^2 } = \sqrt{{^2}{a}_{\bf{x}}  - ( {a}_{\bf{x}} ) ^2 }\\
\end{array}
(\#eq:Benefit8)
$$

<span style="color: blue;">
**Note for author to complete.** Need to tidy these equations (using amsmath package for alignment and also fixing notation for if component) but I'm aiming to allow for the formulae to be flexible in whether $i$ is constant or not.  This allows use more flexibility in examples and exercises.
</span>

### 	Term Life Annuity

Under a **term life annuity** policy the insurer pays benefits to policyholders whilst they are alive, for a maximum of $n$ periods irrespective of the timing of death. For annuities in advance and in arrears, this system is illustrated on a timeline in Figure \@ref(fig:Benefit7), with the $PV$ of the benefit cash flows shown below.


`r HideRCode('Benefit7',"R Code For Figure")`

```{r  Benefit7, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(10,6.2,10,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(7.5,7,"...")
text(10,7,"n-1")
text(11,7,"n")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(7.5,8,"...")
text(10,8,"x+n-1")
text(11,8,"x+n")
text(1,5,"Cash Flow")
text(3,5,"1")
text(4,5,"1")
text(5,5,"1")
text(7.5,5,"...")
text(10,5,"1")
text(11,5,"1")
text(1,4,"Prob (advance)")
text(3,4,"1")
text(4,4,TeX("_1p_x"))
text(5,4,TeX("_2p_x"))
text(7.5,4,"...")
text(10,4,TeX("_{n-1}p_x"))
text(1,3,"Prob (arrears)")
text(4,3,TeX("_1p_x"))
text(5,3,TeX("_2p_x"))
text(7.5,3,"...")
text(10,3,TeX("_{n-1}p_x"))
text(11,3,TeX("_np_x"))


```

</div>

```{r Benefit7, ref.label = 'Benefit7', fig.cap = 'Timeline of benefit cash flows from a term life annuity policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***
In advance:

$$
\begin{array}{l}
PV = 1+v^{1}+v^{2}+...+v^{\text{min}[K_{\bf{x}},n-1]} \space (\text{if} \space i_k=i) = \ddot{a}_{\enclose{actuarial}{\text{min} [K_{\bf{x}}+1,n]}} = \left \{\begin{array}{cl}
(1+i) \frac{1-v^{K_{\bf{x}}+1}}{i} & \text{where }  K_{\bf{x}} \le n-1 \\
(1+i) \frac{1-v^{n}}{i}  & \text{where } K_{\bf{x}} > n-1 \\
\end{array} \right.
\\
\mu_{PV} = \sum_{k=0}^{n-1} v^k ~_kp_{\bf{x}} = \ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}} \\
\sigma_{PV} = \sqrt{\sum_{k=0}^{n-1}  \left( v^{k} \right)^2 ~_kp_{\bf{x}}  - \mu_{PV}^2 } = \sqrt{ {^2}\ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}} - \left( \ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}} \right) ^2 }\\
\end{array}
(\#eq:Benefit9)
$$

In arrears:

$$
\begin{array}{l}
PV = v^{1}+v^{2}+...+v^{\text{min}[K_{\bf{x}},n]} \space (\text{if} \space i_k=i) = {a}_{\enclose{actuarial}{\text{min} [K_{\bf{x}},n]}} = \left \{\begin{array}{cl}
\frac{1-v^{K_{\bf{x}}}}{i} & \text{where }  K_{\bf{x}} \le n \\
\frac{1-v^{n}}{i}  & \text{where } K_{\bf{x}} > n \\
\end{array} \right.
\\
\mu_{PV} = \sum_{k=1}^{n} v^k ~_kp_{\bf{x}} = {a}_{{\bf{x}}:\enclose{actuarial}{n}} = \ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}} - 1 \\
\sigma_{PV} = \sqrt{\sum_{t=1}^{n}  \left( v^{k} \right)^2 ~_kp_{\bf{x}}  - \mu_{PV}^2 } = \sqrt{ {^2}{a}_{{\bf{x}}:\enclose{actuarial}{n}} - \left( {a}_{{\bf{x}}:\enclose{actuarial}{n}} \right) ^2 }\\
\end{array}
(\#eq:Benefit10)
$$

### 	Deferred Life Annuity

Under a **term life annuity** policy the insurer pays benefits to policyholders whilst they are alive, but only after a deferral period of $n$ periods. For annuities in advance and in arrears, this system is illustrated on a timeline in Figure \@ref(fig:Benefit8), with the $PV$ of the benefit cash flows shown below.


`r HideRCode('Benefit8',"R Code For Figure")`

```{r  Benefit8, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(10,6.2,10,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(6.5,7,"...")
text(8,7,"n-1")
text(9,7,"n")
text(10,7,"n+1")
text(11,7,"n+2")
text(12,7,"...")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(6.5,8,"...")
text(8,8,"x+n-1")
text(9,8,"x+n")
text(10,8,"x+n+1")
text(11,8,"x+n+2")
text(12,8,"...")
text(1,5,"Cash Flow")
text(9,5,"1")
text(10,5,"1")
text(11,5,"1")
text(12,5,"...")
text(1,4,"Prob (advance)")
text(9,4,TeX("_{n}p_x"))
text(10,4,TeX("_{n+1}p_x"))
text(11,4,TeX("_{n+2}p_x"))
text(12,4,"...")
text(1,3,"Prob (arrears)")
text(10,3,TeX("_{n+1}p_x"))
text(11,3,TeX("_{n+2}p_x"))
text(12,3,"...")

```

</div>

```{r Benefit8, ref.label = 'Benefit8', fig.cap = 'Timeline of benefit cash flows from a deferred life annuity policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

In advance:

$$
\begin{array}{l}
PV = \left \{\begin{array}{cl}
0 & \text{where }  K_{\bf{x}} \le n-1 \\
v^{n}+v^{n+1}+v^{n+2}+...+v^{K_{\bf{x}}} \space (\text{if} \space i_k=i) = v^n ~\ddot{a}_{\enclose{actuarial}{K_{\bf{x}}-n+1}} = v^n (1+i) \frac{1-v^{K_{\bf{x}}-n+1}}{i}  & \text{where } K_{\bf{x}} > n-1 \\
\end{array} \right.
\\
\mu_{PV} = \sum_{k=n}^{\infty} v^k ~_kp_{\bf{x}} = ~_{n|}\ddot{a}_{\bf{x}} = \ddot{a}_{\bf{x}} - \ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}} \\
\sigma_{PV} = \sqrt{\sum_{k=n}^{\infty}  \left( v^{k} \right)^2 ~_kp_{\bf{x}}  - \mu_{PV}^2 } = \sqrt{ ~^2_{n|}\ddot{a}_{\bf{x}} - \left( ~_{n|}\ddot{a}_{\bf{x}} \right) ^2 }\\
\end{array}
(\#eq:Benefit11)
$$

In arrears:

$$
\begin{array}{l}
PV = \left \{\begin{array}{cl}
0 & \text{where }  K_{\bf{x}} \le n-1 \\
v^{n+1}+v^{n+2}+...+v^{K_{\bf{x}}} \space (\text{if} \space i_k=i) = v^n ~{a}_{\enclose{actuarial}{K_{\bf{x}}-n}} = v^n \frac{1-v^{K_{\bf{x}}-n}}{i}  & \text{where } K_{\bf{x}} > n-1 \\
\end{array} \right.
\\
\mu_{PV} = \sum_{k=n+1}^{\infty} v^k ~_kp_{\bf{x}} = ~_{n|}{a}_{\bf{x}} = {a}_{\bf{x}} - {a}_{{\bf{x}}:\enclose{actuarial}{n}} \\
\sigma_{PV} = \sqrt{\sum_{k=n+1}^{\infty}  \left( v^{k} \right)^2 ~_kp_{\bf{x}}  - \mu_{PV}^2 } = \sqrt{ ~^2_{n|}{a}_{\bf{x}} - \left( ~_{n|}{a}_{\bf{x}} \right) ^2 }\\
\end{array}
(\#eq:Benefit12)
$$

### 	Guaranteed Life Annuity

A **guaranteed life annuity** policy is equivalent to a life annuity policy, although benefits are guaranteed to be paid for a minimum of $n$ periods. For annuities in advance and in arrears, this system is illustrated on a timeline in Figure \@ref(fig:Benefit9), with the $PV$ of the benefit cash flows shown below.


`r HideRCode('Benefit9',"R Code For Figure")`

```{r  Benefit9, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(10,6.2,10,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(6.5,7,"...")
text(8,7,"n-1")
text(9,7,"n")
text(10,7,"n+1")
text(11,7,"n+2")
text(12,7,"...")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(6.5,8,"...")
text(8,8,"x+n-1")
text(9,8,"x+n")
text(10,8,"x+n+1")
text(11,8,"x+n+2")
text(12,8,"...")
text(1,5,"Cash Flow")
text(3,5,"1")
text(4,5,"1")
text(5,5,"1")
text(6.5,5,"...")
text(8,5,"1")
text(9,5,"1")
text(10,5,"1")
text(11,5,"1")
text(12,5,"...")
text(1,4,"Prob (advance)")
text(3,4,"1")
text(4,4,TeX("1"))
text(5,4,TeX("1"))
text(6.5,4,"...")
text(8,4,TeX("1"))
text(9,4,TeX("_{n}p_x"))
text(10,4,TeX("_{n+1}p_x"))
text(11,4,TeX("_{n+2}p_x"))
text(12,4,"...")
text(1,3,"Prob (arrears)")
text(4,3,TeX("1"))
text(5,3,TeX("1"))
text(6.5,3,"...")
text(8,3,TeX("1"))
text(9,3,TeX("1"))
text(10,3,TeX("_{n+1}p_x"))
text(11,3,TeX("_{n+2}p_x"))
text(12,3,"...")

```

</div>

```{r Benefit9, ref.label = 'Benefit9', fig.cap = 'Timeline of benefit cash flows from a guaranteed life annuity policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

In advance:

$$
\begin{array}{l}
PV = 1+v^{1}+v^{2}+...+v^{\text{max}[K_{\bf{x}},n-1]} \space (\text{if} \space i_k=i) = \ddot{a}_{\enclose{actuarial}{\text{max} [K_{\bf{x}}+1,n]}} = \left \{\begin{array}{cl}
(1+i) \frac{1-v^{n}}{i} & \text{where }  K_{\bf{x}} \le n-1 \\
(1+i) \frac{1-v^{K_{\bf{x}}+1}}{i}  & \text{where } K_{\bf{x}} > n-1 \\
\end{array} \right.
\\
\mu_{PV} = \sum_{k=0}^{n-1} v^k + \sum_{k=n}^{\infty} v^k ~_kp_{\bf{x}} = \ddot{a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}} = \ddot{a}_{\enclose{actuarial}{n}} + ~_{n|}\ddot{a}_{\bf{x}} \\
\sigma_{PV} = \sqrt{\sum_{k=0}^{n-1} \left( v^{k} \right)^2 + \sum_{k=n}^{\infty} \left( v^{k} \right)^2 ~_kp_{\bf{x}}  - \mu_{PV}^2 } = \sqrt{ ~^2\ddot{a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}} - \left( \ddot{a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}} \right)^2 }\\
\end{array}
(\#eq:Benefit13)
$$

In arrears:

$$
\begin{array}{l}
PV = v^{1}+v^{2}+...+v^{\text{max}[K_{\bf{x}},n]} \space (\text{if} \space i_k=i) = ~a_{\enclose{actuarial}{\text{max} [K_{\bf{x}},n]}} = \left \{\begin{array}{cl}
\frac{1-v^{n}}{i} & \text{where }  K_{\bf{x}} \le n \\
\frac{1-v^{K_{\bf{x}}}}{i}  & \text{where } K_{\bf{x}} > n \\
\end{array} \right.
\\
\mu_{PV} = \sum_{k=1}^{n} v^k + \sum_{k=n+1}^{\infty} v^k ~_kp_{x} = {a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}} = {a}_{\enclose{actuarial}{n}} + ~_{n|}{a}_{\bf{x}} \\
\sigma_{PV} = \sqrt{\sum_{k=1}^{n} \left( v^{k} \right)^2 + \sum_{k=n+1}^{\infty} \left( v^{k} \right)^2 ~_kp_{\bf{x}}  - \mu_{PV}^2 } = \sqrt{ ~^2{a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}} - \left( {a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}} \right) ^2 }\\
\end{array}
(\#eq:Benefit14)
$$

<span style="color: red;">
**Structure discussion.** The UK syllabus has included the use of a book of life tables for as long as I can remember. Interestingly the new CM1 syllabus has removed the references to life insurance actuarial notation (it still has the probability notation), although it still exists in the questions in the specimen exams. My instinct is that, as per the above, we include the notation in our textbook but de-emphasise it, and that we base all calculations in our textbook on tables constructed from publicly available datasets rather than anything from the UK book.

<span style="color: blue;">
**Note for author to complete.** We could show the relationship among the different policies, including recursion (see DHW Chapter 5), perhaps as exercises for students. Some of this might better fit a Chapter on reserves. Need to decide this.
</span>


##	Bringing actuarial notation to the Life Table {#Sec:BenefitLT}
In Chapter 2 the Life Table was introduced. In this subsection we incorporate additional columns into the Life Table based on the notation introduced in Chapter \@ref(Sec:BenefitActNot). We also perform additional calculations using this additional information.

<span style="color: blue;">
**Note for author to complete.** We can utilise Excel here to expand the Life Table and have a number of exercises and examples.  This would still involve using age as the only predictor, unless we want to move away from this concept.


## Case Study: Valuing the benefits of a portfolio of term insurance policies {#Sec:BenefitCS}

In this section we take what we have learned so far in this Chapter and apply it to a more detailed valuation of the benefits of an individual and porfolio of whole of life insurance policies.

### An individual policy {#Sec:BenefitCSInd}

We showed how to value a single whole of life insurance policy in Chapter \@ref(Sec:BenefitWL). For example, consider a 40 year old individual ($=\bf{x}$) with sum insured \$400,000 ($=C$), and whose mortality probability is expected to follow the US 2010-14 female rates described in Chapter 2. Assuming an interest rate of 2% per annum effective (<span style="color: blue;"> we might instead use the spot rate calculation from above</span>) ($=i_t$), the calculation of $\mu_{PV}$ and $\sigma_{PV}$ can be performed as follows, using either the **life table** structure from Chapter \@ref(Sec:BenefitWL) or from **first principles** as per Equation \@ref(eq:Benefit3):

<span style="color: blue;">
**Note for author to complete.** This needs to be updated to change from term insurance to whole of life, and to include calculation using a life table and from first principles (two separate tabs). I'll also update this to value a policy from the data - most likely one sold recently.

***

<iframe width="900" height="500" frameborder="0" scrolling="yes" src="https://anu365-my.sharepoint.com/personal/u4233932_anu_edu_au/_layouts/15/Doc.aspx?sourcedoc={71b9edf0-7c05-4478-b42c-fb297860e866}&action=embedview&wdAllowInteractivity=False&AllowTyping=True&wdDownloadButton=True&wdInConfigurator=True"></iframe>

***

Another way of analysing $PV$ is to plot its probability mass function. We know that the probability mass function of $K_{\bf{x}}$ is $\Pr(K_{\bf{x}}=k) = ~_{k|}q_{\bf{x}}$. Hence the probability mass function of $PV$ is $P \left( PV=Cv^{k+1} \right) = ~_{k|}q_{\bf{x}}$.

<span style="color: blue;">Include pmf plot.</span>

###	A portfolio of policies {#Sec:BenefitCSPort}

Now let us consider a portfolio of $J$ independent $n$-year term insurance policies on individuals ${\bf{x}}_j$ where $j = 1,2,...,J$. <span style="color: blue;">Describe the portfolio from Chapter 2 and the mortality assumptions. Use a single month or year of sales for consistent valuation.</span>

Using Equation \@ref(eq:Benefit4) and incorporating the sum insureds $C_j$, we can describe the aggregated present value of this portfolio $PV_{agg}$ as as:

$$
\begin{array}{l}
PV_{agg} =  \sum_{j=1}^J C_j v^{K_{{\bf{x}}_j}+1}
\\
\mu_{PV_{agg}} = \sum_{j=1}^J C_j \sum_{k=0}^{\infty} v^{k+1} ~_k|q_{{\bf{x}}_j}
\\
\sigma_{PV_{agg}} = \sqrt{\sum_{j=1}^J \Big( \sum_{k=0}^{\infty} \left( C_j v^{k+1} \right)^2 ~_{k|}q_{{\bf{x}}_j} - \left( C_j \sum_{k=0}^{\infty} v^{k+1} ~_{k|}q_{{\bf{x}}_j} \right)^2} \Big)
\end{array}
(#eq:Benefit15)
$$

Even if the the insured policyholders are independent across all $j$, and the distribution of $K_{{\bf{x}}_j}$ is mathematically simple, we cannot determine the exact distribution of $PV_{agg}$. Further, the complication of the formulae of $\mu_{PV_{agg}}$ and $\sigma_{PV_{agg}}$ mean they are easy to miscalculate and are hence of questionable usefulness. Instead we use simulations to gain a greater understanding of the distribution of $PV_{agg}$. Whilst we do not go into detail on the mechanics of simulation in this text, in this context simulation involves repeatedly drawing random observations of $K_{{\bf{x}}_j}$ from the distributions of $K_{{\bf{x}}_j}$, and calculating equivalent observations of $PV_{agg}$ from Equation \@ref(eq:Benefit15).

<span style="color: red;">
**Structure discussion.**The concept of simulation will likely not be familiar to readers. Weâ€™ll need to think about how to present this to students and how much detail we wish to go into. DHW have an appendix on Monte Carlo simulation, although simulation is not widely used in the book. Weâ€™ll also need to think about how this would work for those only able to access the pdf version of the textbook.
</span>

<span style="color: blue;">
**Note for author to complete.** Below is Jed's placeholder of a simulation example. I haven't yet had time to update it for the whole of life insurance portfolio but will do so in future.
</span>

**Example `r chapnum`.1.1. Example - Indonesian Mortality.** (<span style="color: blue;">Adam, Emil. I assume that you will want to use one of Dani's mortality data sets going forward. This is a placeolder</span>) We consider mortality from Indonesia. Like many countries throughout the world, these are typically tabulated on an annual basis. To give you a feel for the data, we first convert these annual survival proabilities to ten year survival probability, assuming that a female live has survived to age 25.

`r HideRCode('Simulation.1',"R Code To Construct Survival Probabilities")`

```{r FirstSimulation1, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
library(knitr)
fem.Qx <- read.csv(file = "Data/IndonesianMortality.csv", header = TRUE)[,3]
numAge <- length(fem.Qx)
SurvProb <- rep(1, numAge)
for (x in 1:(numAge-1)) {SurvProb[x+1] <- SurvProb[x]*(1-fem.Qx[x])}
TenYearSurvProb25 <- c(SurvProb[25], SurvProb[35],SurvProb[45],SurvProb[55],SurvProb[65],SurvProb[75],SurvProb[85],SurvProb[95], 0)/SurvProb[25]
TenYearProbs <- TenYearSurvProb25[1:8]-TenYearSurvProb25[2:9] 
```

</div>

```{r FirstSimulation1a, ref.label = 'FirstSimulation1', echo = FALSE}
```

The ten year discounted values and probabilities are

`r HideRCode('Simulation.2',"R Code To Construct Discounted Values and Associated Probabilities")`

```{r FirstSimulation2, eval = FALSE}
i = 0.05
Probsout <- round(TenYearProbs,digits = 4)
# xout <- (1:length(Probsout))*10
# xout <- round(xout,digits=0)
TenYearPV = (1/(1+i)^10)^(1:length(TenYearProbs))
ProbsoutMat <- t(cbind(TenYearPV, Probsout))
ProbsoutMat <- round(ProbsoutMat,digits=4)
rownames(ProbsoutMat) <- c("Discounted Value", "Probs")
colnames(ProbsoutMat) <- c("10","20","30","40","50","60","70","80")
knitr::kable(ProbsoutMat)

```
</div>

```{r FirstSimulation2a, ref.label = 'FirstSimulation2', echo = FALSE}
```

We can simulate from these.


`r HideRCode('Simulation.3',"R Code For Simulation")`

```{r FirstSimulation, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
nsim = 500
# probs = c( 0.1, 0.3, 0.3, 0.2, 0.1)
# PV = (1/(1+i))^(1:length(probs))
# raws = sample(PV , size = nsim, replace = TRUE, prob = probs)
# head(raws)
# hist(raws)
# mean(raws)

TenYearSample = sample(TenYearPV, size = nsim, replace = TRUE, prob = TenYearProbs)
OneYearProbs <- SurvProb[25:(numAge-1)]-SurvProb[26:numAge] 
OneYearPV = (1/(1+i))^(1:length(OneYearProbs))
OneYearSample = sample(OneYearPV, size = nsim, replace = TRUE, prob = OneYearProbs)

par(mfrow=c(1,2))
hist(TenYearSample, main="") 
hist(OneYearSample, main="") 
```


</div>

```{r FirstSimulationa, ref.label = 'FirstSimulation', fig.cap = 'Present Value Distribution. The left-hand panel summarizes a simulated distribution based on ten-year outcomes. The right-hand panel displays the corresponding information based on annual outcomes.', fig.align = 'center', out.width = '55%', echo = FALSE}
```

Now, we can ask the student to do a number of things (and give the answers). Based on ten-year outcomes, one can do hand calculations. With a computer, you can do the same calculations but for the more realistic annual data.

***

<span style="color: purple;">
**To be resolved later.** Other important concepts to address in this or another chapter:

<span style="color: purple;">
-	 The relationship between life insurance and life annuities. The two are perfect natural hedge provided mortality is the same. If life policies mortality are different from annuitant mortality, the relationship breaks down. My instinct is that this goes in a later chapter.
-	The concept of discounting with life using pure endowment.
-	The recursive formula for the value from year to year - probably later as part of policy values.
</span>


<span style="color: purple;">
**To be resolved later.** It is recommended to include the following material in a separate chapter.  We could also include things like increasing annuities/insurance but I'm not really convinced about the benefits of these.
</span>

## The impact of self selection

<span style="color: purple;">
I have not yet included anything about selection effects, although this can be added to this section fairly easily. DHW donâ€™t have anything different in Chapter 4 for selection effects, but instead just have a short subsection nothing that the calculations are the same for selection but just use the select life table.
</span>

## Modelling contingent cash flows more frequently than annually

<span style="color: purple;"> This would reflect the 1/mthly case from DHW Chapter 4. Due to the length of this chapter we will need to consider if/how to split it up into additional chapters.  It is traditional to split life insurance and annuity chapters.  Iâ€™m not a big fan of this personally as in my opinion this splits concepts of valuation up were it really is not necessary.  An alternative option would be to have the material from here and continuous time be its own Chapter; i.e. we would generally focus on yearly payments only and this extra chapter would act as an aside to cover the 1/mthy and continuous structures.  We might also include in this additional chapter material on approximation (e.g. annual payments but made at exact time of death) and other adjustments such as indexation of payments. </span>


##	Modelling contingent cash flows in continuous time

<span style="color: green;"> See above. This could be expressed as when $m \rightarrow \infty$. We could provide examples from earlier in this Chapter as our starting point. We can also link this to the continuous models from Chapter 2 â€“ see for example how Makehamâ€™s rule is used in DHW Chapter 4. </span>

