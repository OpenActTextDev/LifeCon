# Contingent Payment Techniques {#C:BenefitExt}


$\require{enclose}$ <!-- Later equations only properly knit if this is beforehand once in the code -->

`r chapnum = 4`

*Chapter Preview.* We have now learned the foundations of life contingencies through Chapter \@ref(C:ModelingLifeTimes)  survival modeling and Chapter \@ref(C:SimpleBenefit) discounting of contingent cash flows. This chapter provide extensions and variations to exhibit the richness of applications.

Specifically, Section \@ref(Sec:mthlyFlows) presents a relatively minor extension theoretically, allowing for $m^{th}$ly cash flows, that has extensive practical ramifications for retirement benefits, other life contingent annuities, and premium payment plans. Section \@ref(Sec:SamplingBias) sharpens our intuition about survival modeling by linking the choice of a survival dataset to an application under consideration; when the link is not appropriate, important biases can arise. Section \@ref(Sec:EconomicMotivation) provides economic motivation for some of the measures summarizing insurance features introduced in Chapter \@ref(C:SimpleBenefit); this motivation provides insights as why some of these are so important in practice. Through a variety of examples, Section \@ref(Sec:ApplicationsContingent) emphasizes that the framework for life contingent benefits applies to contingent payment problems that go beyond applications restricted to the life insurance industry.


## Contingent Cash Flows Occurring $m^{th}$ly {#Sec:mthlyFlows}

***

In this section, you learn how to: 

*  Discount random cash flows where cash flows occur more frequently than once a year. 
*  Compute actuarial present values when mortality is available on a continuous basis.
*  Compute actuarial present values when mortality is available annually using a uniform distribution of deaths assumption.

***

This section extends Chapter \@ref(C:SimpleBenefit) by considering cases where cash flows occur more frequently than once a year. For example, it is common for retirement benefits to be paid on a monthly basis while a person is alive. As another example, premiums might be paid twice a year, as long as the policyholder is alive and the contract is in force. We use $m$ to denote the number of payments per year. For the retirement benefits example, we would use $m=12$ and for premiums, $m=2$. Other common examples are $m=4$ for quarterly cash flows, $m=52$ for weekly, and so forth. We will even consider the case where the number of payments becomes arbitrarily large, $m \to \infty$, corresponding to a cash flow at the moment an event such as death occurs.

When describing benefits paid discretely, we started in Chapter \@ref(C:SimpleBenefit) with annual payments because mortality tables have traditionally been presented on an integer age basis. In addition, business requirements such as insurance company financial reporting is done routinely on an annual basis. Nonetheless, as described above, there are also important situations where payments occur other than annually (typically more frequently, although payments once every, e.g., two years are certainly plausible).

### Basic Concepts {#Sec:BasicConceptsmthly}

To appreciate the concerns when transiting from an annual to an $m^{th}$ly basis, here is a modified version of Figure \@ref(fig:Benefit1a). 

(ref:Benefitm1) **Timeline of $m^{th}$ly cash flows with uncertainty** 

```{r Benefitm1a, fig.cap='(ref:Benefitm1)', fig.width=6, fig.height=2.0, echo = FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(2.5,7.5))

arrows(5,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(7,6.2,7,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(9,6.2,9,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8,code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Time")
text(5,7,"0/m")
text(7,7,"1/m")
text(9,7,"2/m")
text(11,7,"3/m")
text(13.5,7,"...")
text(1,5,"Discount")
text(5,5,1)
text(7,5,TeX("v^{1/m}"))
text(9,5,TeX("v^{2/m}"))
text(11,5,TeX("v^{3/m}"))
text(13.5,5,"...")
text(1,4,"      Potential Cash Flow")
text(5,4,TeX("_{0/m}C"))
text(7,4,TeX("_{1/m}C"))
text(9,4,TeX("_{2/m}C"))
text(11,4,TeX("_{3/m}C"))
text(13.5,4,"...")
text(1,3,"      Cash Flow Indicator")
text(5,3,TeX("_{0/m}B"))
text(7,3,TeX("_{1/m}B"))
text(9,3,TeX("_{2/m}B"))
text(11,3,TeX("_{3/m}B"))
text(13.5,3,"...")
box(col = 'lightblue')

```

Similar to equation \@ref(eq:Benefit2), the present value $PV$ random variable can be summarized as

$$
\begin{array}{l}
PV = \sum_{r=0}^{\infty} v^{r/m} ~_{r/m}C~_{r/m}B~   ~,\\
\end{array}
(\#eq:Benefitm2)
$$

using $r$ is a counter for the number of $m^{th}$ly units. For probabilities associated with the cash flow indicator, as we saw in Chapter 3, we are concerned with payments either at the death or the survival of a policyholder age $x$. That is,

$$
\mathrm{E} \left(_{r/m}B\right) = \left\{\begin{array}{ccc}
\Pr\left(\frac{r-1}{m} < T_x \le \frac{r}{m}\right) & = & ~_{(r-1)/m} p_x - ~_{r/m} p_x& {\small \text{ prob of death}} \\
\Pr\left(T_x \ge \frac{r}{m}\right) & =& ~_{r/m} p_x & {\small \text{ prob of survival} }.\\
\end{array}
\right.
(\#eq:ExpBenefitm2)
$$
As many readers will recall from their study of interest theory, if we think of a discount factor $v^t = (1 + ~_t i)^{-t}$ in terms of a spot rate of interest $~_t i$, then there is no difficulty at all in discounting at non-integer times. In addition, suppose that the survival model can be expressed in terms of continuous time, such as the analytic laws of mortality in Section \@ref(S:AnalMortLaws) or their extended versions in Section \@ref(S:SurvReg). In these cases, thinking of the unit of time as a year is a mere convenience and no additional theoretical extensions are required for handling $m^{th}$ly cash flows. 

**Uniform Distribution of Deaths.** Only in the case where we have annual mortality with $m^{th}$ly cash flows are some extensions required. And we already started on this in Section \@ref(S:LifeTabFrac) where fractional year assumptions were introduced. To see how this works with $m^{th}$ly cash flows, we use the uniform distribution of death (*UDD*) assumption so that we can express $~_t p_x = 1 - t \times q_x$, for $0 \le t \le 1$. Thus, using $j$ is a counter for the number of $m^{th}$ly units within a year, we have

$$
~_{j/m} p_x = 1- \frac{j}{m} \times q_x, \ \ \text{for } j= 0, 1, \ldots, m-1.
$$
For integer $k=0, 1, \dots$

$$
~_{k+j/m} p_x =  ~_k p_x \times ~_{j/m} p_{x+k}= ~_k p_x  \times \left(1- \frac{j}{m} \times q_{x+k}\right).
$$
Here, to calculate the probability of a life aged $x$ surviving $k+j/m$ years, we first calculated the probability of surviving $k$ (integer) years and then, conditional on having attained age $x+k$, applied the *UDD* assumption to calculate the probability of surviving an additional $j/m$ fraction of a year. These expressions, together with equations \@ref(eq:Benefitm2) and \@ref(eq:ExpBenefitm2), are enough to compute an expected present value for an $m^{th}$ly version of any of the Chapter \@ref(C:SimpleBenefit) cash flows.


### Illustrative Cash Flows

Let us see how these ideas work with a few illustrative examples. To begin, we start by assuming that we have a continuous time probability model and so no simplifying assumptions are needed.

<a id=tab:Ex4.11></a> 

[Example 4.1.1]: ../docs/C-BenefitExt.html##tab:Ex4.11

**Example 4.1.1. Whole Life Insurance with $m^{th}$ly Payments with Continuous Time Mortality**. For this contract, the benefit is paid at the end of the $m^{th}$ly period in which death occurs. Let us return to the familiar [Example 3.2] that used the Section \@ref(S:SurvReg) mortality. We consider the baseline case in [Example 3.2] that you will recall is  a healthy female who is not a smoker, not obese, and has an average blood pressure level equal to 114. The interest rate is a constant 4%.

To calculate the expected value of this policy, we may use equations \@ref(eq:Benefitm2) and \@ref(eq:ExpBenefitm2) directly with the potential cash flows identically equal to one $~_{k/m}C \equiv 1$. The resulting expected present value is

$$
\begin{array}{rl}
 A_{{\bf{x}}}^{(m)} &= \sum_{r=0}^{\infty} ~v^{(r+1)/m} \{ ~_{r/m} p_x - ~_{(r+1)/m} p_x \} ,\\
\end{array}
$$

an expression that introduces the common actuarial notation for the expected present value of this contract. The superscript $~^{(m)}$ denotes $m^{th}$ly cash flows. Figure \@ref(fig:MBaseLifeInsPlot) summarizes the expected presented values by age $x$ over choices of $m=1,2,4, 12$. As is evident from the plot, these values are close and in fact ordered as

$$
A_x = A_x^{(1)} \le A_x^{(2)} \le A_x^{(4)} \le A_x^{(12)} ~.
$$

The annual expected presented value, $A_x = A_x^{(1)}$, is the smallest because it is the contract with payments potentially farthest in the future. For example, if a person dies just before one month into a contract year, then the payment is 11 months after death. In contrast, it is five months after death when $m=2$, two months later for $m=4$ and virtually instantaneous for $m=12$. So, the very largest the separation that could be in Figure \@ref(fig:MBaseLifeInsPlot) is $1/(1+i) = 1/1.04 \approx 0.96$, suggesting that these expected present values will be close to one another.


```{r echo = FALSE}
#  Mortality Calculations
cons         <-  1e-6
time_fac     <-  -0.013078529
coeff_age    <-  0.11691 
coeff_male   <-  0.40359
coeff_bpress <-  0.01645
coeff_smok   <-  0.76798
coeff_obese  <-  0.24944 #BMI beyond 30

m.q.x.function <- function(time=65,m=2, male=0, bpress=114.06, smoke=0, obese=0){
  xage1 <- seq(from = 0, to = 120, by = 1/m)
  c.rate <- coeff_age+time_fac
  c.rate <- c.rate + (c.rate==0)*1e-12
  c.x <- cons*exp( coeff_male * male + coeff_bpress * bpress + 
                   coeff_smok * smoke + coeff_obese * obese +
                   time_fac * time + coeff_age * xage1 )
  m.q.x <- 1-exp(-c.x*((exp(c.rate/m)-1)/c.rate) )
  return(m.q.x)
}

#  Actuarial Present Value Calculations
numInt <- 0:(120-1)
int = 0.04
spotrate <- (1+int)^(-numInt)
APV <- function(m=2, m.q.x=m.q.x.female.2, spotrate=spotrate, int=0.04){
  xage2 <- seq(from = 0, to = 120, by = 1/m)
  #spot rate not used so far...
  v = 1/(1+int)
  vm = v^(1/m)
  num = length(xage2)
  A.x.m <- rep(0,num) -> add.x.m
  A.x.m[num] = vm * m.q.x[num]
  add.x.m[num] = 1 + (1- m.q.x[num])/(int + 1e-12)
  for (i in 1:(num-1)){
    A.x.m[num-i] = vm * m.q.x[num-i] + vm*(1-m.q.x[num-i])*A.x.m[num-i+1]
    add.x.m[num-i] = 1 + vm*(1-m.q.x[num-i])*add.x.m[num-i+1] 
  }
  tablelife.m <- cbind(xage2, m.q.x, A.x.m, add.x.m)
  tablelife.m.int <- subset(tablelife.m, xage2 == floor(xage2))
  return(tablelife.m.int)
}
```

(ref:MBaseLifeIns) **Life Insurance by $m^{th}$ly Payments**. The dark red dashed represents expected present values based on annual cash flows with $m=1$. The other lines are for $m=2, 4, 12$, increasing in that order.


```{r MBaseLifeInsPlot, fig.cap='(ref:MBaseLifeIns)', fig.width=6, fig.height=2.25, echo=FALSE}
# Male vs Female
m.q.x.female.1 <-  m.q.x.function(male=0,  m=1)
A.x.m.female.1 <-  APV(m.q.x=m.q.x.female.1, m=1)[,3]
m.q.x.female.2 <-  m.q.x.function(male=0,  m=2)
A.x.m.female.2 <-  APV(m.q.x=m.q.x.female.2, m=2)[,3]
m.q.x.female.4 <-  m.q.x.function(male=0,  m=4)
A.x.m.female.4 <-  APV(m.q.x=m.q.x.female.4, m=4)[,3]
m.q.x.female.12 <- m.q.x.function(male=0,  m=12)
A.x.m.female.12 <- APV(m.q.x=m.q.x.female.12, m=12)[,3]
xage.int <- seq(from = 0, to = 120)
dataf <- data.frame(cbind(xage.int, A.x.m.female.1, A.x.m.female.2,
                                    A.x.m.female.4, A.x.m.female.12))
p1 <- ggplot(dataf,aes(x=xage.int, y=A.x.m.female.1)) + theme_bw() +
  geom_line(aes(y = A.x.m.female.1),  color = "darkred", linetype="twodash") +
  geom_line(aes(y = A.x.m.female.2),  color = "darkblue") +
  geom_line(aes(y = A.x.m.female.4),  color = "green") +
  geom_line(aes(y = A.x.m.female.12), color = "pink") +
  #ggtitle("Males vs Females") +
  xlab("Age") + ylab(expression(A[x]))+
  coord_cartesian(xlim =c(60,70), ylim =c(0.35,0.52)) #+
  # scale_y_continuous(trans='log10')

p1

```



<a id=tab:Ex4.2></a> 

[Example 4.1.2]: ../docs/C-BenefitExt.html##tab:Ex4.12

**Example 4.1.2. Whole Life Insurance with $m^{th}$ly Payments with Annual Mortality**. Continuing [Example 4.1.1], we no longer assume that a continuous time mortality model is available but we have only traditional life table mortality at integer (or annual) ages. 

To calculate the expected value of the policy, we follow the procedure of splitting up the payment stream into yearly intervals and then applying the *UDD* assumption within each year. The details follow.

$$
\begin{array}{rl}
 A_{{\bf{x}}}^{(m)} &= \sum_{r=0}^{\infty} ~v^{(r+1)/m} \{ ~_{r/m} p_x - ~_{(r+1)/m} p_x \} \\
 &= \ \sum_{k=0}^{\infty} \sum_{j=0}^{m-1} v^{k+(j+1)/m} \{ ~_{k+j/m} p_x - ~_{k+(j+1)/m} p_x \} \\
 &=_{UDD} \sum_{k=0}^{\infty}  ~_k p_x \left\{\sum_{j=0}^{m-1} v^{k+(j+1)/m}  \left( \frac{1}{m} \times q_{x+k}\right) \right\} \\
  &= \sum_{k=0}^{\infty}  ~_k p_x ~q_{x+k} \left\{\frac{1}{m} \sum_{j=0}^{m-1} v^{k+(j+1)/m}  \right\} ~.\\
\end{array}
$$

To simplify the presentation, we further assume a constant spot rate $i$ so that $v^t =(1+i)^{-t}$. With this, we can employ standard geometric sums that many readers will recall from interest theory,

$$
\frac{1+i}{m} v^{1/m}\sum_{j=0}^{m-1} v^{j/m} = \frac{1+i}{m}v^{1/m}\frac{1-v}{1-v^{1/m}} = \frac{i}{i^{(m)}} ~, \\
$$

where $i^{(m)} = m\left[(1+i)^{1/m}-1\right]$ is the actuarial symbol for a $m^{th}$ly interest rate. 
This yields

$$
 A_{{\bf{x}}}^{(m)} = \frac{i}{i^{(m)}} A_x ~.
$$

This equation exhibits a constant relationship between the annual expected value of a whole life insurance and one on an $m^{th}$ly basis. Also from interest theory, a simple (Taylor series) approximation shows that $\frac{i}{i^{(m)}} \approx 1 + \frac{i}{2}(1-\frac{1}{m})$, indicating the proximity between these expected present values.


<a id=tab:Ex4.13></a> 

[Example 4.1.3]: ../docs/C-BenefitExt.html##tab:Ex4.13

**Example 4.1.3. Term Life Annuity with $m^{th}$ly Payments**. For a more complex example, we now consider the case of an $n$ year term life annuity with $m^{th}$ly payments in advance. By convention, when presenting actuarial annuity symbols, each payment (when the person is alive) is assumed to be $~_{r/m}C \equiv 1/m$, not 1. This is so that we can readily compare annuities with different payment plans, for example, quarterly to monthly payments, because they both pay a sum of 1 over the year if the annuitant survives.

Based on equation \@ref(eq:Benefitm2), and similar to equation \@ref(eq:Benefit13), the random present value of payments is $PV  =  \frac{1}{m} \sum_{r=0}^{nm-1} v^{r/m} ~I(T_{\bf{x}} \ge r/m)$. With this and equation \@ref(eq:ExpBenefitm2), the expected present value is

$$
\begin{array}{rl}
 \ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}}^{(m)} 
 &= \frac{1}{m} \sum_{k=0}^{n-1} \left\{\sum_{j=0}^{m-1} v^{k+j/m} ~_{k+j/m}p_{\bf{x}}\right\} \\
 &=_{UDD} \frac{1}{m} \sum_{k=0}^{n-1}  ~_k p_x \left\{\sum_{j=0}^{m-1} v^{k+j/m}  \left(1- \frac{j}{m} \times q_{x+k}\right) \right\} ~.\\
\end{array}
$$

To simplify the presentation, we again assume a constant spot rate $i$ so that $v^t =(1+i)^{-t}$. After some pleasant algebra, one can show that

$$
\begin{array}{rl}
\ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}}^{(m)} 
 &=_{UDD}  \frac{d}{d^{(m)}}  \ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}} -
v ~\beta(m) A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1} ~,\\
\end{array}
$$
where $d^{(m)} = m\left[1- v^{1/m}\right]$ is an $m^{th}$ly discount factor and $\beta(m) = \frac{i-i^{(m)}}{i^{(m)}d^{(m)}}$ is another factor based only on the interest rate, not the survival model. You can check, either using Taylor series approximations or by calculating using several values of $m$ and $i$, that $\beta(m) \approx \frac{m-1}{2m}$, an approximation that is very useful for interpreting this expected present value.


`r HideProofTheory('MthlyPaym.1',"Verify Development of EPV for Term Life Annuity with mthly Payments")`

First recall some standard notation from interest theory:

$$
\begin{array}{cccccc}
i^{(m)} = m\left[(1+i)^{1/m}-1\right] & & d^{(m)} = m\left[1- v^{1/m}\right] \\
\alpha(m) = \frac{i}{i^{(m)}}\frac{d}{d^{(m)}}  & & \beta(m) = \frac{i-i^{(m)}}{i^{(m)}d^{(m)}} \\
\end{array}
$$

Next, from standard geometric sums employed in interest theory, we have

$$
\begin{array}{cccccc}
\frac{1}{m}\sum_{j=0}^{m-1} v^{j/m} &=& \frac{1}{m}\frac{1-v}{1-v^{1/m}} & = \frac{d}{d^{(m)}} \\
\end{array}
$$

and
$$
\begin{array}{cccccc}
\frac{1}{m}\sum_{j=0}^{m-1} j~v^{j/m} &=& \frac{v^{1/m}}{m} \frac{1-v}{(1-v^{1/m})^2} - \frac{v}{1-v^{1/m}} \\
&=& \frac{v^{1/m}}{(1-v^{1/m})} \frac{d}{d^{(m)}} - \frac{mv}{d^{(m)}} \\
&=& \frac{m}{i^{(m)}} \frac{d}{d^{(m)}} - \frac{mv}{d^{(m)}} \\
&=& mv \left(  \frac{i}{i^{(m)}d^{(m)}} - \frac{1}{d^{(m)}} \right) \\
&=& mv ~\beta(m) \\
\end{array}
$$

```{r echo = FALSE, eval = FALSE}
#check these expressions
m=12
i = 0.04
v = 1/(1+i)
Time = 0:(m-1)
vj = v^(Time/m)
sum(vj)/m
sum(Time*vj)/m
(1-v)/m/(1-v^(1/m))
(v^(1/m)/m*(1-v))/(1-v^(1/m))^2 - v/(1-v^(1/m))

m.vec = c(1,2,4, 12, 52, 365)
im.vec = m.vec*((1+i)^(1/m.vec)-1)
i/im.vec
1+(i/2)*(1-1/m.vec)
dm.vec = m.vec*(1-v^(1/m.vec))
betam.vec = (i-im.vec)/(im.vec*dm.vec)
round(betam.vec, digits = 6)
(m.vec-1)/(2*m.vec)

```

This yields


$$
\begin{array}{rl}
\ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}}^{(m)} 
 &=_{UDD} \frac{d}{d^{(m)}}  \sum_{k=0}^{n-1}  v^{k} ~_k p_x -
 mv ~\beta(m) \frac{1}{m} \sum_{k=0}^{n-1}  ~_k p_x q_{x+k} \\
 &= \frac{d}{d^{(m)}}  \ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}} -
v ~\beta(m) A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1} \\
  &\approx \ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}} -  \frac{m-1}{2m} . \\
\end{array}
$$


</div>

### Contingent Cash Flows in Continuous Time

By cash flows in "continuous time," we are thinking of a situation where $m$ becomes arbitrarily large. So, we could start with monthly ($m=12$), go to weekly ($m=52$), proceed to daily ($m=365$), and so forth. As we will see, there is little difference between a contract with daily payments versus instantaneous payments. However, the model with instantaneous payments ($m=\infty$) is actually easier because we do not have to distinguish between payments at the beginning versus the end of the period.

Models with instantaneous payments are easier to interpret and analyze in life insurance in contrast to life annuities. Because insurers typically pay benefits quickly upon the death of a policyholder, a model with payments at the moment of death is a better approximation than one that pays at the end of the year ($m=1$). Theoretically, one can think of a continuous life annuity as an approximation to a life annuity that pays 1/365 on a daily basis. However, given that life annuities are predominantly employed on a monthly ($m=12$) and quarterly ($m=4$) basis, we focus our attention on life insurance products in continuous time.

It is possible to express present value random variables using a limit of equation \@ref(eq:Benefitm2) but it is much cleaner to simply utilize the moment of death random variable $T_x$ with basic contract definitions, as follows:

$$
PV = \left\{
\begin{array}{cc}
v^{T_{\bf x}} & {\text{whole life}} \\
v^{T_{\bf x}}I(T_{\bf x} \le n) & {n\text{ year term}} \\
v^n I(T_{\bf x} >n) & {n\text{ year pure endowment}} \\
v^{T_{\bf x}}I(T_{\bf x} \le n) +v^n I(T_{\bf x} >n) & {n\text{ year  endowment}}.\\
\end{array}
\right.
$$

Expected present values can be readily determined using first principles. To illustrate, for a whole life insurance that pays at the moment of death, we have

$$
E(PV) = \int_0^{\infty} ~ v^t ~_t p_x \mu_{x+t} dt = \bar{A}_x .
$$

For notation, we could use $~^{(\infty)}$ to signify payments with an infinite number of payment periods. However, it is traditional and part of International Actuarial Notation to use a bar ($\bar{\cdot}$) to denote payments at the moment of death. See Appendix Section \@ref(Sec:NotConv:Halo) for more on actuarial notation.

Similarly for an $n$ year endowment, we have 

$$
\begin{array}{ll}
E(PV) 
&= \int_0^n ~ v^t ~_t p_x \mu_{x+t} dt  + \int_n^{\infty} ~ v^n ~_t p_x \mu_{x+t} dt  \\
&= \int_0^n ~ v^t ~_t p_x \mu_{x+t} dt  +  v^n ~_n p_x   \\
& = \bar{A}_{{\bf{x}}:\enclose{actuarial}{n}} .
\end{array}
$$

When a continuous time probability model is available, then these integrals can be computed directly (although they sometimes require numerical integration software). An alternative approach is to use the approximations based on $m^{th}$ly payments introduced in the prior section and let $m \to \infty$. For example, for the whole life assuming *UDD*, we have

$$
\bar{A}_x = \lim_{m \to \infty} A_x^{(m)} = \lim_{m \to \infty} \frac{i}{i^{(m)}} A_x = \frac{i}{\delta} A_x ,
$$

where $\delta = \ln(1+i) = \lim_{m \to \infty}i^{(m)}$ is the force of interest, from interest theory.


`r HideExample('JedDiscussion.1',"Section Structure Discussions")`

<span style="color: blue;">
**Structure discussion.** 

</span>

This section is general in the sense that it:

*  integrates both life and annuity contracts under one umbrella
*  readily allows variable interest rates and continuous time mortality without making assumptions such as UDD

**However**. It does not relate insurance to annuity coverages. It only does second moments indirectly. It does not provide details for many contracts.

At this stage, not sure how far to push this because I don't know how important the topic is relative to the other material...

Probably could use **lots** of exercises.

***

*  Introduce classical actuarial PV symbols, variance calculations
*  Calculation approaches
   *  Start with continuous time hazard survival models 
   *  Describe approximations based on life table functions
   *  Differential equations? Continuous analog to the recursive formulas of insurances/annuities. (Develop this in the problem set).

***

*  Use life annuities to motivate why it matters to account for more frequent premium and benefit payments
*  Use life insurance to motivate why it a continuous payment model is a useful approximation (e.g., contractually obligated to settle payment immediately, subject to death confirmation)

***


*  Review the present value random variable and moments. Draw timeline with more frequent payments.
*  Introduce mthly insurances and annuities, as well as their relationship 
*  Introduce classical actuarial PV symbols, variance calculations
*  Why is the frequency important? Demonstrate magnitude of difference in expected present values of payments (e.g., make a table of EPV vs various m) (without showing how calculations are done)

***

*  Describe implementation using the continuous time Cox hazard model 
*  When life table is used, interim timing can be approximated via UDD, exponential. Possible extensions (or in appendices, problem sets):
   *  Does UDD work for all ages or covariates? Is there need to empirically investigate using our available data?
   *  Should we further explore other approximations using the model T_x = K_x +R_x, where R_x is the fractional term?
   *  Approximations of life annuities based on Woolhouse. Derivation is via Taylor’s expansion. (might also be an exercise)

</div>

##  Sampling Bias {#Sec:SamplingBias}

***

In this section, you learn how to:

*  Describe different subpopulations that are commonly used in actuarial practice, including variations by country and by areas of practice (insured lives, annuitant, and general population).
*  Interpret how using different subpoplulations may result in a sampling bias.
*  Quantify the impact of sampling bias on actuarial present values.

***

In Chapter \@ref(C:ModelingLifeTimes) we saw that survival distributions, expressed as mortality rates, can vary not only by age and sex but also by other attributes such as smoking status, systolic blood pressure, and so forth. This naturally raises the question as whether these attributes are important in actuarial practice. To frame this question, this section reviews the statistical concept of sampling bias in the context of actuarial applications.

###  Population Subsets and Sampling Bias

To illustrate differences among different samples, or subsets of a population, we consider three samples commonly used in actuarial practice:

*  insured lives, individuals who have purchased life insurance,
*  annuitant or pensioner lives, individuals who have either purchased an annuity or are a pensioner and so enjoy an annuity by participating in a retirement system, and a
*  general population, where there is no requirement for insurance/annuity participation.

To compare these three samples, we examine a specific case.

<a id=tab:Ex4.21></a> 

[Example 4.2.1]: ../docs/C-BenefitExt.html##tab:Ex4.21

**Example 4.2.1. Korean Mortality by Insured Status.** Here, we consider female mortality from South Korea for year 2007. The insured lives and annuitant rates were drawn from a database organized by the Society of Actuaries, [https://mort.soa.org/](https://mort.soa.org/).
The general population data are drawn from the [Human Mortality Database](http://www.mortality.org/).


```{r  echo=FALSE}
KoreaInsuredFemale <- read.csv("Data/SKoreaInsuredLives2007Female.csv")
KoreaPensionFemale <- read.csv("Data/SKoreaPensions2007Female.csv")
KoreaPop <- read.csv("Data/KoreaMx_1x1.csv")
KoreaPop2007 <- subset(KoreaPop, Year == 2007)

KoreaInsuredFemale45.110  <- subset(KoreaInsuredFemale, Age > 44 & Age < 111) 
KoreaPensionFemale45.110  <- subset(KoreaPensionFemale, Age > 44 & Age < 111) 
KoreaPop45.110  <- subset(KoreaPop2007, Age > 44 & Age < 111) 
KoreaPopFemaleqx <- KoreaPop45.110$Female/(1 + KoreaPop45.110$Female/2)

KoreaMort <- data.frame(cbind(KoreaInsuredFemale45.110$Age, KoreaInsuredFemale45.110$qx, KoreaPensionFemale45.110$qx, KoreaPopFemaleqx))
names(KoreaMort) <- c("Age", "qx_Female_Insured", "qx_Female_Pension", "qx_Female_Pop")
#  Actuarial Present Value Calculations
APV.K <- function(xage, q.x, int=0.00){
  v = 1/(1+int)
  num = length(xage)
  A.x <- 0*xage -> add.x -> e.x
  A.x[num] = v*q.x[num]
  add.x[num] = 1 + (1-q.x[num])/(int + 1e-12)
  e.x[num] = 1-q.x[num]
  for (i in 1:(num-1)){
    A.x[num-i] = v*q.x[num-i] + v*(1-q.x[num-i])*A.x[num-i+1]
    add.x[num-i] = 1 + v*(1-q.x[num-i])*add.x[num-i+1] 
    e.x[num-i] =  (1-q.x[num-i])*(1+e.x[num-i+1])
    }
  tablelife <- cbind(xage,q.x,A.x,add.x,e.x)
  return(tablelife)
}
KoreaMort$ex_Female_Insured <- APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Insured)[,5]
KoreaMort$ex_Female_Pension <- APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Pension)[,5]
KoreaMort$ex_Female_Pop     <- APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Pop)[,5]

```



(ref:SampBiasCompare) **Mortality by Insured Status**. The left-hand panel summarizes mortality by one year rates $q_x$ by age $x$, the right-hand panel shows it by expectation of life $e_x$. Both panels show three sampling frames: the solid black line is for insured lives, the dark-red dashed lines is for pension (annuitant) lives, and the dotted blue line represents the general population.

(ref:SampBiasCompare1) testy


```{r SampBiasComparePlot, fig.cap=c('(ref:SampBiasCompare)','(ref:SampBiasCompare1)'), fig.align = "center", echo=FALSE, warning = FALSE}
library(ggplot2)
library(gridExtra)
#  One year Mortality
p1 <- ggplot(KoreaMort,aes(x=Age, y=KoreaMort$qx_Female_Insured)) + theme_bw() +
    geom_line(aes(y = qx_Female_Insured), color = "black") +
  geom_line(aes(y = qx_Female_Pension), color = "darkred", linetype="twodash") +
  geom_line(aes(y = qx_Female_Pop), color = "darkblue", linetype="dotted") +
  ggtitle("One Year Mortality Rates") +
  xlab("Age") + ylab(expression(q[x]))+
  coord_cartesian(xlim =c(40,110)) +
   scale_y_continuous(trans='log10')

# Expectations
p2 <-  ggplot(KoreaMort,aes(x=Age, y=KoreaMort$ex_Female_Insured)) + theme_bw() +
    geom_line(aes(y = ex_Female_Insured), color = "black") +
  geom_line(aes(y = ex_Female_Pension), color = "darkred", linetype="twodash") +
  geom_line(aes(y = ex_Female_Pop), color = "darkblue", linetype="dotted") +
  ggtitle("Expectation of Life") +
  xlab("Age") + ylab(expression(e[x]))+
   coord_cartesian(xlim =c(40,110)) #+
   #scale_y_continuous(trans='log10')

grid.arrange(p1,p2,nrow=1)

```


Figure \@ref(fig:SampBiasComparePlot) compares these three samples using one year mortality rates $q_x$ and expectation of life $e_x$. Except for the highest ages where data are less reliable, the left-hand panel shows that pensioner (annuitant) mortality is the lowest among the three, followed by insured lives, and then the general population. The right-hand panel shows the same pattern, with pensioners enjoying the longest life expectancy and the general population showing the lowest. 

These patterns are commonly observed in actuarial practice. Individuals electing to purchase an annuity, or choosing an annuity option at retirement, generally consider themselves to be in good health. If they are in poor health, then they would not take on a contract that pays as long as they live. One might also elect to apply that same logic to the purchase of life insurance; that is, reason that only those who are in poor health purchase life insurance. However, insurers typically require individuals applying for life insurance to take a medical examination. So, by this selection mechanism, mortality for insured lives is also better than the general population.

***


In the language of statistics, a sampling error occurs when the sampling frame, the list from which the sample is drawn, is not an adequate approximation of the population of interest. A sample must be a representative subset of a population, or universe, of interest. An example of a representative subset is a sample drawn at random. With substantial sample errors, the summary measure of the sample, the statistic, is not an adequate approximation of the corresponding summary measure of the population, the difference defined as a **bias**. If the sample is not representative, taking a larger sample does not eliminate bias, as the same mistake is repeated over again and again.

So, using data from a sample that is not representative of a population of interest can result in **sampling bias**. For example, an analyst investigating an insurance product might use (typically convenient) population mortality instead of a more appropriate insured lives mortality; this mismatch results in sampling bias. As an another example, one might use insured lives mortality in lieu of pensioner mortality when valuing a retirement option for an insurance product. It is also common to use experience from one country to approximate outcomes in another. To illustrate, the following example compares experience among Poland, Japan, and the United States.

<a id=tab:Ex4.22></a> 

[Example 4.2.2]: ../docs/C-BenefitExt.html##tab:Ex4.22

**Example 4.2.2. Mortality by Country (Japan, Poland, and the United States).** This example focuses on population mortality and so recent 2019 experience is available from the [Human Mortality Database](http://www.mortality.org/). In addition to classification by country, we also look at experience by sex and age as these distinctions are well known.

Figure \@ref(fig:SampIntlCompare) compares one year mortality rates among the three countries; the left-hand panel is for female experience and the right-hand is for males. Both panels demonstrate that Japan has the lowest mortality rates. The relationship between the United States and Poland is more complicated. For females, experience is roughly the same for ages above 50 although Poland has lower mortality rates for younger females. Younger polish men also have lower mortality rates than men in the US but the reverse is true for those older (than approximately 45).


```{r  echo=FALSE}
JapanPop <- read.csv("Data/JapanPopulationMx_1x1.csv", stringsAsFactors=FALSE)
PolandPop <- read.csv("Data/PolandPopulationMx_1x1.csv", stringsAsFactors=FALSE)
USAPop <- read.csv("Data/USAPopulationMx_1x1.csv", stringsAsFactors=FALSE)
JapanPop2019 <- subset(JapanPop, Year == 2019)
PolandPop2019 <- subset(PolandPop, Year == 2019)
USAPop2019 <- subset(USAPop, Year == 2019)

JapanPopFemaleqx  <- as.numeric(JapanPop2019$Female) /(1 + as.numeric(JapanPop2019$Female) /2)
JapanPopMaleqx    <- as.numeric(JapanPop2019$Male)   /(1 + as.numeric(JapanPop2019$Male)   /2)
PolandPopFemaleqx <- as.numeric(PolandPop2019$Female)/(1 + as.numeric(PolandPop2019$Female)/2)
PolandPopMaleqx   <- as.numeric(PolandPop2019$Male)  /(1 + as.numeric(PolandPop2019$Male)  /2)
USAPopFemaleqx    <- as.numeric(USAPop2019$Female)   /(1 + as.numeric(USAPop2019$Female)   /2)
USAPopMaleqx      <- as.numeric(USAPop2019$Male)     /(1 + as.numeric(USAPop2019$Male)     /2)

PolandPopMaleqx[110] <- 1 -> PolandPopMaleqx[111]

IntlMort <- data.frame(cbind(JapanPop2019$Age, JapanPopFemaleqx, JapanPopMaleqx, PolandPopFemaleqx,
                             PolandPopMaleqx, USAPopFemaleqx, USAPopMaleqx))
names(IntlMort) <- c("Age", "qx_Female_Japan", "qx_Male_Japan", "qx_Female_Poland", 
                            "qx_Male_Poland",  "qx_Female_USA", "qx_Male_USA")
#str(IntlMort)

```


(ref:SampIntlCompare) **2019 Mortality Rates by Country**. Both panels show three countries that represent different sampling frames: the solid black line is for Japan, the dark-red dashed line is for Poland, and the dark-blue dotted line represents the United States. The left-hand panel summarizes female mortality, the right-hand panel represents males. 

(ref:SampIntlCompare1) testy

```{r SampIntlCompare, fig.cap=c('(ref:SampIntlCompare)','(ref:SampIntlCompare1)'), fig.align = "center", echo=FALSE}
library(ggplot2)
library(gridExtra)
p1 <- ggplot(IntlMort,aes(x=Age, y=qx_Female_Japan)) + theme_bw() +
  geom_line(aes(y = qx_Female_Japan), color = "black") +
  geom_line(aes(y = PolandPopFemaleqx), color = "darkred", linetype="twodash") +
  geom_line(aes(y = USAPopFemaleqx), color = "darkblue", linetype="dotted") +
  ggtitle("Female Mortality Rates") +
  xlab("Age") + ylab(expression(q[x]))+
  coord_cartesian(xlim =c(10,100)) +
   scale_y_continuous(trans='log10')

p2 <- ggplot(IntlMort,aes(x=Age, y=qx_Male_Japan)) + theme_bw() +
  geom_line(aes(y = qx_Male_Japan), color = "black") +
  geom_line(aes(y = PolandPopMaleqx), color = "darkred", linetype="twodash") +
  geom_line(aes(y = USAPopMaleqx), color = "darkblue", linetype="dotted") +
  ggtitle("Male Mortality Rates") +
  xlab("Age") + ylab(expression(q[x]))+
  coord_cartesian(xlim =c(10,100)) +
   scale_y_continuous(trans='log10')

grid.arrange(p1,p2,nrow=1)

```

***

Although we did not explicitly mention the sample sizes in Examples 4.2.1 and 4.2.2, they are large, and so do not confuse the issue of sampling bias with the uncertainty that arises from small data sets. The relationships observed among annuitants, insured lives, and general population as well as among countries demonstrated in these examples are commonly observed.  To substantiate this claim, mortality rates from around the world are readily available at [https://mort.soa.org/](https://mort.soa.org/) and [Human Mortality Database](http://www.mortality.org/). Readers are encouraged to visit these primary sources and follow up with their own analyses.


 

### Sampling Bias in Actuarial Practice

In the prior subsection, we defined the concept of sampling bias and established that it could be a real concern in commonly encountered applications. However, you might have noticed that the vertical axes in the one year mortality rate graphs in Examples 4.2.1 and 4.2.2 are on a logarithmic scale. So the discrepancies among sampling bases seem real but how important are they in actuarial applications?

To get insights into this question, we can use the different mortality distributions and, with the tools we learned in Chapter 3, express them in terms of expected present values.

**Example 4.2.1. Mortality by Insured Status - Continued.** We use the female South Korean mortality experience introduced in [Example 4.2.1] and, for illustration purposes, assume $i=4$%. For many new products or regions in the world with less detailed mortality data, it is common to use population mortality data in lieu of more appropriate insured lives or annuitant data. So, using population data, we first compute expected present values for a whole life insurance ($A_x^{pop}$) and for a life annuity due ($\ddot{a}_x^{pop}$). Next, with the insured lives data, we compute the expected present values for a whole life insurance ($A_x^{ins}$). Lastly, with the annuitant lives data, we compute the expected present values for a life annuity due ($\ddot{a}_x^{ann}$).

Figure \@ref(fig:SampPopCompare) summarizes the discrepancies by reporting the ratios. The left-hand panel shows the ratio $A_x^{ins}/A_x^{pop}$. Except for the very high ages, we see that the ratio is considerably less than one. This is consistent with our earlier observations that population mortality is higher than insured lives mortality. If we think of the expected present values as representing prices (as developed in the next section), then the ratio also provides a basis for the analyst to decide whether the difference is important. Many insurance markets are competitive and one calculation basis being 90% of the other represents an important financial difference.

The right-hand panel is the ratio $\ddot{a}_x^{ann}/\ddot{a}_x^{pop}$. Here, the value of annuity under annuitant lives mortality is higher than that under general population mortality. This is consistent with our earlier observations that population mortality is higher than annuitant lives mortality. As with the insurance ratio, for many marketplaces this difference is financially meaningful.


```{r echo = FALSE}

KoreaMort$ex_Female_Insured <- APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Insured)[,5]
KoreaMort$ex_Female_Pension <- APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Pension)[,5]
KoreaMort$ex_Female_Pop     <- APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Pop)[,5]

ratioIns <- APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Insured, int=0.04)[,3] / 
            APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Pop, int=0.04)[,3]
ratioAnn <- APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Insured, int=0.04)[,4] / 
            APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Pop, int=0.04)[,4]
IdentOne <- APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Insured, int=0.04)[,3] + (0.04/1.04) *APV.K(xage= KoreaMort$Age, q.x=KoreaMort$qx_Female_Pension, int=0.04)[,4] 

```

(ref:SampPopCompare) **Dependence of Expected Present Values on Insured Status**. The left-hand panel provides a ratio of $A_x$ computed using insured lives mortality to that computed using general population mortality. The right-hand panel provides a ratio of $\ddot{a}_x$ computed using annuitant lives mortality to that computed using general population mortality. 

(ref:SampPopCompare1) testy

```{r SampPopCompare, fig.cap=c('(ref:SampPopCompare)','(ref:SampPopCompare1)'), fig.align = "center", echo=FALSE}
library(ggplot2)
library(gridExtra)
p1 <- ggplot(KoreaMort,aes(x=Age, y=ratioIns)) + theme_bw() +
    geom_line(aes(y = ratioIns), color = "black") +
  ggtitle("Insurance Ratio") +
  xlab("Age") + ylab("ratio")+
  coord_cartesian(xlim =c(45,100),ylim=c(0.7,1.2)) 

p2 <- ggplot(KoreaMort,aes(x=Age, y=ratioAnn)) + theme_bw() +
    geom_line(aes(y = ratioAnn), color = "black") +
  ggtitle("Annuity Ratio") +
  xlab("Age") + ylab("ratio")+
  coord_cartesian(xlim =c(45,100), ylim=c(0.7,1.2)) 

grid.arrange(p1,p2,nrow=1)

```

***

An annuity product pays benefits while an individual is alive whereas an insurance product pays benefits upon the death of an insured. So, to a certain extent, these two products offset one another. In financial terms, you can think about an annuity (based on an individual's survival) as a hedge for insurance (based on an individual's mortality). In the following Chapter 5 on premiums, we will take advantage of relationships of the form:

$$
A_x + d \ddot{a}_x = 1.
(#eq:EqSum)
$$

This is an exact relationship between the expected present values. However, this relationship holds under the assumption that the insurance and annuity expected present values use the same mortality. To dispel the notion that this holds more generally, Figure \@ref(fig:SampIdentical) shows the sum $A_x^{ins} + d \ddot{a}_x^{ann}$, computed using the mortality and interest assumptions in [Example 4.2.1].


(ref:SampIdentical) **The Sum $A_x^{ins} + d \ddot{a}_x^{ann}$**. This sum is plotted versus age $x$ and is clearly not identical to one, as suggested by equation \@ref(eq:EqSum).

```{r SampIdentical, fig.cap='(ref:SampIdentical)', fig.align = "center", out.width = '30%', echo=FALSE}
library(ggplot2)

ggplot(KoreaMort,aes(x=Age, y=IdentOne)) + theme_bw() +
    geom_line(aes(y = IdentOne), color = "black") +
  # ggtitle(expression(A[x] + d a[x] = 1)) +
  xlab("Age") + ylab("Identically One")+
  coord_cartesian(xlim =c(45,100),ylim=c(0.95,1.15)) 

```


**Exercise** Quantify the use of annuity mortality applied to life insurance, and vice-versa, as examples.

$\require{enclose}$ <!-- Later equations only properly knit if this is beforehand once in the code -->

***

We motivated this section  by questioning whether attributes such as smoking status and systolic blood pressure are important in actuarial practice. In the exercises, readers have the opportunity to determine expected present values of life contingent benefits that vary by these attributes. In this section, we learned we can attribute these discrepancies to differences among population subsets. In the next section, we frame the question of importance in terms of economic interpretations of the expected present values.


**Exercises** Quantify expected present values of life contingent benefits that vary by smoking status and systolic blood pressure.


## Using Economics to Motivate Insurance Features {#Sec:EconomicMotivation}

***

In this section, you learn how to:

*  Interpret the expectation of a random present value as an actuarial present value.
*  Define adverse selection and explain how select and ultimate mortality tables provide protection against adverse selection.
*  Describe moral hazard with examples from life insurance and explain how it relates to information asymmetry.

***


### Actuarially Fair Prices and Risk Classification {#Sec:ActuarialFairRiskClass}

You may have noticed in Chapter 3 that we paid special attention to the expected present values  associated with random life contingent benefits and even gave them special symbols such as $A_x$ and $\ddot{a}_x$. This is because insurance prices are based on these expectation of losses, a concept known as an **actuarially fair price**. 

In a simple model, an actuarially fair price is the result of an assumption of zero profits. Specifically, imagine a homogeneous population where all potential insureds have the same distribution of losses.

*  If an insurer charges the expected loss to each insured, then the average profit over many such contracts would be zero by the law of large numbers. If there is only one insurer, then the company has a monopoly and so would charge more than this. It would charge the maximum that consumers are willing to pay (known as first degree price discrimination). 
*  If another company wishes to enter the marketplace, then it would charge something less than that maximum. With this price, it would take business away from the original insurer but still make a long-run profit if the price exceeds the expectation. 
*  However, competition in the marketplace will lead the original company to undercut, and so on.
*  In the end, all profits will be competed away and – because of price competition – the companies will offer products at their expected value. 


One can also interpret fairness from a social justice perspective. One can imagine a group of individuals forming a risk class pooling their losses. Through the pooling mechanism, each person is no longer responsible for their individual loss but rather for their share of the pool's combined loss. From a moral perspective, the responsibility for the loss can now be thought of as not due to the behavior of the faulty individual but rather attributed to the collective; in this sense, pooling socializes responsibility and  creates a sense of shared responsibility among a group of people. 

This, combined with a certain understanding of equality and justice, creates a type of insurance solidarity. It is not the same type of solidarity that one thinks of in political movements, which embody a conscious identification with the group, emotional bonds, shared values and beliefs, and so forth. It is solidarity that emphasizes mutual responsibility, reciprocity, and a particular shared understanding of fairness. From this understanding of fairness comes the observation that if members of the pool have the same risk distribution when entering the pool, then they should have the same responsibility for the pool losses. As with economic reasoning, the law of large numbers implies that this share is the expectation of losses.

Actuarially fair pricing is a foundation of insurance pricing. Combining a probabilistic viewpoint of an expected value and an interpretation of fairness, oftentimes the expectation of a present value of a random loss is known as an **actuarial present value.**


Another foundation of insurance pricing is **risk classification**, defined to be the grouping of insureds into homogeneous classes. As mentioned above, by "homogeneous" we mean that each insured within a group has the same distribution of potential losses. Even within a homogeneous class of insureds, there clearly will be stark differences *after* observing their mortality. But, *before* experience is observed, everyone has the same chance (or distribution of outcomes) in a homogeneous class.

Combining these ideas, one can see how insurance prices in competitive marketplaces are based on an actuarial present value for each risk class. Thus, development of distinct risk classes is a critical to fair insurance pricing.


###  Selection and Adverse Selection {#Sec:SelectionAdverse}

To develop distinct risk classes, insurers can use their underwriting processes to select subsets of a population. For example, as described in [Example 4.2.1], when an individual applies for life insurance, it is common for insurers to require a medical examination. Insurers only issue their so-called "standard" policies to individuals who have passed the medical exam. By this mechanism, they are effectively *selecting* a subset of the population that is healthier than the general population. (Insurers also issue "substandard" policies, at a higher  cost, to those with complicated health histories, like diabetes or heart disease, as well as drug, alcohol, or tobacco abuse.)

However, it is known that these selection effects do not continue indefinitely. For example, Table \@ref(tab:CanadianSelect) shows an excerpt from individual insurance mortality tables for females from Canada. To help read this table, consider a woman who became insured at age $x=50$ who initially has a mortality rate of 0.00047; one year later (at age 51) she has a mortality rate of 0.00072. This second rate is higher than 0.00053, the mortality rate for a woman who became insured at age $x=51$. This suggests that the selection effect is becoming less important. Further, from the table we see that selection effects last for 15 years; thereafter, rates are blended into an "ultimate" column. So for example, consider two females currently age 66 where one purchased insurance 16 years ago at age 50 and the other purchased insurance 15 years ago at age 51. Both have the same ultimate rate, $q_{66} = 0.01209$. 


```{r CanadianSelect, echo = FALSE}
scipen=99
CanadianSelect <- read.csv("Data/CanadianFemaleSelectRead.csv", stringsAsFactors = FALSE)
CanadianSelect1 <- subset(CanadianSelect, Age >= 50 & Age <= 69)
CanadianSelect2 <- CanadianSelect1[2:6,c(1:6,12,16)]
CanadianSelect3 <- CanadianSelect1[37:41,1:2]
CanadianSelect4 <- cbind(CanadianSelect2,CanadianSelect3[,2],CanadianSelect3[,1])
colnames(CanadianSelect4) <- c("Age", "Select=0","Select=1","Select=2","Select=3","Select=4","Select=10","Select=14", "Ultimate Mortality","Ultimate Age" )
rownames(CanadianSelect4) <- NULL
knitr::kable(CanadianSelect4, align = "r", caption="Select and Ultimate Female Canadian Mortality Rates")
```

*  Individual Life Experience Subcommittee, “Construction of CIA9704 Mortality Tables for Canadian Individual Insurance based on data from 1997 to 2004”, Canadian Institute of Actuaries (2010).
*  Accessed: October, 2021 from http://www.cia-ica.ca/docs/default-source/2010/210028e.pdf
*  Data retrieved from https://mort.soa.org/ (Table 1458)


Why do insurers bother with the cost and other administrative expenses of requiring a medical exam? They do so because they are concerned with a problem known as **adverse selection**, defined as a situation when consumers know more about their own risk characteristics than insurers. Specifically, without a medical exam, applicants have more knowledge of their medical history and general health status than the insurer. The problem arises because, without a medical exam requirement, it is more likely that people in poor health would apply for life insurance. People in poor health tend to have higher mortality rates that, as we have seen, results in higher actuarial present values for life insurance products.
 
Abstracting from this a bit, you can think of the insurance pool as being comprised of two groups, those in good health and those in poor health. Providing a single insurance price for both groups violates the fundamental principle of risk classification. As we did in Section \@ref(Sec:ActuarialFairRiskClass), it is easy to construct scenarios based on two insurers, one recognizing health differences and the other not doing so. In the long-run, the latter company becomes priced out of the marketplace. Insurers argue that by knowing about risk factors such as health status, the entire marketplace is better. Indeed, the entire purpose of risk classification is to mitigate the problem of adverse selection. 

In this section, we have seen the selection consequences of introducing, or not, a medical exam. As demonstrated in Table \@ref(tab:CanadianSelect), when a medical exam is introduced, we are essentially fine-tuning our definition of homogeneous classes by including not only factors such as sex and age but also time since a medical exam was taken. By not requiring a medical exam, we introduce heterogeneity into our risk groups and so lose the advantages associated with risk classification. In the following subsection, we introduce other problem situations that result in heterogeneous risk groups.


###  Asymmetric Information {#Sec:AsymmericInfo}


Adverse selection occurs when the additional information that the insured has is important and not revealed to the insurers, such as a poor health history. Adverse selection is a type of unequal access to information, known as **information asymmetry.**

Another type of information asymmetry is **moral hazard.** In moral hazard, the insurance contract itself changes the distribution of risks. To illustrate, by purchasing insurance, insureds have the incentive to take on more risks (thus increasing the probability of a risky event). For example, after purchasing life insurance, the insured may become decide to take up sky-diving, high-speed race car driving, or a life of crime. If the insurer knows about the risky activity in advance, then appropriate adjustments to the price may be made (or the contract simply not issued). The problem arises if the risky activity is taken on after the contract is issued; prices are based on one set of circumstances, losses based on another. Typically this mismatch results in a loss for the insurer. To mitigate this type of problem, insurers may introduce coverage restrictions. For example, life insurance contracts often do not pay benefits for deaths incurred while committing a crime or participating in an illegal activity.


***

*This bit on genetic testing may go into an Appendix or sidebar.*

Consumers often purchase life insurance to provide benefits for their loved ones in the event of their untimely demise and thus provide a bit of peace of mind. Moreover, there are other, more subtle, ways that the introduction of an insurance contract can change the behavior of consumers, not all in positive ways. One example is genetic testing.  Genetic testing involves a type of medical test that examines chromosomes, genes, or proteins. The results of a genetic test can confirm or rule out a suspected genetic condition or help determine a person's chance of developing or passing on a genetic disorder. There are many different purposes for testing, including medical (such as diagnosing a genetic disease or predicting disease risk) and non-medical (such as confirming parentage or forensic investigation).

Insurers worry about genetic testing information because of information asymmetry concerns. Like the purchase of life insurance, the decision to undergo genetic testing is voluntary. When a potential policyholder has information about his or her health that is not shared with the insurance company, this could lead to anti-selection where poorer risks purchase more insurance and better risks purchase little or no insurance. From an insurer’s viewpoint, one solution would be to allow insurers to require genetic testing, just as they are allowed to evaluate other aspects (e.g., weight, hypertension, and so forth) of a person's health. 

One way that genetic testing differs from, e.g., blood pressure, is through the impact that it has on a person's willingness to undergo the testing for fear of being denied life insurance. As summarized by Prince (2019), “Empirical evidence shows that fear of genetic discrimination has led individuals across the globe to refuse to participate in genetic research projects or to fail to undergo recommended clinical testing.” In this way, genetic testing also represents a type of moral hazard in the sense that the presence of an insurance contract can change a person's behavior.

***

Another implication of moral hazard is that people tend to increase their risk unless given incentives not to. Conversely, people may also reduce their risks when given incentives to do so. Indeed, much of modern risk management is predicated on introducing risk mitigation tools to reduce the impact of insured events. A classic example is the nonsmoker discounts in life insurance.

Another type of information asymmetry can occur when an insurer has less information than other competing insurance companies about the risk levels of its customers (cf. Cather 2018). This can result in **cream skimming**, because the innovative insurer targets the best risks who, like cream in a container of fresh milk, rise, to the top of a pool of policyholders. To illustrate, consider the Section \@ref(Sec:SelectionAdverse) that we discussed where one insurer has knowledge of an insured's health status and another does not. The insurer with this knowledge would target risks in good health because these are the ones, other things being equal, would enjoy a lower present value of benefits paid resulting in greater profits for the insurer.

*Later, we may wish to gently insert a bit about discrimination/algorithmic bias.*

##  Contingent Payment Applications {#Sec:ApplicationsContingent}



***

In this section, you learn how to interpret life contingent techniques as applicable more broadly to general contingent payment problems.

***

Our work so far has focused on modeling financial implications of survival as the time to event. This is easy to justify; the life insurance industry represents a major piece of the world economy. For example, in 2019, this industry accounted for 2512 *trillions* of U.S. dollars in developed (OECD) countries, representing more than 3.9 percent of the global economy (@OECD2020global). 

Nonetheless, "life contingent" techniques apply more broadly than only human mortality and so in this section we emphasize by referring to them as "contingent" techniques (omitting the life part). As our first example, Section \@ref(Sec:PetInsurance) describes a relatively small but quickly growing marketplace on pet insurance where time to survival of *pets* is the event of interest. As a second example, Section \@ref(Sec:DisIncInsurance) introduces disability income insurance. In this latter example, we present applications where the time to event is not the time to death but rather the time to *recovery* from disability.

These examples illustrate that contingent payment techniques can be used to understand financial implications of a **time to event** and that event need not be human mortality. Another example that we will see later in the book is the time to death of the first of two people.


`r HideExample('JedDiscussion.3',"Section Structure Discussions")`

<span style="color: blue;">

Here are a few more examples that could be included in problems or just mentioned in passing....

</span>

a.	Consider workers’ compensation where a benefit is paid when a worker gets into an accident (at work) and receives benefit payments for many years. The event time is the sooner of recovery or retirement. General insurance actuaries often don’t worry about time value of money but they should.
b.	Time to divorce is a good example used in labor economics extensively. Might use the 2014 paper (https://link.springer.com/content/pdf/10.1007/s13524-013-0278-1.pdf) that has a fitted Cox regression model. (Pension valuation would be an actuarial application.) Other labor economic examples include time in and out of employment, time until first child, and many others. 
c.	Real Estate Valuation. This is an old, old topic. Shaun Wang did something on it that we can check out, https://www.casact.org/sites/default/files/database/forum_14wforum_wang.pdf. A good possibility.
d.	Warranty analysis. This is mentioned in Bowers et al, if I recall. We can check it out.
e.	Applications addressing long-term social needs such as climate change. How about long-term costs to society for flood insurance/costs? Related to this, how about long-term expenditures for landfills for when determining the cost of a car?

***

**Supporting URLs for Pet Insurance**

Will remove these later...

*  https://www.protectapet.eu/
*  https://www.petinsurance.ie/Content/documents/PolicyDoc/1598_PetInsurance_Policy_IRL_Premier_A5_V3_web.pdf
*  https://www.simplegermany.com/best-dog-insurances-germany/
*  @verteramo2021analysis

</div>


##  Pet Insurance {#Sec:PetInsurance}

***

In this section, you learn how to:

*  Describe the pet insurance market.
*  Analyze canine (non-human) mortality and assess factors that impact the survival distribution.
*  Compute actuarial present values that summarize the lifelong cost of caring for a pet.
*  Summarize the history, regulatory environments, and economics principles affecting the pet insurance marketplace.

***

### Introduction to Pet Health Insurance {#Sec:IntroPet}

The COVID pandemic that began in 2019 changed life in many ways. Several studies have reported that as many businesses shifted their employees to remote work-from-home schedules, the demand for acquiring or fostering a new pet grew, @hoffman2021characterizing. Of course, there are costs associated with these new members of a household, some of which can be reasonably predicted and budgeted for (such as food and toys), others which are unexpected (e.g., kennel boarding of a pet when an emergency trip is to be taken by the owner), and still others that could not be remotely foreseen (e.g., the costs of repairing damages your dog did to buildings, living quarters, or other property). Naturally, insurance is one mechanism for paying for costs not anticipated. Pet insurance is a relatively small portion of the insurance marketplace but, even prior to the onslaught of the COVID pandemic, had been growing rapidly, @Contingencies2018.

**Types of Pet Insurance**. As with humans, there are many types of risks associated with pets. If one has a large or aggressive dog, then it may be necessary to purchase third party liability that covers damages your pet may do to other parties (similar to third party auto insurance). Several European countries (e.g., Sweden, Spain, parts of Germany) have requirements that dog owners maintain coverage for liability to third parties for the action of pets. In the U.S., pet owner liability to third parties from injuries caused by common household pets is generally covered by the owner's homeowners or renters insurance policy, as long as the animal is not an excluded breed and does not have a history of aggression, @NAICPet. 

It is also possible to purchase life (and theft) insurance on pets. These coverages are designed to insure the lives of highly valuable animals, such as show dogs and cats. These policies reimburse owners for stolen animals and pay a death benefit if an animal dies during transport or other covered events.

In terms of market share, the main type of pet insurance  provides accident and illness coverage for family-owned pets, primarily dogs and cats. While some pet insurance plans also provide reimbursement for wellness procedures like vaccinations, heartworm testing and spaying or neutering, pet health insurance is primarily used to cover costs for accidents and unexpected illness.  Typical coverages today can include exotic treatments such as acupuncture, chemotherapy, hydrotherapy, hyperbaric chamber treatments, oxygen treatments. In general, these coverages provide for anything that veterinarians prescribe to be medically necessary. 

Unlike life, theft, and pet liability coverage, pet health insurance is a stand-alone policy whose only purpose is to cover veterinary expenses. Policies have no face-value death benefit as with life insurance, although they can cover end of life expenses such as euthanasia.


**Factors**. What are the important risk factors in determining costs associated with pet insurance? In general, analysts look to an animal’s age, sex, breed, location, and other components. For example, as described in @wilson2020underwriting, it is known that :

*  Mixed-breed dogs are generally less expensive to care for than purebred dogs. 
*  Younger dogs are less expensive to  care for than older dogs.
*  Smaller dogs are generally less expensive to care for than larger dogs.
*  Interestingly, female cats are less expensive to care for than male cats, but the opposite is true for dogs. 


###  Canine Mortality {#Sec:CanineMort}

Like humans, dogs become increasingly frail as they age and, not surprisingly, incur additional costs to maintain a healthy lifestyle. So, consistent with the survival models developed in Chapter \@ref(C:ModelingLifeTimes), we emphasize mortality patterns of pets, focusing on dogs / canines.

Due to the developing and yet still competitive marketplace, it is not surprising that detailed data on *costs* associated with pet insurance are not widely available. Fortunately, this is not true of pet survival data, in part because many researchers interested in veterinary topics are publicly funded and have incentives to share their data. In this section, we draw on @pegram2021proportion, a study of the factors that influence determinants of the choice to euthanize a pet dog.


```{r eval = FALSE, echo = FALSE}
# Read in Data and Convert Date Variables, n= 29865
DogMort1 <- read.csv("Data/DogSurvivalData.csv",header = TRUE, stringsAsFactors=TRUE)
DogMort1$dateBirth <- as.Date(DogMort1$SourceBirthDate, "%m/%d/%Y") 
DogMort1$dateDeath <- as.Date(DogMort1$Date.of.death, "%m/%d/%Y")
DogMort1 <- DogMort1[-c(2,3)]
summary(DogMort1)
length(DogMort1$animalid)

# Remove missing birth dates, n = 13719
DogMort2 <- subset(DogMort1, is.na(dateBirth) == FALSE)
summary(DogMort2)
length(DogMort2$animalid)
# Remove missing death dates, n = 5966
DogMort3 <- subset(DogMort2, is.na(dateDeath) == FALSE)
summary(DogMort3)
length(DogMort3$animalid)
# Remove records where Date of Birth > Date of Death, n=  5950
DogMort4 <- subset(DogMort3, dateDeath >= dateBirth)
summary(DogMort4)
length(DogMort4$animalid)
# Remove records with missing sex information, n = 5933
DogMort <- subset(DogMort4, venomsex != "")
summary(DogMort)
( numDogs <- length(DogMort$animalid) )
DogMort <- droplevels(DogMort)
names(DogMort)[2] <- "Sex"
names(DogMort)[3] <- "Neutered"
names(DogMort)[4] <- "Breed"
names(DogMort)[5] <- "CauseDeath"
write.csv(DogMort,"Data/DogSurvivalData1.csv")#,header = TRUE, stringsAsFactors=TRUE)


```


```{r BreedCause, echo = FALSE}
# Read in Revised Data
DogMortA <- read.csv("Data/DogSurvivalData1.csv")
DogMort <- DogMortA[,-1]
DogMort$dateBirth <- as.Date(DogMort$dateBirth, "%Y-%m-%d") 
DogMort$dateDeath <- as.Date(DogMort$dateDeath, "%Y-%m-%d")
numDogs <- length(DogMort$animalid)
PrcFemales <- 100*sum(DogMort$Sex=="Female")/numDogs
PrcNeuter <- 100*sum(DogMort$Neutered=="Neutered")/numDogs
AgeAtDeath <- (as.numeric(DogMort$dateDeath) - as.numeric(DogMort$dateBirth))/365.25

#summary(DogMort)
#knitr::kable(summary(DogMort [c("Sex", "Neutered", "Breed", "CauseDeath")]))
# knitr::kable(summary(DogMort [c("Sex", "Neutered")]))
knitr::kable(summary(DogMort [c("Breed", "CauseDeath")]),caption="Breed and Cause of Death")

```

In particular, their data are publicly available at @pegram2021Data. In this dataset, there are 29865 observations used to study euthanasia. Our interest is in survival patterns by age and so we remove records where either the date of birth or death is missing or incorrect (we also removed 17 records with missing sex information); this results in 5933 records for analysis. Of these observations, `r round(PrcFemales, digits=1)`% are female and `r round(PrcNeuter, digits=1)`% are neutered. Table \@ref(tab:BreedCause) reports variation among the major types of breeds and causes of death.



For these data, the median age at death is `r round(median(AgeAtDeath),digits =1)` and the maximum is `r round(max(AgeAtDeath),digits =1)`. Survival distributions by sex and being neutered appeared in Figure \@ref(fig:SurvSexNeut). The left-hand panel shows little difference by sex. The right-hand panel shows that dogs that have been neutered enjoy lower mortality.

(ref:SurvSexNeut) **Survival Distributions by Sex and Being Neutered** 

```{r SurvSexNeut, fig.cap = '(ref:SurvSexNeut)', fig.align="center", echo = FALSE}
library(data.table)
library(survival)

par(mfrow=c(1,2))
plot(survfit(Surv(AgeAtDeath) ~ DogMort$Sex), col = 1:2, lty = 1:2, xlab="Age")
legend(.5, .5, c("Female", "Male"), col = 1:2, lty = 1:2, cex = 0.6) 

plot(survfit(Surv(AgeAtDeath) ~ DogMort$Neutered), col = 1:2, lty = 1:2, xlab="Age")
legend(.5, .5, c("Entire", "Neutered"), col = 1:2, lty = 1:2, cex = 0.6) 
```


Figure \@ref(fig:SurvBreed) shows survival distributions by breed where we plot distributions for the six most common breed types from Table \@ref(tab:BreedCause), the remaining breeds are grouped into an "Other" category. The differences among survival distributions for different breeds are not surprising. Breeds may be a proxy for the size and weight of a dog; a larger dog like a Labrador has more risk than a smaller dog like a Jack Russell terrier, for example.  The debate about whether mixed-breed dogs are generally healthier than purebred dogs is still
ongoing among veterinary professionals. On the one hand, mixed breed dogs may be carriers of genetic mutations that lead to health issues; on the other hand, they are less likely than purebreds to develop the disorders themselves.  As noted in @NAICPet, it is common for insurance carriers to group the breeds into 10 to 12 rating categories, with each category assigned a rating factor. 


(ref:SurvBreed) **Survival Distributions by Breed** 

```{r SurvBreed, fig.cap = '(ref:SurvBreed)', fig.align="center", echo = FALSE}
par(mfrow=c(1,1))
DogMort$Breed1 =  1*(DogMort$Breed == "Crossbreed") +
  2*(DogMort$Breed =="Staffordshire Bull Terrier") + 3*(DogMort$Breed =="Labrador Retriever") +
  4*(DogMort$Breed =="Jack Russell Terrier") + 5*(DogMort$Breed =="German Shepherd Dog") + 6*(DogMort$Breed =="Yorkshire Terrier")
DogMort$Breed2 <- factor(DogMort$Breed1)
levels(DogMort$Breed2) <- c("Other" ,
  "Crossbreed","Staffordshire Bull Terrier", "Labrador Retriever", "Jack Russell Terrier", "German Shepherd Dog", "Yorkshire Terrier")

plot(survfit(Surv(AgeAtDeath) ~ DogMort$Breed2), col = 1:7, lty = 1:7, xlab="Age")
legend(.5, .6, levels(DogMort$Breed2) , col = 1:7, lty = 1:7, cex = 0.7) 
```



Table \@ref(tab:DogCoxPHa) summarizes the result of a (Cox proportional hazards) regression model fit using sex, being neutered, and breed as covariates. As suggested by Figure \@ref(fig:SurvSexNeut), the results suggest that sex is not an important variable given the other variables in the model. Further, there may be further opportunities to reduce the number of levels of the Breed variable as the Staffordshire Bull Terrier	and Labrador Retriever distributions are not significantly different from the composite Other category.



`r HideRCode('PetInsureCoxPh.1',"R Code to Cox Regression Model Fit to Canine Survival")`


```{r DogCoxPH, eval = FALSE}
library(finalfit)
library(dplyr)

explanatory = c("Sex", "Neutered", "Breed2")
dependent = "Surv(AgeAtDeath)"
DogMort %>%
  coxphmulti(dependent, explanatory) %>%
  fit2df(condense = TRUE,
  metrics = FALSE, digits = c(2, 3,2),
  explanatory_name = "Risk Type", estimate_suffix = "  -- conf interval & p-value",
  estimate_name = "Exp(Coefficent)")  -> t2
t2[1] <- c("Male", "Neutered","Crossbreed","Staffordshire Bull Terrier", "Labrador Retriever", 
           "Jack Russell Terrier", "German Shepherd Dog", "Yorkshire Terrier")
knitr::kable(t2, align=c("l", "r"),caption="Fit of a Cox Proportional Hazards Model")

```


</div>

```{r DogCoxPHa, ref.label = 'DogCoxPH', echo = FALSE}
```


### Cost of Care {#Sec:DogCostCare}

With the estimated survival distribution, we can illustrate some of the types of calculations that a financial analyst might consider to quantify the cost of pet health insurance. These calculations are only for demonstration purposes; naturally, analysts that have access to detailed insurance costs will be able to sharpen our estimates. To begin, consider a male dog that is neutered belonging to the "Crossbreed" breed. Then, it is straightforward to determine one-year mortality rates, as summarized in Figure \@ref(fig:OneYearCrossBreeda).


`r HideRCode('PetInsureCoxPh.2',"R Code to Convert Cox Regression Model Output to One-Year Mortality Rates")`


```{r OneYearCrossBreed, eval = FALSE}
Cox_ph_1 <- coxph(Surv(AgeAtDeath) ~ Sex+Neutered+Breed2, data=DogMort)
sfit <- survfit(Cox_ph_1,newdata = data.frame(Sex="Male", Neutered="Neutered", Breed2 = "Crossbreed"))
#plot(sfit)
sx <- summary(sfit, times = 0:22)$surv
sx[1] = 1
qx <- 1 - sx[2:22]/sx[1:21]
qx[21] =1
plot(0:20,qx, xlab = "Age (x)", ylab = expression(q[x]), type = "both")

```

</div>

(ref:OneYearCrossBreed) **One Year Mortality Rates for a Neutered Male Crossbreed** 

```{r OneYearCrossBreeda, ref.label = 'OneYearCrossBreed', fig.cap = '(ref:OneYearCrossBreed)', fig.align="center",  out.width = '60%', echo = FALSE}
```

From this estimated mortality, it straightforward to estimate financial costs, as illustrated in the following.

**Example. Surgical Veterinary Care.**  Owning a pet can be expensive. According to the American Pet Products Association's 2021-2022 National Pet Owners Survey, the basic annual expense for caring for a dog is 1480. This total cost consists of: Surgical vet (458), food (287), routine visit (242), kennel boarding (228), food treats (81), vitamins (81), toys 56), and groomer/grooming aids (47) (*Source: @IIIPet*).

What about unanticipated costs? We estimate the actuarial present value associated with just one component, the surgical veterinary expenses, over a lifetime for a male dog aged $x$ that has been neutered. As our baseline initial cost, we use 458 USD per year. Now, we know that expenses increase as a dog ages and we assume an annual increase of 11%. This may seem high but we are assuming a 3% increase due to inflation and an 8% real growth rate. The real growth rate is based on the rating scale from a large carrier where the age rating factor starts at 1 for pets ages 2-11 months and increases to 4.5 for pets over 20 years old, see @wilson2020underwriting. 

To compute the actuarial present value, we use the expression

$$
APV = ({\text {Initial Ann Cost}}) \sum_{k=0}^{\omega - x - 1} v^k ~(1.11)^k ~_k p_x .
$$

This is based on equation (3.3) with the $k$-year survival probability $~_kp_x$ and  cost $~_kC = ({\text {Initial Ann Cost}})~(1.11)^k$ $= 458 ~(1.11)^k$. The discount factor is 3% for investments (so $v=1/1.03$) and the highest age is $\omega = 22$.  The calculations are summarized in Table \@ref(tab:OneYearCrossBreed1a). Not surprisingly, we see that older dogs (e.g., $x=12$) with a lower lifetime expectancy have a lower actuarial present value. In the same way, the German Shepard Dog has a higher mortality than the Crossbreed and so has a lower actuarial present value for the cost of care.


`r HideRCode('PetInsureCoxPh.3',"R Code to Create APVs from One-Year Mortality Rates")`


```{r OneYearCrossBreed1, eval = FALSE}
Cox_ph_1 <- coxph(Surv(AgeAtDeath) ~ Sex+Neutered+Breed2, data=DogMort)

DogAnn <- function(x=x, q.x=qx){
  Term <- length(q.x) - (x+1)
  kpx <- 1 
  APV  <- 0 
 if (Term>0){ for(k in 0:(Term-1)){ 
    if (k>1) {kpx <- kpx*(1-q.x[x+1+k])}
    APV  <- APV  + kpx *  (1/1.03)^k   *1.11^k *458
    }}
 return(APV)
  }

OneYearMortBreed <- function(Breed){
sfit <- survfit(Cox_ph_1,newdata = data.frame(Sex="Male", Neutered="Neutered", Breed2 = Breed))
sx <- summary(sfit, times = 0:22)$surv
sx[1] = 1
qx <- 1 - sx[2:22]/sx[1:21]
qx[21] =1
return(qx)
}

CostCare <- matrix(0, nrow = 2, ncol = 3)
qxCrossBreed <- OneYearMortBreed("Crossbreed")
CostCare[1,1] <- DogAnn(x=2, q.x=qxCrossBreed) 
CostCare[1,2] <- DogAnn(x=5, q.x=qxCrossBreed)
CostCare[1,3] <- DogAnn(x=12, q.x=qxCrossBreed)
qxGShepherd <- OneYearMortBreed("German Shepherd Dog")
CostCare[2,1] <- DogAnn(x=2, q.x=qxGShepherd) 
CostCare[2,2] <- DogAnn(x=5, q.x=qxGShepherd)
CostCare[2,3] <- DogAnn(x=12, q.x=qxGShepherd)

rownames(CostCare) <- c("Crossbreed","German Shepherd Dog" )
colnames(CostCare) <- c("x=2","x=5", "x=12" )

knitr::kable(CostCare, align=c("c", "c", "c"),caption="Actuarial Present Value of the Lifetime Cost of Surgical Vet Care", digits = 2)

```

</div>

```{r OneYearCrossBreed1a, ref.label = 'OneYearCrossBreed1', fig.align="center", echo = FALSE}

```

### More on Pet Insurance Markets 

**History and Markets**

As described in @NAICPet, the first policy on a dog was issued in Sweden in 1924. In 1947, the first pet insurance policy was issued in the United Kingdom (UK). In Sweden and the UK, modern pet insurance policies are designed with the ability to cover pet medical costs and liability to third parties for the action of pets. In the U.S., the first pet policy was issued in 1982 that covered the dog that played Lassie on a popular U.S. television series, @IIIPet.

Pet insurance is more common in European countries than in the United States, with half of all pets in Sweden covered by pet health insurance. In the U.S., only about 1% of dogs and cats kept as pets are covered by pet insurance. As noted in Section \@ref(Sec:IntroPet), in part this is due to regulatory requirements. It may also be due to the longer history that pet insurance has enjoyed in parts of Europe. 

Nonetheless, the pet insurance marketplace has been expanding rapidly in the U.S. with (premium) growth rates exceeding 10% for many years. According to a survey conducted by a large U.S. carrier, the fastest-growing form of distribution [of pet health insurance] is through an employee benefit package with about fifty percent of Fortune 500 companies offering pet insurance as an employee benefit, @NAICPet.

**Regulations and Economics**

From a regulatory perspective, in the U.S. pet insurance falls under the property/casualty area of insurance because pets are, in effect, property. This places a bit of a burden on actuaries in that statutory reporting follows traditional property and casualty procedures whereas other aspects of pet insurance are more akin to (human) health practices; in the U.S., health insurance is regulated separately from property/casualty insurance.

**Adverse selection**, introduced in Section \@ref(Sec:SelectionAdverse), is an important aspect of health insurance. It is natural for those in poor health to seek health insurance because they can reasonably expect higher costs. This can be a problem for insurers if they are unaware of the poor health conditions (we called this "information asymmetry" in Section \@ref(Sec:AsymmericInfo)). In many jurisdictions such as the U.S., there are rules that prohibit insurers from denying coverage for pre-existing (typically poor health) conditions. In contrast, for pet insurance animals with pre-existing conditions are generally not eligible for coverage. This avoids, for example, a situation in which a pet owner could find out his or her dog has cancer or another condition requiring expensive treatment and then tries to buy insurance to cover it.

Pet insurers also need to be aware of another type of information asymmetry, **moral hazard,** where the presence of the insurance cover alters survival probabilities (recall Section \ref(Sec:AsymmericInfo)). Moral hazard is not necessarily bad. In fact, perhaps the primary reason that veterinarians promote pet health insurance is so that they may advise pet owners on appropriate medical treatments and not be hampered by cost concerns. For example, sometimes veterinarians feel they must offer euthanasia as an option because the animal may be suffering from a treatable condition but the client may be unable to afford the proposed treatment due to lack of pet insurance, a situation termed *economic euthanasia*. 



## Disability Income Insurance {#Sec:DisIncInsurance}

***

In this section, you learn how to:

*  Describe disability income insurance.
*  Analyze disability recovery, a contingent event that is not based on human mortality.
*  Demonstrate the impact of selection on actuarial present values of disability income insurance.

***

### Introduction to Disability Income Insurance

Disability income insurance is a contract designed to provide a regular income, such as monthly, to an individual if he or she is prevented by sickness or injury from working. Policies are available on an individual basis, through membership in a group such as sponsored by an employer, and through public government sponsored insurance. The data that we consider are from the U.S. Social Security Disability Income program, @zayatz2015social. Because disability income provides benefits to those unable to work, it is not designed to be a substitute for a retirement benefit and so is usually available up to a fixed term or age, such as ceasing at age 65 as in our illustrative example.

Like annuity benefits introduced in Section \@ref(Sec:BenefitAnnuity), the benefit is paid periodically until a random **event time**. However, for a life annuity, the payment stops when the policyholder dies (a sad event). In contrast, for a disability income policy, we first focus on the payment stopping when someone recovers from disability (a happy event).

Contingent payment techniques can be employed for general event times that need not be tied to human mortality. Naturally, there are a few caveats to this important message. For example, both life annuities and disability income may be limited by a fixed term or age. Further, as we will see, disability income may cease upon the sooner of recovery or death, another type of event time.


```{r echo = FALSE}
RecoveryData       <- read.csv("Data/MaleRecovery.csv",       header=T)
RecoveryFData      <- read.csv("Data/FemaleRecovery.csv",     header=T)
RecoveryDeathData  <- read.csv("Data/MaleRecoveryDeath.csv",  header=T)
RecoveryDeathFData <- read.csv("Data/FemaleRecoveryDeath.csv",header=T)

```


### Disability Recovery Rates

To better appreciate how often policyholders recover from disability, Figure \@ref(fig:DiRecRates1) shows male rates $q_x^r$ from the U.S. Social Security Disability Income program (@zayatz2015social, Table 14A). The $r$ superscript reminds us that these are recovery, not mortality, rates. The solid black line, denoted as `Select=0`, is for individuals who met program qualifications for disability benefits and then recovered from their disability within a year. As suggested in the figure, except for age less than about 22, this experience is very similar to individuals who had been in the program for two years, `Select=2`. The other four lines represent greater number of years of selection (4, 6, 8, and an "ultimate" column); visually, they seem similar to one another. This figure demonstrates the importance of the select effect and is consistent with medical selection in life insurance that we saw in Section \@ref(Sec:SelectionAdverse). In both cases, recent admission to a program or policy can influence the "event time" experience.


(ref:DiRecRates1) **Disability Recovery Rates by Attained Age and Select Period**. A plot of recovery rates $q_x^r$ by attained age $x$. Each line represents a different select period. The lines for select 0 and 2 are similar, other lines are also similar, suggesting that selection effects have worn out beginning at select = 4. 


```{r DiRecRates1, fig.cap='(ref:DiRecRates1)', out.width='60%', fig.asp=.80, echo=FALSE}
library(ggplot2)
library(gridExtra)

dataf <- data.frame(RecoveryData)
ggplot(dataf,aes(x=Entryx, y=Select.0)) + theme_bw() + 
  geom_line(aes(y = Select.0), linetype = 1, col = 1) +
  geom_line(aes(x=c(rep(NA,2),Entryx[3:49]), y = c(rep(NA,2),Select.2[1:47])), linetype = 11, col = 11) +
  geom_line(aes(x=c(rep(NA,4),Entryx[5:49]), y = c(rep(NA,4),Select.4[1:45])), linetype = 2, col = 2) +
  geom_line(aes(x=c(rep(NA,6),Entryx[7:49]), y = c(rep(NA,6),Select.6[1:43])), linetype = 3, col = 3) +
  geom_line(aes(x=c(rep(NA,8),Entryx[9:49]), y = c(rep(NA,8),Select.8[1:41])), linetype = 4, col = 4) +
  geom_line(aes(x=c(rep(NA,10),Entryx[11:49]), y = c(rep(NA,10),Ultimate[1:39])), linetype = 5, col = 5) +
  xlab("Attained Age") + ylab("Recovery Rates") +
  scale_y_continuous(trans='log10') +
  annotate("text", x=17, y=0.003, size=3, label = "Select = 0") +
  annotate("text", x=18, y=0.030, size=3, label = "Select = 2")

```

```{r echo = FALSE}
# Convert to Cohort Format

matRecoveryM <- data.matrix(RecoveryData)
matRecoveryF <- data.matrix(RecoveryFData)
matRecoveryDeathM <- data.matrix(RecoveryDeathData)
matRecoveryDeathF <- data.matrix(RecoveryDeathFData)

RecoveryCohortM <- matrix(NA, nrow = 64-16+1, ncol = 65-16+1)

for (irow in 1:(64-16+1)){
#xEntry = 15+irow
for (icol in 2:(65-(15+irow)+2)){
#xAttained
    if (icol < 13){RecoveryCohortM[irow,icol+irow-1-1] = matRecoveryM[irow,icol]}
             else {RecoveryCohortM[irow,icol+irow-1-1] = matRecoveryM[icol+irow-1 - 11,12]}
}
}

```


As in Section \@ref(S:DataLifeExp), another way of looking at event times is by following **cohorts** of individuals. Figure \@ref(fig:DiRecRates2) follows recovery rates for several cohorts; this figure emphasizes that annual probabilities of recovery decline with advancing  age. As noted in @zayatz2015social, the early year probability of recovery patterns are attributed to the scheduling of continuing disability reviews. For example, where medical improvement is expected, the review is scheduled for 6 to 24 months following the most recent disability decision. Where medical improvement is not expected, the review is scheduled between 5 and 7 years later. 

These patterns are most evident in the cohort depicted by the bold solid black line that follows males who entered the disability program at age 16. This is the youngest cohort in the data set; it has the least amount of experience and so is the most uncertain. From Figure \@ref(fig:DiRecRates2), we see a very large spike in recovery rates after five or six years in the program. This spike is  also evident in cohorts that entered at ages 21 and 26 although on a smaller scale. The jump in recovery rates beginning at  `Cohort=31` and on is still evident but on a much lower scale.


(ref:DiRecRates2) **Disability Recovery Rates by Attained Age and Cohort**. A plot of recovery rates $q_x^r$ by attained age $x$. Each line represents a different cohort. The cohort first receiving disability benefits at age 16 show a strong recovery rate about five years later. This effect is also evident, although not as pronounced, in cohorts 21 and 26. Recovery rates seem to dampen as age (both cohort and attained) increases.


```{r DiRecRates2, fig.cap='(ref:DiRecRates2)', out.width='60%', fig.asp=.80, echo=FALSE}
xAttained <- 16:65

dataf <- data.frame(cbind(xAttained,t(RecoveryCohortM)))
ggplot(dataf, aes(xAttained, y=V2)) + theme_bw() + 
  geom_line(aes(y = V2), linetype = 1, col = 1, size=1.01) + 
  geom_line(aes(y = V7), linetype = 2, col = 2) +
  geom_line(aes(y = V12), linetype = 13, col = 13) +
  geom_line(aes(y = V17), linetype = 4, col = 4) +
  geom_line(aes(y = V22), linetype = 5, col = 5) +
  geom_line(aes(y = V27), linetype = 6, col = 6) +
  xlab("Attained Age") + ylab("Recovery Rates") +
  annotate("text", x=17, y=0.1, size=3, label = "Cohort=16") +
  annotate("text", x=20, y=0.0, size=3, label = "Cohort=21") +
  annotate("text", x=27, y=0.0, size=3, label = "Cohort=26")

```


### Actuarial Present Values of Disability Income

To get a sense of the benefit to an individual, and the cost to the program, we can compute actuarial present values. Calculation of the actuarial present value is that same as the term life annuity introduced in Section \@ref(Sec:TermLifeAnnuity) in that we assume the benefit terminates at age 65. Further, instead of probability of death we now use probability of recovery from disability (and hence exiting the program).

Using an assumed $i=$ 4 percent interest rate, Figure \@ref(fig:DiRecRates3) summaries annuity calculations by attained age for several different cohorts. These annuity values assume a payment of 1 at the beginning of the year if one is in the program; for perspective, as reported in @zayatz2015social, in 2013 (the year of the study) disability income worker beneficiaries received approximately 14,000 USD per year.

Although there are some differences at younger cohorts and attained ages, Figure \@ref(fig:DiRecRates3) shows remarkable agreement among cohorts beginning about age 30. In the figure, the thick dashed blue line marks annuity values for the `Cohort=31`; all annuity values are similar to this line. We can interpret this to mean that the actuarial present value depends on the attained age for 30 and above, not the cohort representing when an individual first entered the program.


(ref:DiRecRates3) **Annuities by Attained Age and Cohort**. A plot of annuities $ä_x^r$ by attained age $x$. Each line represents a different cohort. The first two cohorts plotted first receiving disability benefits at age 16 and 21 differ in the early annuity values. Beginning at attained age 30, all annuity values appear to be qualitatively similar. The thick dashed blue line marks annuity values for the cohort=31.


```{r DiRecRates3, fig.cap='(ref:DiRecRates3)', out.width='60%', fig.asp=.80, echo=FALSE}

AddPV <- function(x, q.x, int=0.04){
  v = 1/(1+int)
  num = length(x)
  0*x -> add.x
  add.x[num] = 1 #+ (1-q.x[num])/(int + 1e-12)
  for (i in 1:(num-1)){
    add.x[num-i] = 1 + v*(1-q.x[num-i])*add.x[num-i+1] 
  }
    tablelife <- cbind(x,q.x,add.x)
  return(tablelife)
}

add.x.16 <- AddPV(x=16:65, q.x=RecoveryCohortM[1,1:49])[,3]
add.x.21 <- c(rep(NA,5), AddPV(x=21:65, q.x=RecoveryCohortM[6,6:49])[,3])
add.x.26 <- c(rep(NA,10),AddPV(x=26:65, q.x=RecoveryCohortM[11,11:49])[,3])
add.x.31 <- c(rep(NA,15),AddPV(x=31:65, q.x=RecoveryCohortM[16,16:49])[,3])
add.x.36 <- c(rep(NA,20),AddPV(x=36:65, q.x=RecoveryCohortM[21,21:49])[,3])
add.x.41 <- c(rep(NA,25),AddPV(x=41:65, q.x=RecoveryCohortM[26,26:49])[,3])

dataf <- data.frame(cbind(xAttained,add.x.16, add.x.21,
                          add.x.26, add.x.31, add.x.36, add.x.41 ))

ggplot(dataf,aes(x=xAttained, y=add.x.16)) + theme_bw() +
  geom_line(aes(y = add.x.16), color = 1, linetype=1) +
  geom_line(aes(y = add.x.21), color = 2, linetype=2 ) + 
  geom_line(aes(y = add.x.26), color = 3, linetype=3 ) + 
  geom_line(aes(y = add.x.31), color = 4, linetype=4, size = 2  ) + 
  geom_line(aes(y = add.x.36), color = 5, linetype=5 ) +  
  geom_line(aes(y = add.x.41), color = 6, linetype=6) +   
  xlab("Attained Age") + ylab(expression(ä[x]^r)) +
  annotate("text", x=20, y=12, size=3, label = "Cohort=16") +
  annotate("text", x=20, y=16, size=3, label = "Cohort=21") 

```

Figure \@ref(fig:DiRecRates4) supplements that actuarial present values by providing an analysis for female workers. The top two lines of the figure show that male and female actuarial present values are virtually indistinguishable when the event time is recovery. Based on our prior work, this figure only presents `Cohort=31`.

The lower two lines in Figure \@ref(fig:DiRecRates4) consider the event time to be the sooner of recover and death for males and females, respectively. That is, a worker may leave the program due to recover from disability as well as death. So, when computing actuarial present values, this broader measure of exiting the program is used. The lower two lines show that  female annuities are above male annuities; this is consistent with our prior observations that females generally live longer then males.


(ref:DiRecRates4) **Annuities by Attained Age, Gender and Type of Departure**. A plot of annuities $ä_x^r$ by attained age $x$. The top two lines are represent departing from the disability program via recovery from disability. The two lines are for male and female and are virtually indistinguishable. The bottom two lines represent departing from the disability program via recovery from disability or by death. Female annuities are above male annuities (in that females generally live longer then males).



```{r DiRecRates4, fig.cap='(ref:DiRecRates4)', out.width='60%', fig.asp=.80, echo=FALSE}

CreateCohort <- function(matData){
  CohortData <- matrix(NA, nrow = 64-16+1, ncol = 65-16+1)
  for (irow in 1:(64-16+1)){
  #xEntry = 15+irow
  for (icol in 2:(65-(15+irow)+2)){
  #xAttained
    if (icol < 13){CohortData[irow,icol+irow-1-1] = matData[irow,icol]}
             else {CohortData[irow,icol+irow-1-1] = matData[icol+irow-1 - 11,12]}
  }}
  return(CohortData)
  }
RecoveryCohortF      <- CreateCohort(matRecoveryF)
RecoveryDeathCohortM <- CreateCohort(matRecoveryDeathM)
RecoveryDeathCohortF <- CreateCohort(matRecoveryDeathF)

add.x.31RF  <- c(rep(NA,15),AddPV(x=31:65, q.x=RecoveryCohortF[16,16:49])[,3])
add.x.31RDM <- c(rep(NA,15),AddPV(x=31:65, q.x=RecoveryDeathCohortM[16,16:49])[,3])
add.x.31RDF <- c(rep(NA,15),AddPV(x=31:65, q.x=RecoveryDeathCohortF[16,16:49])[,3])


dataf <- data.frame(cbind(xAttained,add.x.31, add.x.31RF, add.x.31RDM,add.x.31RDF ))

ggplot(dataf,aes(x=xAttained, y=add.x.31)) + theme_bw()+
  geom_line(aes(y = add.x.31), color = 1, linetype=1) +
  geom_line(aes(y = add.x.31RF), color = 2, linetype=2 ) + 
  geom_line(aes(y = add.x.31RDM), color = 3, linetype=3, size=1 ) + 
  geom_line(aes(y = add.x.31RDF), color = 4, linetype=4 ) +
  xlab("Attained Age") + ylab(expression(ä[x]^r)) +
  coord_cartesian(xlim =c(30,70)) +
  annotate("text", x=50, y=15, size=3, label = "Recovery") +
  annotate("text", x=35, y=12, size=3, label = "Recovery + Death") +
  annotate("text", x=30, y=15, size=3, label = "Female") 

```

### More on Disability Income Insurance

This brief introduction to disability income focused on demonstrating an important application where contingent payment methods need not use mortality as the time to an event. Because of its brevity, we have omitted many important attributes of disability income such as a waiting time for benefit eligibility, the role of monthly payments, differences among individual, group, and public programs, as well as features of different international marketplaces. For a deeper dive into this fascinating topic, see 
@haberman2018actuarial.

In particular, we have not yet addressed the *cost of becoming disabled*. What we have done is provide actuarial present values of the benefit of a disability insurance program. However, for a worker, we have not yet described the probability of being disabled. More generally, in a worker's lifetime, someone can start as an active worker, become disabled, and as we have seen, that the person may quickly recover from the disability and then re-enter the work force. This pattern of switching statuses between between healthy and working and disabled and receiving benefits, and costs associated with each status, is the topic of Chapter 7 on **multiple state modeling.**


`r HideExample('JedDiscussion.4',"Section Structure Discussions")`

<span style="color: blue;">

Easy to include moral hazard into disability income insurance discussions....

</span>


</div>

## Exercises



#### Section 4.3 Exercises {-}

**Exercise 4.3.1. Actuarial Present Values for Select and Ultimate Tables**. The select and ultimate tables introduced in Section \@ref(Sec:SelectionAdverse) are complicated -- is such complexity is warranted in practice? To get insights into this question, in this exercise you will compare actuarial present values derived from select and ultimate mortality to those from only ultimate mortality. To be specific, we focus consider whole life insurance for using the female Canadian experience introduced in Section \@ref(Sec:SelectionAdverse); the data are available using this download button <a href="https://onedrive.live.com/download?cid=9F1B70CE7B0595D1&resid=9F1B70CE7B0595D1%211749&authkey=AGnijC6ZUbgEnHs" download >
<button type="button"  style="background-color:#008CBA;color:white">Download the Female Canadian Select and Ultimate Mortality Table.</button></a>

For these data,

a.  produce $A_x$ for $x=50, \ldots, 65$ using an interest rate of $i=0.04$ based on
    i.  select and ultimate mortality
    ii. ultimate mortality
b.  compare these two sequences of actuarial present values by calculating their ratio.
c.  repeat parts (a) and (b) using an interest rate $i=0.02$.

To give you a feel for the results, Figure \@ref(fig:SelUlt1) summarizes the results.


```{r CanadianSelectExer, echo = FALSE}

CanadianSelUlt <- read.csv("Data/CanadianFemaleSelectRead.csv", stringsAsFactors = FALSE)

temp <- CanadianSelUlt[131:201,1:2]
temp1 <- as.matrix(temp)
CanadianUlt50 <- matrix(as.numeric(temp1), ncol=2)
colnames(CanadianUlt50) <- c("Age", "qx_Ult")
rownames(CanadianUlt50) <- NULL

tempSel <- CanadianSelUlt[51:81,]
tempSel1 <- as.matrix(tempSel)

CanadianSel50 <- matrix(as.numeric(tempSel1), ncol=ncol(tempSel))
rownames(CanadianSel50) <- NULL

CanadianSel50.toUlt <- matrix(1, nrow = nrow(CanadianSel50), ncol = 120-50+1)
CanadianSel50.toUlt[1:nrow(CanadianSel50),1:ncol(CanadianSel50)] <- CanadianSel50

for (irow in (1:nrow(CanadianSel50)) ){
for (icol in (1: (120-50-15-irow)) ){
  CanadianSel50.toUlt[irow,1+15+icol ] <- CanadianUlt50[irow+14+icol,2]
   }
}

#  Actuarial Present Value Calculations
APV.Ult <- function(xage, q.x, int=0.00){
  v = 1/(1+int)
  num = length(xage)
  A.x <- 0*xage -> add.x -> e.x
  A.x[num] = v*q.x[num]
  add.x[num] = 1 + (1-q.x[num])/(int + 1e-12)
  e.x[num] = 1-q.x[num]
  for (i in 1:(num-1)){
    A.x[num-i] = v*q.x[num-i] + v*(1-q.x[num-i])*A.x[num-i+1]
    add.x[num-i] = 1 + v*(1-q.x[num-i])*add.x[num-i+1] 
    e.x[num-i] =  (1-q.x[num-i])*(1+e.x[num-i+1])
    }
  tablelife <- cbind(xage,q.x,A.x,add.x,e.x)
  return(tablelife)
}
AxUlt04 <- APV.Ult(xage= CanadianUlt50[,1], q.x=CanadianUlt50[,2], int=0.04)[,3]
AxUlt04.5065 <- AxUlt04[1:16]
AxUlt02 <- APV.Ult(xage= CanadianUlt50[,1], q.x=CanadianUlt50[,2], int=0.02)[,3]
AxUlt02.5065 <- AxUlt02[1:16]

#  Actuarial Present Value Calculations

APV.Sel <- function(int=0.00){
AxSel04 <- rep(0, 16)
  v = 1/(1+int)
for (iage in 1:16){
#iage =2
  AxSel04[iage] =  v*CanadianSel50.toUlt[iage, 2]
kpx = 1
  for (k in 1:(ncol(CanadianSel50.toUlt)-2)) {
    kpx = kpx*(1-CanadianSel50.toUlt[iage, k+1])
   AxSel04[iage] =  AxSel04[iage] + v**(k+1)*kpx*CanadianSel50.toUlt[iage, k+2]
  }
}
return(AxSel04)
}
AxSel04 <- APV.Sel(int=0.04)
AxSel02 <- APV.Sel(int=0.02)

Age1 <- c("50", "51", "52", "53", "54", "55", "56", "57")
Age2 <- c("58", "59", "60", "61", "62", "63", "64", "65")

Ratio04Sel.Ult <- AxSel04/AxUlt04.5065
OutPartA <- rbind(50:57, AxSel04[1:8],  AxUlt04.5065[1:8],  Ratio04Sel.Ult[1:8], 
                  58:65, AxSel04[9:16], AxUlt04.5065[9:16], Ratio04Sel.Ult[9:16] )
OutPartA1 <- round(OutPartA, digits = 4)
OutPartA1[1,] <- Age1
OutPartA1[5,] <- Age2
rownames(OutPartA1) <- c(
  "Age",  "Select2 and Ultimate, i=4%", "Ultimate, i=4%","Ratio", 
  "Age",  "Select and Ultimate, i=4%", "Ultimate, i=4%", "Ratio")
#knitr::kable(OutPartA1, align = "r", caption="Select and Ultimate Female Canadian APVs")

Ratio02Sel.Ult <- AxSel02/AxUlt02.5065
OutPartB <- rbind(50:57, AxSel02[1:8],  AxUlt02.5065[1:8],  Ratio02Sel.Ult[1:8], 
                  58:65, AxSel02[9:16], AxUlt02.5065[9:16], Ratio02Sel.Ult[9:16] )
OutPartB1 <- round(OutPartB, digits = 4)
OutPartB1[1,] <- Age1
OutPartB1[5,] <- Age2
rownames(OutPartB1) <- c(
  "Age",  "Select and Ultimate, i=2%", "Ultimate, i=2%","Ratio", 
  "Age",  "Select and Ultimate, i=2%", "Ultimate, i=2%", "Ratio")
#knitr::kable(OutPartB1, align = "r", caption="Select and Ultimate Female Canadian APVs")


```


(ref:SelUlt1) **Life Insurance APV by Age, Interest, and Mortality Type**. A plot of life insurance actuarial present value $A_x$ by age $x$. The top two lines are based on $i=0.02$, the bottom two based on $i=0.04$. For each pair, the top line uses ultimate mortality, the bottom line is based on select and ultimate mortality


```{r SelUlt1, fig.cap='(ref:SelUlt1)', out.width='60%', fig.asp=.80, echo=FALSE}

Age <- 50:65
dataf <- data.frame(cbind(Age , AxSel04,AxSel02, AxUlt04.5065, AxUlt02.5065 ))

ggplot(dataf,aes(x=Age, y=AxSel04)) + theme_bw() +
  geom_line(aes(y = AxSel04), color = 1, linetype=4, size = 2) +
  geom_line(aes(y = AxSel02), color = 1, linetype=1, size = 2) +
  geom_line(aes(y = AxUlt04.5065), color = 2, linetype=2, size = 2 ) + 
  geom_line(aes(y = AxUlt02.5065), color = 3, linetype=3 , size = 2) + 
  xlab("Age") + ylab(expression(A[x])) +
  annotate("text", x=55, y=0.36, size=4, label = "Interest = 4%") +
  annotate("text", x=55, y=0.6, size=4, label = "Interest = 2%") 

```



`r HideProofTheory('Exer4.3.1',"Exercise 4.3.1 Answer")`

```{r echo = FALSE}
knitr::kable(OutPartA1, align = "r", caption="Comparison of Life Insurance APVs, Interest is 4%")
```


```{r echo = FALSE}
knitr::kable(OutPartB1, align = "r", caption="Comparison of Life Insurance APVs, Interest is 2%")
```

`r HideRCode('Exer4.3.1A',"Exercise 4.3.1 Solution using R Code")`

```{r ref.label = 'CanadianSelectExer', eval=FALSE}
```

</div>

</div>


#### Section 4.5 Exercises {-}

**Exercise 4.5.1. Dog Survival Distributions and Actuarial Present Values.** The analysis in Section \@ref(Sec:CanineMort) suggests that breed is an important factor for dog survival. To underscore this point for a broader audience, let us look at survival for a type of small dog, a "Jack Russell Terrier", and a large dog, a "German Shepherd Dog". We can make differences in survival distributions between small and large dogs even more meaningful by also computing selected actuarial present values that summarize future expected costs.

You should begin your analysis by downloading the data, available at<a href="https://onedrive.live.com/download?cid=9F1B70CE7B0595D1&resid=9F1B70CE7B0595D1%211752&authkey=ALDTPrf5BIOX2Sg&em=2" download>
<button type="button"  style="background-color:green;color:white">Download the Dog Mortality Data</button></a>
        
The data have been re-worked so that they can be used for your analysis. Here is a bit more code needed to convert data fields appropriately and to separate the file into two subsets, one for Terriers and one for German Shepherds.  

`r HideRCode('Exer4.5.1A',"Show R Code to Pre-Process the Data")`

```{r eval = FALSE}
# Read in Revised Data
DogMortA <- read.csv("DogSurvivalData1.csv")
DogMort <- DogMortA[,-1]
DogMort$dateBirth <- as.Date(DogMort$dateBirth, "%Y-%m-%d") 
DogMort$dateDeath <- as.Date(DogMort$dateDeath, "%Y-%m-%d")
DogMort$AgeAtDeath <- (as.numeric(DogMort$dateDeath) - as.numeric(DogMort$dateBirth))/365.25
DogTerr <- subset(DogMort, Breed == "Jack Russell Terrier")
DogGShep <- subset(DogMort, Breed == "German Shepherd Dog")

```

</div>
         
For these data:

a.  Compute one-year mortality rates for both Terriers and German Shepherds. Do this over $x=0, \ldots, 20$. Graph the results.
b.  Because you may be working with products with events occurring more frequently than once a year, you decide to follow the strategy introduced in Section \@ref(Sec:BasicConceptsmthly) and look at mortality rates occurring on a quarterly basis. Repeat the analysis from part (a) using quarterly rates.
c.  The results of earlier analyses indicate substantial volatility in the both quarterly rates and annual rates at later ages. One approach to mitigate this volatility is to smooth the rates. A simpler approach is to use longer periods (hence increasing exposure and reducing volatility). Repeat the analysis in part (a) using rates on a once every two year basis.
d.  To see how these rates might be used, you decide to repeat the analysis in Section \@ref(Sec:DogCostCare) and compute an actuarial present value of the lifetime cost of surgical vet care. Use the same assumptions as in that section with the initial annual cost as 458, $i=0.03$ interest rate and a 11 percent annual growth in surgical care costs. However, use the dog mortality from part (a). Do this for $x=2, 5, 12$, for both breeds. You will see that that your results on German Shepherds differ slightly from those presented in Section \@ref(Sec:DogCostCare); comment on why this is so.


`r HideProofTheory('Exer4.5.1',"Exercise 4.5.1 Answers")`

```{r DogDataExer}
library(data.table)
library(survival)
# Read in Revised Data
DogMortA <- read.csv("Data/DogSurvivalData1.csv")
DogMort <- DogMortA[,-1]
DogMort$dateBirth <- as.Date(DogMort$dateBirth, "%Y-%m-%d") 
DogMort$dateDeath <- as.Date(DogMort$dateDeath, "%Y-%m-%d")
DogMort$AgeAtDeath <- (as.numeric(DogMort$dateDeath) - as.numeric(DogMort$dateBirth))/365.25
DogTerr <- subset(DogMort, Breed == "Jack Russell Terrier")
DogGShep <- subset(DogMort, Breed == "German Shepherd Dog")

fitTerr <- survfit(Surv(AgeAtDeath) ~ 1, data=DogTerr)
fitGShep <- survfit(Surv(AgeAtDeath) ~ 1, data=DogGShep)
```

**Part A**

```{r fig.width=6, fig.height=4.0, fig.cap = "One-year Dog Mortality Rates, Blue Solid Line is for German Shepherds"}
seqA1 <- 0:20
seqA2 <- seqA1 + 1
qxTerrA  <- (summary(fitTerr,  time = seqA1)$surv -   summary(fitTerr,  time = seqA2)$surv)   /summary(fitTerr,  time = seqA1)$surv
qxGShepA <- (summary(fitGShep, time = seqA1)$surv - c(summary(fitGShep, time = seqA2)$surv,0))/summary(fitGShep, time = seqA1)$surv
plot(seqA1,qxTerrA, xlab = "Age", ylab = expression(q[x]))
lines(0:16, qxGShepA, col = "blue")
```

**Part B**

```{r fig.width=6, fig.height=4.0, fig.cap = "Quarterly Dog Mortality Rates, Blue Solid Line is for German Shepherds"}
seqB1 <- seq(from = 0, to = 20, by = 0.25)
seqB2 <- seqB1 + 0.25
qxTerrB  <- (summary(fitTerr,  time = seqB1)$surv -   summary(fitTerr,  time = seqB2)$surv)   /summary(fitTerr,  time = seqB1)$surv
qxGShepB <- (summary(fitGShep, time = seqB1)$surv - c(summary(fitGShep, time = seqB2)$surv,0))/summary(fitGShep, time = seqB1)$surv
plot(seqB1,qxTerrB, xlab = "Age", ylab = expression(q[x]))
lines(seqB1[1:67], qxGShepB, col = "blue")
```

**Part C**

```{r fig.width=6, fig.height=4.0, fig.cap = "Two-year Dog Mortality Rates, Blue Solid Line is for German Shepherds"}
seqC1 <- seq(from = 0, to = 20, by = 2)
seqC2 <- seqC1 + 2
qxTerrC  <- (summary(fitTerr,  time = seqC1)$surv - c(summary(fitTerr,  time = seqC2)$surv,0))/summary(fitTerr,  time = seqC1)$surv
qxGShepC <- (summary(fitGShep, time = seqC1)$surv - c(summary(fitGShep, time = seqC2)$surv,0))/summary(fitGShep, time = seqC1)$surv
plot(seqC1,qxTerrC, xlab = "Age", ylab = expression(q[x]))
lines(seqC1[1:9], qxGShepC, col = "blue")
```

**Part D**

```{r}
DogAnn <- function(x=x, q.x=qx){
  Term <- length(q.x) - (x+1)
  kpx <- 1 
  APV  <- 0 
 if (Term>0){ for(k in 0:(Term-1)){ 
    if (k>1) {kpx <- kpx*(1-q.x[x+1+k])}
    APV  <- APV  + kpx *  (1/1.03)^k   *1.11^k *458
    }}
 return(APV)
  }
DogAnn(x=2, q.x=qxTerrA)
DogAnn(x=5, q.x=qxTerrA)
DogAnn(x=12, q.x=qxTerrA)
DogAnn(x=2, q.x=qxGShepA)
DogAnn(x=5, q.x=qxGShepA)
DogAnn(x=12, q.x=qxGShepA)

```

Note that the mortality estimates in this exercise are based only on data for a specific breed. In contrast, the analysis in Section \@ref(Sec:DogCostCare) used a Cox proportional hazards to regression model to use data from all breeds to form mortality estimates.

***

</div>




