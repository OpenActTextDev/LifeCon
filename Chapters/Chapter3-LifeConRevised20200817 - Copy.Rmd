---
title:  "The Mathematics, Statistics, and Economics of Life Contingencies"
author: "An open text authored by the Actuarial Community"
output:
  bookdown::html_document2:
    self_contained: false
    toc: yes
    toc_depth: '3'
    number_sections: yes
    fig_width: 6
    fig_height: 4
  # bookdown::pdf_book:
  #  code_folding: hide
    css: WritingSupportFiles/style.css
    includes:
      in_header: WritingSupportFiles/ShowHide.js
  #   number_sections: yes
  #   toc: yes
  #   toc_depth: '3'
  #   template: [WritingSupportFiles\EWF-latex-ms.tex]
  #   keep_tex: true
  #   fig_caption: true
  #   latex_engine: pdflatex
bibliography: ["WritingSupportFiles/LDAReferenceC.bib","WritingSupportFiles/articles.bib","WritingSupportFiles/books.bib","WritingSupportFiles/packagesA.bib","WritingSupportFiles/packagesB.bib"]
biblio-style: WritingSupportFiles\econPeriod
keywords: "Keywords here"
date: "`r format(Sys.time(), '%B %d, %Y')`"
geometry: margin=1in
fontsize: 12pt
spacing: onehalf
---

$\require{enclose}$ <!-- Later equations only properly knit if this is beforehand once in the code -->

<!-- ```{r echo = FALSE, child="WritingSupportFiles\\Packages.Rmd", warning=FALSE,message=FALSE} -->
<!-- ``` -->

`r ECHOCODE=FALSE`

```{r echo = FALSE, child='WritingSupportFiles/PdfOutput.Rmd', warning=FALSE,message=FALSE}
```

```{r echo = FALSE, child='WritingSupportFiles/Glossary.Rmd', warning=FALSE,message=FALSE}
```

<script src="https://bossanova.uk/jexcel/v4/jexcel.js"></script>
<link rel="stylesheet" href="https://bossanova.uk/jexcel/v4/jexcel.css" type="text/css" />
<script src="https://bossanova.uk/jsuites/v3/jsuites.js"></script>
<link rel="stylesheet" href="https://bossanova.uk/jsuites/v3/jsuites.css" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>

# Chapter 1 Introduction
# Chapter 2 A Primer on Survival Analysis
# Chapter 3 Modeling Simple Life Contingent Benefits {#C:Benefit}

`r chapnum = 3`

This chapter introduces the modeling of life contingent benefits, integrating the material from the previous chapter with basic concepts from financial mathematics. In contrast to benefits that are certain to be paid at specified periods, life contingent benefits have the additional complexity that the payments are uncertain and contingent upon either the survival or mortality of one or more lives. In this chapter we introduce the calculations of the present values of these contingent benefits, along with associated notation.

In this Chapter we assume that all benefits are paid at annual times. Benefits paid in continuous or more frequently than annual time, along with other extensions, are considered in Chapter \@ref(C:BenefitExt).

## Valuation of cash flows under uncertainty {#Sec:BenefitCFunc}

Imagine a financial system with a cash flow of known value $_tC$ occuring in $t$ years from now. If we assume the spot rate of interest is $_ti$ per annum effective, then as per Chapter X we know that the present value ($PV$) of this cash flow is:

$$
PV = ~_tC (1+{_ti})^{-t}=~_tCv^t
(\#eq:Benefit1)
$$

<span style="color: red;">
**Structure discussion.** The above is written assuming a primer somewhere before this chapter including basic interest theory, as per the draft book structure (and my comments) from November 2020.
</span>

<span style="color: green;">
**Notation discussion.** There are a number of decisions to make here.

<span style="color: green;">
I'd like to keep $PV$ as we can use it for all types of present value calculations (insurance benefits, annuity benefits, premiums, etc.). I'd like to keep $V$ for reserves. We also need to think about consistency of terminology: do we use actuarial present value or expected present value? Is it necessary to emphasize distinction? (I deliberately haven't).

<span style="color: green;">
Jed's initial principles suggest uppercase italics for random variables. That's OK as long as we are recognising that sometimes the values won't be random if all elements of the RHS of the equation are deterministic. Further, elements such as $C$ might be random variables in some types of policies (e.g. unit linked) but not others.

<span style="color: green;">
Keeping benefit cashflows as $C$ works and we can use $P$ for premium cash flows.

<span style="color: green;">
Having $t$ be a left subscript ensures that right subscripts are reserved for individual characteristics ${\bf{x}}_j$ leaving open the possibility of $_tC_{{\bf{x}}_j}$ or $_tC_j$ where relevant for a policy, which we will introduce in the case study later in this Chapter where we will make some minor adjustments to notation.
</span>

Let us now introduce uncertainty into this system. Uncertainty might be in terms of the values of $_tC$, $t$ or $_ti$. In this Chapter we will assume $_ti$ is known and that $t$ can take discrete values $k \in \{0,1,2,3, \ldots\}$ only. We will also assume that $_kC$ can take either a known value with probability $\Pr(_kC)$, otherwise is zero with probability $1-\Pr(_kC)$.

This system is illustrated on a timeline in Figure \@ref(fig:Benefit1).

`r HideRCode('Benefit1',"R Code For Figure")`

```{r  Benefit1, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,9,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(6,6.2,6,5.8,code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(6,7,"3")
text(7.5,7,"...")
text(1,5,"Cash Flow")
text(3,5,TeX("_0C"))
text(4,5,TeX("_1C"))
text(5,5,TeX("_2C"))
text(6,5,TeX("_3C"))
text(7.5,5,"...")
text(1,4,"Probability")
text(3,4,TeX("Pr(_0C)"))
text(4,4,TeX("Pr(_1C)"))
text(5,4,TeX("Pr(_2C)"))
text(6,4,TeX("Pr(_3C)"))
text(7.5,4,"...")


```

</div>

```{r Benefit1, ref.label = 'Benefit1', fig.cap = 'Timeline of cash flows with uncertainty', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

<span style="color: purple;"> **To be resolved later.** This will need to be tidied up, including getting the font in the figures consistent with the text. </span>

$PV$ is now the sum of a number of discrete random variables. We can simplify the expression of $PV$ by using the Bernoulli random variables, $I_Y$, which is equal to $1$ if event $Y$ occurs or $0$ otherwise. In this case we define $Y$ as being the event that cashflow $_kC \ne 0$ at time $k$.  We can define the present value of this cash flow system as follows:

$$
\begin{array}{l}
PV = \sum_{k=0}^{\infty} ~_kC~ v^k ~I_{_kC \ne 0}\\
\end{array}
(\#eq:Benefit2)
$$

(Note that we do not need to take into account the event that $_kC=0$ as this has no impact on the $PV$)

Given that $_kC$ and $v^k$ are known, we can calculate the expected present value, $\mathrm{E}(PV)$, as follows:

$$
\begin{array}{l}
\mathrm{E}(PV) = \mathrm{E} \left[ \sum_{k=0}^{\infty} ~_kC~ v^k ~I_{_kC \ne 0} \right] \\
= \sum_{k=0}^{\infty} ~_kC~ v^k ~\mathrm{E}(I_{_kC \ne 0}) \\
= \sum_{k=0}^{\infty} ~_kC~ v^k ~\Pr(_kC)\\
\end{array}
(\#eq:Benefit3)
$$

<span style="color: purple;"> **To be resolved later.** Need to tidy these equations using amsmath package for alignment.</span>

The calculation in Equation \@ref(eq:Benefit3) does not depend on the dependence relationships between the $I_{_kC \ne 0}$ random variables as expectations of random variables are not affected by correlations between random variables.

When calculating the variance of the present value, $\mathrm{Var}(PV)$, we can start from first principles $\mathrm{Var}(PV) = \mathrm{E}(PV^2) - [\mathrm{E}(PV)]^2$. However the calculation of $\mathrm{E}(PV^2)$ may be problematic as it depends on the dependence relationships between the $I_{_kC \ne 0}$ random variables. If the $I_{_kC \ne 0}$ random variables are independent then the calculation is not too problematics, however since we are interested in cash flows that are contingent on the life of one or more individuals we do not typically deal with independent $I_{_kC \ne 0}$ random variables and so we will consider this no further.

For the special case where only **one cash flow is possible** (i.e. only one $I_{_kC \ne 0}$ can take a value of one, or in other words the events $_kC \ne 0$ are mutually exclusive) then it is possible to calculate $\mathrm{Var}(PV)$ by noting that $\Pr(_kC)$ effectively becomes a probability mass function in this context. This is calculated as follows:

$$
\begin{array}{l}
\mathrm{Var}(PV) = \mathrm{E}(PV^2) - [\mathrm{E}(PV)]^2 \\
= \mathrm{E}^2 \left[ \sum_{k=0}^{\infty} ~_kC ~v^{k} ~I_{_kC \ne 0} \right] - [\mathrm{E}(PV)]^2 \\
= \sum_{k=0}^{\infty} ~_kC^2 ~v^{2k} ~\mathrm{E}(I_{_kC \ne 0}) - [\mathrm{E}(PV)]^2 \\
= \sum_{k=0}^{\infty} ~_kC^2 ~v^{2k} ~\Pr(_kC) - [\mathrm{E}(PV)]^2 \\
\end{array}
(\#eq:Benefit4)
$$

It is often efficient and convenient to analyse such cash flow systems using a spreadsheet package such as Excel or equivalent.

The embedded file below (<span style="color: purple;">I'll defer to Jed for the best way to number and label figures from an Excel source - aiming to be consistent with Loss Data Analytics</span>) shows the calculation of $\mathrm{E}(PV)$ and $\mathrm{Var}(PV)$ for a cash flow model of the style shown in Equations \@ref(eq:Benefit2), \@ref(eq:Benefit3) and \@ref(eq:Benefit4), assuming that only one cash flow is possible. To keep the example simple we assume that $k \in {0,1,2,...,10}$.  Cells highlighted in yellow correspond to the cash flow ($_kC$), spot rate ($_ki$) and probability ($\Pr(_kC)$) components of the calculation. These can be changed to see the impact on the $\mathrm{E}(PV)$ and $\mathrm{Var}(PV)$ output, which are highlighted in orange. (The standard deviation, StDev, is provided as well). The component calculations of the summations in $\mathrm{E}(PV)$ and $\mathrm{Var}(PV)$ can be found in Cells F3-F13 and G3-G13 respectively. To see the formulae for these cells just double click on the cell. You can download the file using an icon at the bottom right of the workbook.

***

<iframe width="650" height="750" frameborder="0" scrolling="no" src="https://onedrive.live.com/embed?resid=22D545F33DAA9426%21351&authkey=%21AG0diqB2fy-5HMc&em=2&wdAllowInteractivity=False&AllowTyping=True&wdDownloadButton=True&wdInConfigurator=True"></iframe>

***

<span style="color: red;">
The approach to doing this is outlined at https://support.microsoft.com/en-us/office/share-it-embed-an-excel-workbook-on-your-web-page-or-blog-from-onedrive-804e1845-5662-487e-9b38-f96307144081. This is the hosted on a personal onedrive account as I couldn't get my ANU account to be able to embed files without everyone having to sign in). The plot is just for show at the moment - I don't think this example needs a plot.
</span>

***

The following R code can be used to perform the same calculations as the spreadsheet above.

`r HideRCode('ContingentPaymentExample',"R Code For Contingent Payment Example")`

```{r  ContingentPaymentExample, warning=FALSE,message=FALSE, comment=NA, eval=TRUE}
Time <- c(0:10)
CashFlow <- c(250,800,500,1200,300,750,400,450,850,1500,100)
SpotRate <- c(0,0.005,0.008,0.012,0.017,0.023,0.03,0.03,0.03,0.03,0.03)
vk <- (1+SpotRate)^(-Time)
Prob <- c(0.07,0.06,0.09,0.17,0.11,0.1,0.02,0.09,0.02,0.16,0.08)
# Expected Present Value calculation
EPV <- sum(CashFlow*vk*Prob)
EPV
# Standard Deviation of Present Value calculation
CashFlowSq <- CashFlow^2
vkSq <- vk^2
VarPV <- sum(CashFlowSq*vkSq*Prob)-EPV^2
VarPV
StDevPV <- sqrt(VarPV)
StDevPV

```

</div>

<br>

You may notice from this example that the sum of the $\Pr(_kC)$ is 0.97 and not 1.  This is equivalent to saying that $\Pr(_kC=0) = 0.03$, in order for $\Pr(_kC)$ to meet the requirements of a probability mass function that $\sum_{k}\Pr(_kC)=1$. Where $_kC=0$ it does not matter what value $k$ takes as there is no cash flow being made and hence no impact on the $PV$ random variable.

Any adjustments you make to the above spreadsheet must be made whilst ensuring that $\sum_{k}\Pr(_kC) \le 1$ otherwise the model is not valid.

## Life insurance benefits and actuarial notation {#Sec:BenefitActNot}

<span style="color: red;">
**Structure discussion.**I’m not sure how much of these sorts of notation and probability calculations will be in Chapter 2 and whether we’ll need more basic probability calculations before this.  It may make sense to have another chapter between Chapter 2 and this that focussed on the life table and the various probability calculations coming from the life table – DHW do some of this in their Chapter 3 and incorporate things like mortality improvement and selection there as well. Promislow also does it in his Chapter 3.
</span>

In this section we introduce some basic types of life insurance policies and find the expected present value and variance of the present value of the benefit cash flows of these policies using Equations \@ref(eq:Benefit2), \@ref(eq:Benefit3) and \@ref(eq:Benefit4). We also present standard notation that actuaries have developed for these calculations. This notation assumes that all cash flows $_kC$ are $1$ for simplification. Also, unless otherwise noted, we assume that benefits are paid at the end of the year. 

### 	Whole of Life Insurance {#Sec:BenefitWL}

Under a **whole of life** policy the insurer pays a benefit because of the death of the policyholder, with payment made at the end of the year of death. In Chapter 2 we defined the random variable $K_{\bf{x}}$ as being the curtate death time (measured in years from the current time) of $\bf{x}$. Hence the time of benefit payment is $K_{\bf{x}}+1$. This system is illustrated on a timeline in Figure \@ref(fig:Benefit2), with the $PV$, $\mathrm{E}(PV)$ and $\mathrm{Var}(PV)$ of the benefit cash flows shown below. Since the cash flow is contingent on the death of the policyholder only one payment can be made and hence the calculation of $\mathrm{Var}(PV)$ from Equation \@ref(eq:Benefit4) is valid.


`r HideRCode('Benefit2',"R Code For Figure")`

```{r  Benefit2, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,9,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(6,6.2,6,5.8,code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(6,7,"3")
text(7.5,7,"...")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(6,8,"x+3")
text(7.5,8,"...")
text(1,5,"Cash Flow")
text(4,5,"1")
text(5,5,"1")
text(6,5,"1")
text(7.5,5,"...")
text(1,4,"Probability")
text(4,4,TeX("q_x"))
text(5,4,TeX("_{1|}q_x"))
text(6,4,TeX("_{2|}q_x"))
text(7.5,4,"...")


```

</div>

```{r Benefit2, ref.label = 'Benefit2', fig.cap = 'Timeline of benefit cash flows from a whole of life insurance policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

$$
\begin{array}{l}
PV = v^{K_{\bf{x}}+1} \\
= \sum_{k=0}^{\infty} v^{k+1} ~I_{K_{\bf{x}}=k} \\
\mathrm{E}(PV) = \sum_{k=0}^{\infty} v^{k+1} ~_{k|}q_{\bf{x}} = A_{\bf{x}}\\
\mathrm{Var}(PV) = \sum_{k=0}^{\infty} \left( v^{k+1} \right)^2 ~_{k|}q_{\bf{x}}  - [\mathrm{E}(PV)]^2 = ~^2A_{\bf{x}} - \left( A_{\bf{x}} \right) ^2\\
\end{array}
(\#eq:Benefit5)
$$

***

The actuarial notation, $A_{\bf{x}}$, has been introduced in Equation \@ref(eq:Benefit3). $A_{\bf{x}}$ represents the expected present value of the benefits from a whole of life policy on $\bf{x}$. $^2A_{\bf{x}}$ represents the expected squared present value of the benefits from the same whole of life policy and is used for calculating the variance of the present value as per Equation \@ref(eq:Benefit2).

***

### 	Term Insurance {#Sec:BenefitTI}

Under a **term insurance** policy the insurer pays a benefit because of the death of the policyholder within a specified term $n$ of the policy, with payment made at the end of the year of death. Hence, like whole of life insurance, the payment is made at time $K_{\bf{x}}+1$, as long as $K_{\bf{x}}+1$ is less than or equal to the $n$ year term of the policy. This system is illustrated on a timeline in Figure \@ref(fig:Benefit3), with the $PV$, $\mathrm{E}(PV)$ and $\mathrm{Var}(PV)$ of the benefit cash flows shown below. Since the cash flow is contingent on the death of the policyholder only one payment can be made and hence the calculation of $\mathrm{Var}(PV)$ from Equation \@ref(eq:Benefit4) is valid.

`r HideRCode('Benefit3',"R Code For Figure")`

```{r  Benefit3, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(10,6.2,10,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(7.5,7,"...")
text(10,7,"n-1")
text(11,7,"n")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(7.5,8,"...")
text(10,8,"x+n-1")
text(11,8,"x+n")
text(1,5,"Cash Flow")
text(4,5,"C")
text(5,5,"C")
text(7.5,5,"...")
text(10,5,"C")
text(11,5,"C")
text(1,4,"Probability")
text(4,4,TeX("q_x"))
text(5,4,TeX("_{1|}q_x"))
text(7.5,4,"...")
text(10,4,TeX("_{n-2|}q_x"))
text(11,4,TeX("_{n-1|}q_x"))


```

</div>

```{r Benefit3, ref.label = 'Benefit3', fig.cap = 'Timeline of benefit cash flows from a term insurance policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```


***

$$
\begin{array}{l}
PV = v^{K_{\bf{x}}+1} I_{K_{\bf{x}}+1 \le n} = \left \{\begin{array}{cl}
v^{K_{\bf{x}}+1} & \text{where }  K_{\bf{x}}+1 \le n \\
0  & \text{where } K_{\bf{x}}+1 > n \\
\end{array} \right. \\
= \sum_{k=0}^{n-1} v^{k+1} ~I_{K_{\bf{x}}=k} \\
\mathrm{E}(PV) = \sum_{k=0}^{n-1} v^{k+1} ~_{k|}q_{\bf{x}} = A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1}\\
\mathrm{Var}(PV) = \sum_{k=0}^{n-1} \left( v^{k+1} \right)^2 ~_{k|}q_{\bf{x}}  - [\mathrm{E}(PV)]^2  = ~^2A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1}  - \left( A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1} \right)^2  \\
\end{array}
(\#eq:Benefit6)
$$

***

The actuarial notation, $A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1}$, has been introduced in Equation \@ref(eq:Benefit4). $A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1}$ represents the expected present value of the benefits from a term insurance policy on $\bf{x}$ of term $n$ years. $^2A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1}$ represents the expected squared present value of the benefits from the same term insurance policy and is used for calculating the variance of the present value as per Equation \@ref(eq:Benefit2).

***

### 	Pure Endowment

Under a **pure endowment** policy the insurer pays a benefit because of the survival of the policyholder for the $n$ year term of the policy. In Chapter 2 we defined the random variable $T_{\bf{x}}$ as being the exact death time (measured in years from the current time) of $\bf{x}$. The time of the benefit payment is $n$ but is dependent upon $T_{\bf{x}}$. This system is illustrated on a timeline in Figure \@ref(fig:Benefit4), with the $PV$, $\mathrm{E}(PV)$ and $\mathrm{Var}(PV)$ of the benefit cash flows shown below. Since the cash flow is contingent on the death of the policyholder only one payment can be made and hence the calculation of $\mathrm{Var}(PV)$ from Equation \@ref(eq:Benefit4) is valid.

`r HideRCode('Benefit4',"R Code For Figure")`

```{r  Benefit4, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(11,7,"n")
text(1,8,"Insured Age")
text(3,8,"x")
text(11,8,"x+n")
text(1,5,"Cash Flow")
text(11,5,"1")
text(1,4,"Probability")
text(11,4,TeX("_np_{\\textbf{x}}}"))


```

</div>

```{r Benefit4, ref.label = 'Benefit4', fig.cap = 'Timeline of benefit cash flows from a pure endowment policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

$$
\begin{array}{l}
PV = v^n I_{T_{\bf{x}}>n} = \left \{\begin{array}{cl}
0 & \text{where } T_{\bf{x}} \le n \\
v^n & \text{where } T_{\bf{x}} > n \\
\end{array} \right.
\\
\mathrm{E}(PV) = v^n {_np_{\bf{x}}} = A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {\space \space \space \space \space 1}
\\
\mathrm{Var}(PV) = v^{2n} {_np_{\bf{x}}}(1-{_np_{\bf{x}}})
\end{array}
(\#eq:Benefit7)
$$

***

The actuarial notation, $A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {\space \space \space \space \space 1}$, has been introduced in Equation \@ref(eq:Benefit5). $A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {\space \space \space \space \space 1}$ represents the expected present value of the benefits from a pure endowment policy on $\bf{x}$ of term $n$ years. Unlike whole of life and term insurance we don't define notation for the expected squared present value of the benefits from the same pure endowment policy as the variance of the present value is simple to express without it, since the $PV$ is effectively $v^n$ mulitplied by a Bernoulli random variable with parameter ${_np_{\bf{x}}}$.

***

### 	Endowment Insurance

An **endowment insurance** policy is effectively a combination of a term insurance and pure endowment policy. The insurer pays a benefit at the end of the year of death if the policyholder's death occurs within the term $n$ of the policy, or at time $n$ if the policyholder survives until the term $n$. This system can be illustrated on a timeline as can be seen in Figure \@ref(fig:Benefit5), with the $PV$, $\mathrm{E}(PV)$ and $\mathrm{Var}(PV)$ of the benefit cash flows shown below. Since the cash flow is contingent on the death of the policyholder only one payment can be made and hence the calculation of $\mathrm{Var}(PV)$ from Equation \@ref(eq:Benefit4) is valid.


`r HideRCode('Benefit5',"R Code For Figure")`

```{r  Benefit5, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(10,6.2,10,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(7.5,7,"...")
text(10,7,"n-1")
text(11,7,"n")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(7.5,8,"...")
text(10,8,"x+n-1")
text(11,8,"x+n")
text(1,5,"Cash Flow")
text(4,5,"1")
text(5,5,"1")
text(7.5,5,"...")
text(10,5,"1")
text(11,5,"1")
text(1,3.5,"Probability")
text(4,4,TeX("q_x"))
text(5,4,TeX("_{1|}q_x"))
text(7.5,4,"...")
text(10,4,TeX("_{n-2|}q_x"))
text(11,4,TeX("_{n-1|}q_x"))
text(11,3,TeX("+_np_x"))

```

</div>

```{r Benefit5, ref.label = 'Benefit5', fig.cap = 'Timeline of benefit cash flows from an endowment insurance policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

$$
\begin{array}{l}
PV = v^{\text {min} \left[ K_{\bf{x}}+1 , n \right]}  = \left \{\begin{array}{cl}
v^{K_{\bf{x}}+1} & \text{where }  K_{\bf{x}}+1 \le n \\
v^n  & \text{where } K_{\bf{x}}+1 > n \\
\end{array} \right. \\
PV = \sum_{k=0}^{n-1} v^{k+1} ~I_{K_{\bf{x}}=k} + v^n ~I_{K_{\bf{x}}+1 > n} = A_{{\bf{x}}:\enclose{actuarial}{n}} = A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1} + A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {\space \space \space \space \space 1} \\
\mathrm{E}(PV) = \sum_{k=0}^{n-1} v^{k+1} ~_{k|}q_{\bf{x}} + v^n ~_np_{\bf{x}} = A_{{\bf{x}}:\enclose{actuarial}{n}} = A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {1} + A_{{\bf{x}}:\enclose{actuarial}{n}} ^ {\space \space \space \space \space 1} \\
\mathrm{Var}(PV) = \sum_{k=0}^{n-1} \left( v^{k+1} \right)^2 ~_{k|}q_{\bf{x}} + v^{2n} ~_np_{\bf{x}} - [\mathrm{E}(PV)]^2 = ~^2A_{{\bf{x}}:\enclose{actuarial}{n}} - \left( A_{{\bf{x}}:\enclose{actuarial}{n}} \right)^2 \\
\end{array}
(\#eq:Benefit8)
$$

***

The actuarial notation, $A_{{\bf{x}}:\enclose{actuarial}{n}}$, has been introduced in Equation \@ref(eq:Benefit6). $A_{{\bf{x}}:\enclose{actuarial}{n}}$ represents the expected present value of the benefits from a endowment insurance policy on $\bf{x}$ of term $n$ years. $^2A_{{\bf{x}}:\enclose{actuarial}{n}}$ represents the expected squared present value of the benefits from the same endowment insurance policy and is used for calculating the variance of the present value as per Equation \@ref(eq:Benefit2).

***

### 	Life Annuity

Under a **life annuity** policy the insurer pays regular benefits to policyholders whilst they are alive. An annuity payable **in advance** has benefits paid at the start of the year, while an annuity payable **in arrears** has benefits paid at the end of the year. This system is illustrated on a timeline in Figure \@ref(fig:Benefit6), with the $PV$ and $\mathrm{E}(PV)$ of the benefit cash flows shown below.


`r HideRCode('Benefit6',"R Code For Figure")`

```{r  Benefit6, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,9,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(6,6.2,6,5.8,code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(6,7,"3")
text(7.5,7,"...")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(6,8,"x+3")
text(7.5,8,"...")
text(1,5,"Cash Flow")
text(3,5,"1")
text(4,5,"1")
text(5,5,"1")
text(6,5,"1")
text(7.5,5,"...")
text(1,4,"Prob (advance)")
text(3,4,TeX("1"))
text(4,4,TeX("_1p_x"))
text(5,4,TeX("_2p_x"))
text(6,4,TeX("_3p_x"))
text(7.5,4,"...")
text(1,3,"Prob (arrears)")
text(4,3,TeX("_1p_x"))
text(5,3,TeX("_2p_x"))
text(6,3,TeX("_3p_x"))
text(7.5,3,"...")


```

</div>

```{r Benefit6, ref.label = 'Benefit6', fig.cap = 'Timeline of benefit cash flows from a life annuity policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

In advance:

$$
\begin{array}{l}
PV = 1+v^{1}+v^{2}+...+v^{K_{\bf{x}}} = \sum_{k=0}^{K_{\bf{x}}} v^k \\
= \sum_{k=0}^{\infty} v^{k} ~I_{K_{\bf{x}} \ge k} \\
\mathrm{E}(PV) = \sum_{k=0}^{\infty} v^{k} ~_kp_{\bf{x}} = \ddot{a}_{\bf{x}} \\
\end{array}
(\#eq:Benefit9)
$$

In arrears:

$$
\begin{array}{l}
PV = v^{1}+v^{2}+...v^{K_{\bf{x}}} \\
= \sum_{k=0}^{\infty} v^{k+1} ~I_{K_{\bf{x}} \ge k+1} \\
\mathrm{E}(PV) = \sum_{k=0}^{\infty} v^{k+1} ~_{k+1}p_{\bf{x}} = {a}_{\bf{x}} = \ddot{a}_{\bf{x}} - 1 \\
\end{array}
(\#eq:Benefit10)
$$

***

The actuarial notation, $\ddot{a}_{\bf{x}}$ and ${a}_{\bf{x}}$, has been introduced in Equations \@ref(eq:Benefit9) and \@ref(eq:Benefit10) respectively. $\ddot{a}_{\bf{x}}$ and ${a}_{\bf{x}}$ represent the expected present value of the benefits from a life annuity policy on $\bf{x}$, in advance and in arrears respectively. Since this policy makes multiple payments, and the payments are conditional on being alive (i.e. they are not independent), it is not possible to calculate $\mathrm{Var}(PV)$ in the same way as done in Equation \@ref(eq:Benefit4).

Note also that if we assume $_ki=i$ (i.e. that that yield curve is flat), the $PV$ in Equations \@ref(eq:Benefit7) and \@ref(eq:Benefit8) above can also be expressed using actuarial notation from financial mathematics. For example, for a life annuity in advance:

$$
PV =1+v^{1}+v^{2}+...v^{K_{\bf{x}}} \space = \ddot{a}_{\enclose{actuarial}{K_{\bf{x}}+1}} = \frac{1+i}{i} \left( 1-v^{K_{\bf{x}}+1} \right)
(\#eq:Benefit11)
$$

Remember that the present value of benefits from a whole of life policy is equal to $v^{K_{\bf{x}}+1}$. Therefore this relationship can be used to examine a relationship between life annuities and whole of life policies, starting from the $PV$ of a life annuity in advance as follows:

$$
\begin{array}{l}
PV = \frac{1+i}{i} \left( 1-v^{K_{\bf{x}}+1} \right) \\
\mathrm{E}(PV) = \mathrm{E} \left[ \frac{1+i}{i} \left(1-v^{K_{\bf{x}}+1} \right) \right] = \frac{1+i}{i}   \left(1- \mathrm{E} \left[ v^{K_{\bf{x}}+1} \right] \right)  \\
\ddot{a}_{\bf{x}} = \frac{1+i}{i} \left(1- A_{\bf{x}} \right) \\
\mathrm{Var}(PV) = \mathrm{Var} \left[ \frac{1+i}{i} \left(1-v^{K_{\bf{x}}+1} \right) \right] \\
= \left( \frac{1+i}{i} \right) ^2 \mathrm{Var} \left[ v^{K_{\bf{x}}+1} \right]
= \left( \frac{1+i}{i} \right) ^2 \left( ~^2A_{\bf{x}} - \left( A_{\bf{x}} \right) ^2 \right)
\end{array}
(\#eq:Benefit12)
$$

The relationships in Equations \@ref(eq:Benefit11) and \@ref(eq:Benefit12) hold only when $_ki = i$, but do allow us to calculate the variance of the present value of a life annuity. However, the restrictive assumption of a flat yield curve makes this relationship less useful in practice, and so we will not consider it in further detail.

***

### 	Term Life Annuity

Under a **term life annuity** policy the insurer pays benefits to policyholders whilst they are alive, for a maximum of $n$ periods. For annuities in advance and in arrears, this system is illustrated on a timeline in Figure \@ref(fig:Benefit7), with the $PV$ and $\mathrm{E}(PV)$ of the benefit cash flows shown below.


`r HideRCode('Benefit7',"R Code For Figure")`

```{r  Benefit7, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(10,6.2,10,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(7.5,7,"...")
text(10,7,"n-1")
text(11,7,"n")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(7.5,8,"...")
text(10,8,"x+n-1")
text(11,8,"x+n")
text(1,5,"Cash Flow")
text(3,5,"1")
text(4,5,"1")
text(5,5,"1")
text(7.5,5,"...")
text(10,5,"1")
text(11,5,"1")
text(1,4,"Prob (advance)")
text(3,4,"1")
text(4,4,TeX("_1p_x"))
text(5,4,TeX("_2p_x"))
text(7.5,4,"...")
text(10,4,TeX("_{n-1}p_x"))
text(1,3,"Prob (arrears)")
text(4,3,TeX("_1p_x"))
text(5,3,TeX("_2p_x"))
text(7.5,3,"...")
text(10,3,TeX("_{n-1}p_x"))
text(11,3,TeX("_np_x"))


```

</div>

```{r Benefit7, ref.label = 'Benefit7', fig.cap = 'Timeline of benefit cash flows from a term life annuity policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***
In advance:

$$
\begin{array}{l}
PV = 1+v^{1}+v^{2}+...+v^{\text{min}[K_{\bf{x}},n-1]} \\
= \sum_{k=0}^{n-1} v^{k} ~I_{K_{\bf{x}} \ge k} \\
\mathrm{E}(PV) = \sum_{k=0}^{n-1} v^k ~_kp_{\bf{x}} = \ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}} \\
\end{array}
(\#eq:Benefit13)
$$

In arrears:

$$
\begin{array}{l}
PV = v^{1}+v^{2}+...+v^{\text{min}[K_{\bf{x}},n]} \\
= \sum_{k=0}^{n-1} v^{k+1} ~I_{K_{\bf{x}} \ge k+1} \\
\mathrm{E}(PV) = \sum_{k=0}^{n-1} v^{k+1} ~_{k+1}p_{\bf{x}} = {a}_{{\bf{x}}:\enclose{actuarial}{n}} \\
\end{array}
(\#eq:Benefit14)
$$

The actuarial notation, $\ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}}$ and ${a}_{{\bf{x}}:\enclose{actuarial}{n}}$, has been introduced in Equations \@ref(eq:Benefit13) and \@ref(eq:Benefit14) respectively. $\ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}}$ and ${a}_{{\bf{x}}:\enclose{actuarial}{n}}$ represent the expected present value of the benefits from a term life annuity policy on $\bf{x}$, in advance and in arrears respectively. Since this policy makes multiple payments, and the payments are conditional on being alive (i.e. they are not independent), it is not possible to calculate $\mathrm{Var}(PV)$ in the same way as done in Equation \@ref(eq:Benefit4).

***

### 	Deferred Life Annuity

Under a **deferred life annuity** policy the insurer pays benefits to policyholders whilst they are alive, but only after a deferral period of $n$ periods. For annuities in advance and in arrears, this system is illustrated on a timeline in Figure \@ref(fig:Benefit8), with the $PV$ and $\mathrm{E}(PV)$ of the benefit cash flows shown below.


`r HideRCode('Benefit8',"R Code For Figure")`

```{r  Benefit8, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(10,6.2,10,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(6.5,7,"...")
text(8,7,"n-1")
text(9,7,"n")
text(10,7,"n+1")
text(11,7,"n+2")
text(12,7,"...")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(6.5,8,"...")
text(8,8,"x+n-1")
text(9,8,"x+n")
text(10,8,"x+n+1")
text(11,8,"x+n+2")
text(12,8,"...")
text(1,5,"Cash Flow")
text(9,5,"1")
text(10,5,"1")
text(11,5,"1")
text(12,5,"...")
text(1,4,"Prob (advance)")
text(9,4,TeX("_{n}p_x"))
text(10,4,TeX("_{n+1}p_x"))
text(11,4,TeX("_{n+2}p_x"))
text(12,4,"...")
text(1,3,"Prob (arrears)")
text(10,3,TeX("_{n+1}p_x"))
text(11,3,TeX("_{n+2}p_x"))
text(12,3,"...")

```

</div>

```{r Benefit8, ref.label = 'Benefit8', fig.cap = 'Timeline of benefit cash flows from a deferred life annuity policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

In advance:

$$
\begin{array}{l}
PV = \left \{\begin{array}{cl}
0 & \text{where }  T_{\bf{x}} < n \\
v^{n}+v^{n+1}+v^{n+2}+...+v^{K_{\bf{x}}}  & \text{where } T_{\bf{x}} \ge n \\
\end{array} \right. \\
= \sum_{k=n}^{\infty} v^{k} ~I_{K_{\bf{x}} \ge k} \\
\mathrm{E}(PV) = \sum_{k=n}^{\infty} v^k ~_kp_{\bf{x}} = ~_{n|}\ddot{a}_{\bf{x}} = \ddot{a}_{\bf{x}} - \ddot{a}_{{\bf{x}}:\enclose{actuarial}{n}} \\
\end{array}
(\#eq:Benefit15)
$$

In arrears:

$$
\begin{array}{l}
PV = \left \{\begin{array}{cl}
0 & \text{where }  T_{\bf{x}} < n+1 \\
v^{n+1}+v^{n+2}+...+v^{K_{\bf{x}}} & \text{where } T_{\bf{x}} \ge n+1 \\
\end{array} \right. \\
= \sum_{k=n}^{\infty} v^{k+1} ~I_{K_{\bf{x}} \ge k+1} \\
\mathrm{E}(PV) = \sum_{k=n}^{\infty} v^{k+1} ~_{k+1}p_{\bf{x}} = ~_{n|}{a}_{\bf{x}} = {a}_{\bf{x}} - {a}_{{\bf{x}}:\enclose{actuarial}{n}} \\
\end{array}
(\#eq:Benefit16)
$$

The actuarial notation, $_{n|}\ddot{a}_{\bf{x}}$ and $_{n|}{a}_{\bf{x}}$, has been introduced in Equations \@ref(eq:Benefit15) and \@ref(eq:Benefit16) respectively. $_{n|}\ddot{a}_{\bf{x}}$ and $_{n|}{a}_{\bf{x}}$ represent the expected present value of the benefits from a deferred life annuity policy on $\bf{x}$, in advance and in arrears respectively. Since this policy makes multiple payments, and the payments are conditional on being alive (i.e. they are not independent), it is not possible to calculate $\mathrm{Var}(PV)$ in the same way as done in Equation \@ref(eq:Benefit4).

***

### 	Guaranteed Life Annuity

A **guaranteed life annuity** policy is the same as a life annuity policy, except that the benefits are guaranteed to be paid for a minimum of $n$ periods. For annuities in advance and in arrears, this system is illustrated on a timeline in Figure \@ref(fig:Benefit9), with the $PV$ and $\mathrm{E}(PV)$ of the benefit cash flows shown below.


`r HideRCode('Benefit9',"R Code For Figure")`

```{r  Benefit9, warning=FALSE,message=FALSE, comment=NA, eval=FALSE}
plot.new()
par(mar = c(0,0,0,0) + 0.1)
plot.window(xlim=c(0,14),ylim=c(0,10))

arrows(3,6,13,6,code=2,lwd=2,angle=45,length=0.10)
arrows(3,6.2,3,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(4,6.2,4,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(5,6.2,5,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(10,6.2,10,5.8,code=0,lwd=2,angle=0,length=0.10)
arrows(11,6.2,11,5.8, code=0,lwd=2,angle=0,length=0.10)

library(latex2exp)

text(1,7,"Contract Time")
text(3,7,"0")
text(4,7,"1")
text(5,7,"2")
text(6.5,7,"...")
text(8,7,"n-1")
text(9,7,"n")
text(10,7,"n+1")
text(11,7,"n+2")
text(12,7,"...")
text(1,8,"Insured Age")
text(3,8,"x")
text(4,8,"x+1")
text(5,8,"x+2")
text(6.5,8,"...")
text(8,8,"x+n-1")
text(9,8,"x+n")
text(10,8,"x+n+1")
text(11,8,"x+n+2")
text(12,8,"...")
text(1,5,"Cash Flow")
text(3,5,"1")
text(4,5,"1")
text(5,5,"1")
text(6.5,5,"...")
text(8,5,"1")
text(9,5,"1")
text(10,5,"1")
text(11,5,"1")
text(12,5,"...")
text(1,4,"Prob (advance)")
text(3,4,"1")
text(4,4,TeX("1"))
text(5,4,TeX("1"))
text(6.5,4,"...")
text(8,4,TeX("1"))
text(9,4,TeX("_{n}p_x"))
text(10,4,TeX("_{n+1}p_x"))
text(11,4,TeX("_{n+2}p_x"))
text(12,4,"...")
text(1,3,"Prob (arrears)")
text(4,3,TeX("1"))
text(5,3,TeX("1"))
text(6.5,3,"...")
text(8,3,TeX("1"))
text(9,3,TeX("1"))
text(10,3,TeX("_{n+1}p_x"))
text(11,3,TeX("_{n+2}p_x"))
text(12,3,"...")

```

</div>

```{r Benefit9, ref.label = 'Benefit9', fig.cap = 'Timeline of benefit cash flows from a guaranteed life annuity policy', fig.align = 'center', fig.width=6, fig.height=2.5, echo = FALSE}
```

***

In advance:

$$
\begin{array}{l}
PV = 1+v^{1}+v^{2}+...+v^{\text{max}[K_{\bf{x}},n-1]} \\
= \sum_{k=0}^{n-1} v^{k} + \sum_{k=n}^{\infty} v^{k} ~I_{K_{\bf{x}} \ge k} \\
\mathrm{E}(PV) = \sum_{k=0}^{n-1} v^k + \sum_{k=n}^{\infty} v^k ~_kp_{\bf{x}} = \ddot{a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}} = \ddot{a}_{\enclose{actuarial}{n}} + ~_{n|}\ddot{a}_{\bf{x}} \\
\end{array}
(\#eq:Benefit17)
$$

In arrears:

$$
\begin{array}{l}
PV = v^{1}+v^{2}+...+v^{\text{max}[K_{\bf{x}},n]} \\
= \sum_{k=0}^{n-1} v^{k+1} + \sum_{k=n}^{\infty} v^{k+1} ~I_{K_{\bf{x}} \ge k+1} \\
\mathrm{E}(PV) = \sum_{k=0}^{n-1} v^{k+1} + \sum_{k=n}^{\infty} v^{k+1} ~_{k+1}p_{\bf{x}} = {a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}} = {a}_{\enclose{actuarial}{n}} + ~_{n|}{a}_{\bf{x}} \\
\end{array}
(\#eq:Benefit18)
$$

***

The actuarial notation, $\ddot{a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}}$ and ${a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}}$, has been introduced in Equations \@ref(eq:Benefit17) and \@ref(eq:Benefit18) respectively. $\ddot{a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}}$ and ${a}_{\overline{{\bf{x}}:\enclose{actuarial}{n}}}$ represent the expected present value of the benefits from a deferred life annuity policy on $\bf{x}$, in advance and in arrears respectively. Since this policy makes multiple payments, and the payments are conditional on being alive (i.e. they are not independent), it is not possible to calculate $\mathrm{Var}(PV)$ in the same way as done in Equation \@ref(eq:Benefit4).

### 	Valuing benefits using actuarial notation

We finish Chapter \@ref(Sec:BenefitActNot) with a brief description of how to use actuarial notation to value life contingent benefits. The example is provided in the context of whole of life policy with a fixed **sum insured** $_kC = C$. We can define the random variable of the present value of the benefits of this policy as $Cv^{K_{\bf{x}}+1}$ and hence $\mathrm{E}(PV)=C\mathrm{E} \left[ v^{K_{\bf{x}}+1} \right] = CA_{\bf{x}}$ and $\mathrm{Var}(PV)=C^2\mathrm{Var} \left[ v^{K_{\bf{x}}+1} \right] = C^2 \left( ~^2A_{\bf{x}} - \left( A_{\bf{x}} \right) ^2 \right)$

Note that if the cash flows are not constant (i.e. $_kC \neq C$) then the actuarial notation outlined in this Chapter is not applicable and the benefit must be valued using the first principles of Equations \@ref(eq:Benefit2), \@ref(eq:Benefit3) and \@ref(eq:Benefit4).

***

<span style="color: blue;">
**Note for author to complete.** We could show additional relationships among the different policies, including recursion (see DHW Chapter 5), perhaps as exercises for students. Some of this might better fit a Chapter on reserves. Need to decide this.  Need to think about exercises here.
</span>

***

##	Bringing actuarial notation to the Life Table {#Sec:BenefitLT}
In this subsection we use the notation introduced in Chapter \@ref(Sec:BenefitActNot) to value the benefits described in Chapter \@ref(Sec:BenefitActNot), using the Life Table introduced in Chapter 2. We ignore all other predictors of mortality apart from age. These calculations are performed in Excel in such a way to allow flexibility to adjust age ($x$), term ($n$), cash flows ($_kC$), interest rates ($_ki$) and life table mortality rates ($q_x$). The Excel workbook can be viewed and downloaded below.

***

<iframe width="900" height="750" frameborder="0" scrolling="no" src="https://onedrive.live.com/embed?resid=22D545F33DAA9426%21385&authkey=%21AGhkHMkS6Q_AxAQ&em=2&wdAllowInteractivity=False&AllowTyping=True&wdDownloadButton=True&wdInConfigurator=True"></iframe>

***

The "Life Table" worksheet contains the underlying Life Table used. The yellow highlighted $q_x$ cells can be adjusted as desired.

The "Assum & Outp - fixed C" worksheet contains calculations and results, assuming that $_kC$ equals a fixed $C$. This allows the use of the notation introduced in Chapter \@ref(Sec:BenefitActNot). Cells highlighted in yellow can be changed to adjust $x$, $n$, $C$ and $_ki$. Cells highlighted in orange provide the output calculations for the benefits described in Chapter \@ref(Sec:BenefitActNot). In this and the next worksheet a column "Year" is introduced which is equal to $k+1$. The column is introduced so that we may think of the cash flows as related to a profit year for an insurer, which we will introduce in Chapter X. Various calculation columns for both $k$ and $k+1$ are calculated, to account for cash flows occuring at the beginning of the year (e.g. life annuities in advance) and cash flows occuring at the end of a year (e.g. life annuities in arrears) whilst still allocating these cash flows to the same year.

The "Assum & Outp - var C" worksheet contains calculations and results, allowing for a variable $_kC$. The calculations are performed using the first principles of Equations \@ref(eq:Benefit2), \@ref(eq:Benefit3) and \@ref(eq:Benefit4). Cells highlighted in yellow can be changed to adjust $x$, $n$, $_kC$ and $_ki$. Cells highlighted in orange provide the output calculations for the benefits described in Chapter \@ref(Sec:BenefitActNot). Similar timing conventions are adopted to that of the previous worksheet, with the cash flows occuring at the beginning ($k$) or end ($k+1$) of the year.

You are recommended to review the formulae in the workbook against those found in Chapters \@ref(Sec:BenefitCFunc) and \@ref(Sec:BenefitActNot), to confirm your understanding of how to perform the calculations in a spreadsheet package. The calculations are not performed in R, although a case study using R will be provided in Chapter \@ref(Sec:BenefitCS).

<span style="color: blue;">
**Note for author to complete.** There are many exercises and examples that could follow on from this which will need to be considered.  I also need to update the actuarial notation in the Excel workbook (the cells highlighted green)


## Case Study: Valuing the benefits of a portfolio of term insurance policies {#Sec:BenefitCS}

In this section we take what we have learned so far in this Chapter and apply it to a more detailed valuation of the benefits of an individual and porfolio of term insurance policies.

### An individual policy {#Sec:BenefitCSInd}

We showed how to value a single term insurance policy in Chapter \@ref(Sec:BenefitTI). We will now consider a specfic example of policyholder ID 160781 from the  simulated data described in <span style="color: red;">to be completed</span>. Imagine that this individual has purchased a term insurance policy with term 10 years, and that we wish to value the benefits under the policy immediately after purchase. The individual is male and aged 49 at the purchase of the policy. For the purpose of this example we will ignore all other predictors of mortality from the dataset. Hence ${\bf{x}} = x = 49$. Further we assume a sum insured of \$400,000 ($=~_kC$), and that mortality probability is expected to follow the US 2010-14 female rates described in Chapter 2. Assuming an interest rate of 2% per annum effective (<span style="color: red;">we could instead use a spot rate calculation from a primer done before this chapter</span>) ($=i_t$), the calculation of $\mathrm{E}(PV)$ and $\mathrm{Var}(PV)$ can be performed as follows, using the results from Equation \@ref(eq:Benefit6) (note that to maintain flexibility the notation from Chapter \@ref(Sec:BenefitActNot) is not used):

***

$$
\begin{array}{l}
PV = 400,000v^{K_{49}+1} I_{K_{49}+1 \le 10} = \left \{\begin{array}{cl}
v^{K_{49}+1} & \text{where }  K_{49}+1 \le 10 \\
0  & \text{where } K_{49}+1 > 10 \\
\end{array} \right.
\\
\mathrm{E}(PV) = \sum_{k=0}^{9} 400,000 v^{k+1} ~_{k|}q_{49} \\
\mathrm{Var}(PV) = \sum_{k=0}^{9} \left( 400,000v^{k+1} \right)^2 ~_{k|}q_{49}  - [\mathrm{E}(PV)]^2 \\
\end{array}
(\#eq:Benefit19)
$$

Like we did in Chapter \@ref(Sec:BenefitCFunc) we can calculate $\mathrm{E}(PV)$ and $\mathrm{Var}(PV)$using Excel or equivalent:

***

<iframe width="800" height="450" frameborder="0" scrolling="no" src="https://onedrive.live.com/embed?resid=22D545F33DAA9426%21359&authkey=%21AP81G6JRw10MSgg&em=2&wdAllowInteractivity=False&AllowTyping=True&wdDownloadButton=True&wdInConfigurator=True"></iframe>

***

The following R code can be used to perform the same calculations as the spreadsheet above.

`r HideRCode('TermInsuranceIndividualExample',"R Code For Term Insurance Individual Example")`

```{r  TermInsuranceIndividualExample, warning=FALSE,message=FALSE, comment=NA, eval=TRUE}
Year <- c(1:10)
CashFlow <- 400000
SpotRate <- 0.02
vk <- (1+SpotRate)^(-Year)
mx <- c(0.002956,0.003216,0.003507,0.003786,0.004023,0.004360,0.004670,0.005022,0.005390,0.005724) #Bringing in the mx values from the US2010-14 female life tables
qx <- 1-exp(-mx)
kpx <- numeric(length(Year)) # Initialising probability of survival to be used in the loop below
qxdef <- numeric(length(Year)) # Initialising deferred probability of death to be used in the loop below
kpx[1] <- 1
qxdef[1] <- kpx[1]*qx[1]
for(i in 2:length(Year)){ # Calulates probability of survival and deferred probability of death for future years
  kpx[i] <- kpx[i-1]*(1-qx[i-1])
  qxdef[i]<-kpx[i]*qx[i]
}
# Expected Present Value calculation
EPV <- sum(CashFlow*vk*qxdef)
EPV
# Standard Deviation of Present Value calculation
CashFlowSq <- CashFlow^2
vkSq <- vk^2
VarPV <- sum(CashFlowSq*vkSq*qxdef)-EPV^2
VarPV
StDevPV <- sqrt(VarPV)
StDevPV

```

</div>

***

Another way of analysing $PV$ is to investigate its probability mass function (pmf). We know that the probability mass function of $K_{\bf{x}}$ is $\Pr(K_{\bf{x}}=k) = ~_{k|}q_{\bf{x}}$. In this example we note that $~_kPV = 400,000v^{k+1}$ for $k \in \{0,1,2,3,\ldots,9\}$ and $~_kPV = 0$ otherwise, and therefore the probability mass function of $PV$ is $\Pr \left( PV= ~_kPV \right) = ~_{k|}q_{49}$ where $k \in \{0,1,2,3,\ldots,9\}$ and $\Pr \left( PV= 0 \right) = ~_{10}p_{49}$. These values can be shown below:

`r HideRCode('TermInsuranceIndividualExamplepmf',"R Code for pmf calculation")`

```{r TermInsuranceIndividualExamplepmf, eval = FALSE}
npx <- kpx[10]*(1-qx[10])
PV <- CashFlow*(1+SpotRate)^(-Year)
PV[11] <- 0
#PVout <- round(PV,digits = 2)
PVout <- formatC(as.numeric(PV),format="f",digits=2)
Probs <- c(qxdef,npx)
Probsout <- round(Probs,digits = 4)
ProbsoutMat <- t(cbind(PVout, Probsout))
rownames(ProbsoutMat) <- c("kPV", "Pr(PV = kPV)")
colnames(ProbsoutMat) <- rep("",11)
knitr::kable(ProbsoutMat, align="r")

```

</div>

```{r TermInsuranceIndividualExamplepmfa, ref.label = 'TermInsuranceIndividualExamplepmf', echo = FALSE}
```

<span style="color: purple;">**To be resolved later.** We'll need to fix the formatting of tables.  I'm not sure how to do this and will need some help.</span>

Using R, we can also simulate observations of $PV$ from the pmf above, which is done below for 5000 observations. This is not particularly interesting for a single policyholder, as the distribution of $PV$ observations is similar to the probabilities from the pmf. However, this approach will prove very useful when analysing a portfolio of policies in Chapter \@ref(Sec:BenefitCSPort). By way of demonstration, in the R code below the mean and standard deviation of the 5000 observations are calculated, which you can see is materially similar to the values calculated from Equation \@ref(eq:Benefit19). The histogram is material similar to the distribution shown by the pmf above.

`r HideRCode('Simulation.Single',"R Code For Simulation")`

```{r SimulationSingle, warning=FALSE,message=FALSE, comment=NA, eval=TRUE}
nsim = 5000
IndivSample <- sample(PV, size = nsim, replace = TRUE, prob = Probs)
mean(IndivSample)
sd(IndivSample)

par(mfrow=c(1,1))
hist(IndivSample/1000, main="Distribution of PV of individual policyholder", xlab="PV ($'000)", border="red", col="green") 

```

```{r SimulationSinglea, ref.label = 'SimulationSingle', echo = FALSE}
```

</div>

<span style="color: red;">
**Structure discussion.**The concept of simulation will likely not be familiar to readers. We’ll need to think about how to present this to students and how much detail we wish to go into. DHW have an appendix on Monte Carlo simulation, although simulation is not widely used in the book. We’ll also need to think about how this would work for those only able to access the pdf version of the textbook.
</span>

###	A portfolio of policies {#Sec:BenefitCSPort}

Now let us consider a portfolio of $J$ independent term insurance policies on individuals ${\bf{x}}_j$ where $j = 1,2,...,J$. We assume that policyholders from the final year of the insurer data (i.e. Month 780) purchase a term insurance policy, giving us $J=190$. Each policyholder has a different term and sum insured. The policyholder data can be obtained by [clicking on this link](https://1drv.ms/u/s!AiaUqj3zRdUigwTrdRDalsX57334?e=VDw2tN). We assume that mortality follows US 2010-14 female or male rates (depending on the policyholder) as described in Chapter 2.

Using Equation \@ref(eq:Benefit3) and incorporating the sum insureds $C_j$ and term $n_j$, we can describe the present value of the benefits to be paid from this portfolio as as:

$$
\begin{array}{l}
PV = 1
\end{array}
(#eq:Benefit20)
$$

PV =  \sum_{j=1}^J C_j v^{K_{{\bf{x}}_j}+1} I_{K_{{\bf{x}}_j}+1}+1 \le n_j} \\
\mathrm{E}(PV) = \sum_{j=1}^J C_j \sum_{k=0}^{n_j-1} v^{k+1} ~_k|q_{{\bf{x}}_j} \\

We can calculate $\mathrm{E}(PV)$ using Equation \@ref(eq:Benefit20). This is done in R below:

`r HideRCode('TermInsurancePortfolioExampleEPV',"R Code For Term Insurance Portfolio Example EPV")`

```{r  TermInsurancePortfolioExampleEPV, warning=FALSE,message=FALSE, comment=NA, eval=TRUE}

SpotRate <- 0.02
PolHold <- read.csv("C:/Working/OneDrive - Australian National University/Actuarial/Online Life Con textbook/Chap3LifeInsCashFlows/LifeCon-Chap3/SyntheticInsurerDataCh3CS.csv") # Importing policyholder data into R - we'll need to decide on conventions here
MortRates <- read.csv("C:/Working/OneDrive - Australian National University/Actuarial/Online Life Con textbook/Chap3LifeInsCashFlows/LifeCon-Chap3/HMDmx.csv") # Importing mortality data into R
MortRates$qx <- 1-exp(-MortRates$mx)

PolHold$EPV <- 0 # Initialising EPV calculation for each policyholder
PolHold$Calc0px <- 1 # Initialising kpx calculation for each policyholder
for (i in 1:max(PolHold$Term)){ # The calculation of EPV is built up in a loop over the potential policy years
  PolHold <- merge(PolHold, MortRates, by = c("Age","Sex"), all.x=TRUE) # Links the correct qx to the policyholder for that year
  PolHold[,paste0("Calc","qxyr",i)] <- ifelse(PolHold$Term>=i,PolHold$qx,0) # No mortality rate is applied if the term of the policy has already been completed
  PolHold <- PolHold[,!(names(PolHold) %in% c("mx","qx"))] # Removes mx and qx so they can be linked again next year for one year older
  PolHold[,paste0("Calc",i,"px")] <- PolHold[,paste0("Calc",i-1,"px")] * (1 - PolHold[,paste0("Calc","qxyr",i)]) # Calculating kpx
  PolHold[,paste0("Calc",i,"qxdef")] <- PolHold[,paste0("Calc",i-1,"px")] * PolHold[,paste0("Calc","qxyr",i)] # Calculating deferred qx
  PolHold$EPV <- PolHold$EPV + PolHold[,paste0("Calc",i,"qxdef")] * PolHold$SumInsured * (1+SpotRate)^(-i) # Adding the component of EPV for that year
  PolHold$Age <- PolHold$Age + 1 # Increasing age for next loop iteration
}

EPV <- sum(PolHold$EPV)
EPV

```

</div>

***

However, even if the the insured policyholders are independent across all $j$, determining $\mathrm{Var}(PV)$ and the exact distribution of $PV$ is likely not possible. Instead we use simulations to gain a greater understanding of the distribution of $PV$. The following code shows the output of 5000 simulated observations of $PV$ from Equation \@ref(eq:Benefit20), including the mean, standard deviation and a histogram.

`r HideRCode('TermInsurancePortfolioExampleSims',"R Code For Term Insurance Portfolio Example Simulations")`

```{r  TermInsurancePortfolioExampleSims, warning=FALSE, message=FALSE, comment=NA, eval=TRUE}

# Much of the code below is repeated from the EPV calculation so this code can be run without running the previous code

nsim = 5000
SpotRate <- 0.02
PolHold <- read.csv("C:/Working/OneDrive - Australian National University/Actuarial/Online Life Con textbook/Chap3LifeInsCashFlows/LifeCon-Chap3/SyntheticInsurerDataCh3CS.csv") # Importing policyholder data into R - we'll need to decide on conventions here
MortRates <- read.csv("C:/Working/OneDrive - Australian National University/Actuarial/Online Life Con textbook/Chap3LifeInsCashFlows/LifeCon-Chap3/HMDmx.csv") # Importing mortality data into R
MortRates$qx <- 1-exp(-MortRates$mx)

rm(Probs,PV,IndivSample) # Removing some data objects so they can be recalculated from scratch

Probs <- data.frame(matrix(ncol=0,nrow=nrow(PolHold))) # This data frame will hold the probabilities of each PV cash flow outcome for each policyholder
PV <- data.frame(matrix(ncol=0,nrow=nrow(PolHold))) # This data frame will hold the potential PV cash flow outcomes for each policyholder
IndivSample <- data.frame(matrix(ncol=nsim,nrow=0)) # This data frame will hold the simulated PV cash flow outcomes for each policyholder
SumPV <- 0 # Initialising the sum of the PV cash flow outcomes for each simulation

PolHold$Calc0px <- 1
for (i in 1:max(PolHold$Term)){ # This loop calculates the necessary data items over the potential policy years
  PolHold <- merge(PolHold, MortRates, by = c("Age","Sex"), all.x=TRUE) # Links the correct qx to the policyholder for that year
  PolHold[,paste0("Calc","qxyr",i)] <- ifelse(PolHold$Term>=i,PolHold$qx,0) # No mortality rate is applied if the term of the policy has already been completed
  PolHold <- PolHold[,!(names(PolHold) %in% c("mx","qx"))] # Removes mx and qx so they can be linked again next year for one year older
  PolHold[,paste0("Calc",i,"px")] <- PolHold[,paste0("Calc",i-1,"px")] * (1 - PolHold[,paste0("Calc","qxyr",i)]) # Calculating kpx
  PolHold[,paste0("Calc",i,"qxdef")] <- PolHold[,paste0("Calc",i-1,"px")] * PolHold[,paste0("Calc","qxyr",i)] # Calculating deferred qx
  Probs[,paste0("Probs",i)] <- PolHold[,paste0("Calc",i,"qxdef")] # Calculating probability of PV cash flow outcome
  PV[,paste0("PV",i)] <- PolHold$SumInsured * (1+SpotRate)^(-i) # Calculating potential PV cash flow outcome
  PolHold$Age <- PolHold$Age + 1 # Increasing age for next loop iteration
}

Probs$ProbsEnd <- PolHold[,paste0("Calc",max(PolHold$Term),"px")] # Calculates the probability of no claim payment on the policy
PV$PVEnd <- 0 # The PV for no claim payment is zero

for (i in 1:nrow(PolHold)) { # This loop calculates the simulated PV observations separately for each policyholder
  IndivSample[i,] <- sample(PV[i,], size = nsim, replace = TRUE, prob = Probs[i,])
}

for (i in 1:nsim) { # This loop calculates the aggregate PV across all policyholders separately for each simulation
  SumPV[i] <- sum(IndivSample[,i])
}

mean(SumPV)
sd(SumPV)

par(mfrow=c(1,1))
hist(SumPV, main="Distribution of PV of a portfolio of policyholders", xlab="PV ($' millions)", border="red", col="green") 

```

</div>

Two things are immediately apparent from the simulated observations of $PV$ from the porfolio of policies.  First, is that despite the extreme skewness of the $PV$ outcomes for an individual policyholder, the distribution of the $PV$ of the portfolio of policies is remarkably bell shaped. This is evidence of the Central Limit Theorem in action. Secondly, whilst the standard deviation of the $PV$ of an individual policy is multiple times larger than the $E(PV)$, the standard deviation of the $PV$ of a portfolio of policies is multiple times smaller than the $E(PV)$. This is an example of law of large numbers in action.

These are both important results that we will return to in later Chapters when investigating the financial condition of a life insurer.

***

<span style="color: purple;">
**To be resolved later.** Other important concepts to address in this or another chapter:

<span style="color: purple;">
-	 The relationship between life insurance and life annuities. The two are perfect natural hedge provided mortality is the same. If life policies mortality are different from annuitant mortality, the relationship breaks down. My instinct is that this goes in a later chapter.
-	The concept of discounting with life using pure endowment.
-	The recursive formula for the value from year to year - probably later as part of policy values.
</span>


<span style="color: purple;">
**To be resolved later.** It is recommended to include the following material in a separate chapter.  We could also include things like increasing annuities/insurance but I'm not really convinced about the benefits of these.
</span>

# Chapter 4 Extensions to Modeling Simple Life Contingent Benefits {#C:BenefitExt}

`r chapnum = 4`

## The impact of self selection

<span style="color: purple;">
I have not yet included anything about selection effects, although this can be added to this section fairly easily. DHW don’t have anything different in Chapter 4 for selection effects, but instead just have a short subsection nothing that the calculations are the same for selection but just use the select life table.
</span>

## Modelling contingent cash flows more frequently than annually

<span style="color: purple;"> This would reflect the 1/mthly case from DHW Chapter 4. Due to the length of this chapter we will need to consider if/how to split it up into additional chapters.  It is traditional to split life insurance and annuity chapters.  I’m not a big fan of this personally as in my opinion this splits concepts of valuation up were it really is not necessary.  An alternative option would be to have the material from here and continuous time be its own Chapter; i.e. we would generally focus on yearly payments only and this extra chapter would act as an aside to cover the 1/mthy and continuous structures.  We might also include in this additional chapter material on approximation (e.g. annual payments but made at exact time of death) and other adjustments such as indexation of payments. </span>


##	Modelling contingent cash flows in continuous time

<span style="color: green;"> See above. This could be expressed as when $m \rightarrow \infty$. We could provide examples from earlier in this Chapter as our starting point. We can also link this to the continuous models from Chapter 2 – see for example how Makeham’s rule is used in DHW Chapter 4. </span>


# Actuarial Symbols {-}

<span style="color: green;">
This is for practicing how to write actuarial symbols with R bookdown/markdown such as $_{t}p_{[x]}$.

<span style="color: green;">
It is sometimes helpful to put a space before the pre-subscript like $\frac{\ell_{[x]+t}}{\ell_{[x]}} = ~_{t}p_{[x]}$. Else you get this awkward $\frac{\ell_{[x]+t}}{\ell_{[x]}} = _{t}p_{[x]}$.

<span style="color: green;">
Try this

<span style="color: green;">
$$
\require{enclose} EPV = a _{[25]+5:\enclose{actuarial}{30}} ^ {\space 1}
$$
<span style="color: green;">
and this $\require{enclose} a_{\enclose{actuarial}{K}}$ and this
$\require{enclose} \ddot{a}_{x}^{\{m\}}$ 
and
$\require{enclose} \ddot{a}_{x:\enclose{actuarial}{n}}^{(m)}$
and
$\require{enclose} {}^{2}\bar{A}_{x:\enclose{actuarial}{n}}$
,
$\require{enclose} {}^{2}\ddot{a}_{xy:\enclose{actuarial}{n}}$
and
$\require{enclose} \mathring{a}_{x:\enclose{actuarial}{n}}^{(m)}$
and
$$
\require{enclose} 
Y = 
 \begin{cases}
 1 + v + v^2 + \cdots + v^K = \ddot{a}_{\enclose{actuarial}{K+1}}, K=0,1,\ldots,n-1 \\
 1 + v + v^2 + \cdots + v^{n-1} = \ddot{a}_{\enclose{actuarial}{n}}, K \ge n
 \end{cases}
$$
</span>